(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{JgC6:function(e,s,i){"use strict";i.r(s),i.d(s,"InstructorSessionsPageModule",(function(){return le}));var o=i("ofXK"),n=i("3Pt+"),t=i("tyNb"),a=i("mYbV"),c=i("aSpy"),r=i("qVc+"),d=i("f3aF"),l=i("vHwn"),b=i("SEFB"),u=i("TOej"),h=i("pjmv"),m=i.n(h),S=i("cp0P"),p=i("LRne"),g=i("nYR2"),v=i("eIep"),f=i("bOdf"),k=i("vkgz"),E=i("lJxs"),y=i("A3DQ"),R=i("R8lv"),F=i("Mdjh"),M=i("p6cw"),w=i("G/Uz"),T=i("BKNR"),C=i("JUCI"),B=i("TQ0J"),O=i("uBDz"),V=i("fXoL"),I=i("1kSV");function L(e,s){if(1&e&&(V.Wb(0,"option",17),V.Qc(1),V.Vb()),2&e){const e=s.$implicit;V.sc("ngValue",e.courseId),V.Cb(1),V.Rc(e.courseId)}}function W(e,s){if(1&e){const e=V.Xb();V.Wb(0,"tr"),V.Wb(1,"td"),V.Wb(2,"input",18),V.ic("ngModelChange",(function(s){return V.Fc(e),V.kc().copyFromFeedbackSession=s})),V.Vb(),V.Vb(),V.Wb(3,"td"),V.Qc(4),V.Vb(),V.Wb(5,"td"),V.Qc(6),V.Vb(),V.Vb()}if(2&e){const e=s.$implicit,i=V.kc();V.Cb(2),V.sc("ngModel",i.copyFromFeedbackSession)("value",e),V.Cb(2),V.Rc(e.courseId),V.Cb(2),V.Rc(e.feedbackSessionName)}}let N=(()=>{class e{constructor(e){this.activeModal=e,this.FEEDBACK_SESSION_NAME_MAX_LENGTH=O.a,this.courseCandidates=[],this.existingFeedbackSession=[],this.copyToCourseId="",this.newFeedbackSessionName=""}copy(){this.activeModal.close({fromFeedbackSession:this.copyFromFeedbackSession,newFeedbackSessionName:this.newFeedbackSessionName,copyToCourseId:this.copyToCourseId})}ngOnInit(){}}return e.\u0275fac=function(s){return new(s||e)(V.Qb(I.a))},e.\u0275cmp=V.Kb({type:e,selectors:[["tm-copy-from-other-sessions-modal"]],inputs:{courseCandidates:"courseCandidates",existingFeedbackSession:"existingFeedbackSession"},decls:39,vars:6,consts:[[1,"modal-header"],[1,"modal-title"],["type","button",1,"close",3,"click"],[1,"fas","fa-times"],[1,"modal-body"],[1,"row"],[1,"col-12"],[1,"form-group"],["id","copy-course-id",1,"form-control",3,"ngModel","ngModelChange"],[3,"ngValue",4,"ngFor","ngForOf"],["id","copy-session-name","type","text","maxlength","38","placeholder","e.g. Feedback for Project Presentation 1",1,"form-control",3,"ngModel","ngModelChange"],["id","copy-selection-table",1,"table-responsive-lg","table","table-bordered","table-hover"],[1,"bg-primary","text-white"],[4,"ngFor","ngForOf"],[1,"modal-footer"],["id","btn-confirm-copy","type","button",1,"btn","btn-primary",3,"disabled","click"],["type","button",1,"btn","btn-light",3,"click"],[3,"ngValue"],["type","radio","name","copySessionFrom",3,"ngModel","value","ngModelChange"]],template:function(e,s){1&e&&(V.Wb(0,"div",0),V.Wb(1,"h5",1),V.Qc(2,"Creating a new session by copying a previous session"),V.Vb(),V.Wb(3,"button",2),V.ic("click",(function(){return s.activeModal.dismiss()})),V.Rb(4,"i",3),V.Vb(),V.Vb(),V.Wb(5,"div",4),V.Wb(6,"div",5),V.Wb(7,"div",6),V.Wb(8,"div",7),V.Wb(9,"label"),V.Qc(10,"Create in course"),V.Vb(),V.Wb(11,"select",8),V.ic("ngModelChange",(function(e){return s.copyToCourseId=e})),V.Oc(12,L,2,2,"option",9),V.Vb(),V.Vb(),V.Wb(13,"div",7),V.Wb(14,"label"),V.Wb(15,"b"),V.Qc(16,"Name for new session"),V.Vb(),V.Vb(),V.Wb(17,"input",10),V.ic("ngModelChange",(function(e){return s.newFeedbackSessionName=e})),V.Vb(),V.Wb(18,"span"),V.Qc(19),V.Vb(),V.Vb(),V.Wb(20,"div",7),V.Wb(21,"label"),V.Wb(22,"b"),V.Qc(23,"Copy settings and questions from"),V.Vb(),V.Vb(),V.Wb(24,"table",11),V.Wb(25,"thead",12),V.Wb(26,"tr"),V.Wb(27,"th"),V.Qc(28,"\xa0"),V.Vb(),V.Wb(29,"th"),V.Qc(30,"Course ID"),V.Vb(),V.Wb(31,"th"),V.Qc(32,"Feedback Session Name"),V.Vb(),V.Vb(),V.Vb(),V.Oc(33,W,7,4,"tr",13),V.Vb(),V.Vb(),V.Vb(),V.Vb(),V.Vb(),V.Wb(34,"div",14),V.Wb(35,"button",15),V.ic("click",(function(){return s.copy()})),V.Qc(36,"Copy"),V.Vb(),V.Wb(37,"button",16),V.ic("click",(function(){return s.activeModal.dismiss()})),V.Qc(38,"Cancel"),V.Vb(),V.Vb()),2&e&&(V.Cb(11),V.sc("ngModel",s.copyToCourseId),V.Cb(1),V.sc("ngForOf",s.courseCandidates),V.Cb(5),V.sc("ngModel",s.newFeedbackSessionName),V.Cb(2),V.Sc("",s.FEEDBACK_SESSION_NAME_MAX_LENGTH-s.newFeedbackSessionName.length," characters left"),V.Cb(14),V.sc("ngForOf",s.existingFeedbackSession),V.Cb(2),V.sc("disabled",!s.copyFromFeedbackSession||!s.copyToCourseId||!s.newFeedbackSessionName))},directives:[n.B,n.p,n.s,o.t,n.c,n.k,n.u,n.E,n.x],styles:[""]}),e})(),D=(()=>{class e{constructor(e){this.activeModal=e,this.courseId="",this.feedbackSessionName=""}ngOnInit(){}}return e.\u0275fac=function(s){return new(s||e)(V.Qb(I.a))},e.\u0275cmp=V.Kb({type:e,selectors:[["tm-session-permanent-deletion-confirm-modal"]],inputs:{courseId:"courseId",feedbackSessionName:"feedbackSessionName"},decls:13,vars:2,consts:[[1,"modal-header","bg-danger","text-white"],[1,"modal-title"],[1,"fas","fa-times-circle"],["type","button",1,"close",3,"click"],[1,"fas","fa-times"],[1,"modal-body"],[1,"modal-footer"],["type","button",1,"btn","btn-light",3,"click"],["type","button",1,"btn","btn-danger","modal-btn-ok",3,"click"]],template:function(e,s){1&e&&(V.Wb(0,"div",0),V.Wb(1,"h5",1),V.Rb(2,"i",2),V.Qc(3," Confirm deleting feedback session"),V.Vb(),V.Wb(4,"button",3),V.ic("click",(function(){return s.activeModal.dismiss()})),V.Rb(5,"i",4),V.Vb(),V.Vb(),V.Wb(6,"div",5),V.Qc(7),V.Vb(),V.Wb(8,"div",6),V.Wb(9,"button",7),V.ic("click",(function(){return s.activeModal.dismiss()})),V.Qc(10,"No, Cancel the Operation"),V.Vb(),V.Wb(11,"button",8),V.ic("click",(function(){return s.activeModal.close()})),V.Qc(12,"Yes"),V.Vb(),V.Vb()),2&e&&(V.Cb(7),V.Tc(" Are you sure you want to permanently delete the feedback session ",s.feedbackSessionName," in ",s.courseId,"?\n"))},styles:[""]}),e})();function x(e,s){if(1&e&&(V.Wb(0,"li"),V.Qc(1),V.Vb()),2&e){const e=s.$implicit;V.Cb(1),V.Tc("",e.courseId,": ",e.feedbackSessionName,"")}}let Q=(()=>{class e{constructor(e){this.activeModal=e,this.sessionsToDelete=[]}ngOnInit(){}}return e.\u0275fac=function(s){return new(s||e)(V.Qb(I.a))},e.\u0275cmp=V.Kb({type:e,selectors:[["tm-sessions-permanent-deletion-confirm-modal"]],inputs:{sessionsToDelete:"sessionsToDelete"},decls:19,vars:2,consts:[[1,"modal-header","bg-danger","text-white"],[1,"modal-title"],[1,"fas","fa-times-circle"],["type","button",1,"close",3,"click"],[1,"fas","fa-times"],[1,"modal-body"],[4,"ngFor","ngForOf"],[1,"modal-footer"],["type","button",1,"btn","btn-light",3,"click"],["type","button",1,"btn","btn-danger","modal-btn-ok",3,"click"]],template:function(e,s){1&e&&(V.Wb(0,"div",0),V.Wb(1,"h5",1),V.Rb(2,"i",2),V.Qc(3," Confirm deleting all feedback sessions in the Recycle Bin"),V.Vb(),V.Wb(4,"button",3),V.ic("click",(function(){return s.activeModal.dismiss()})),V.Rb(5,"i",4),V.Vb(),V.Vb(),V.Wb(6,"div",5),V.Wb(7,"div"),V.Qc(8),V.Wb(9,"b"),V.Qc(10,"Recycle Bin"),V.Vb(),V.Qc(11,"? "),V.Vb(),V.Wb(12,"ul"),V.Oc(13,x,2,2,"li",6),V.Vb(),V.Vb(),V.Wb(14,"div",7),V.Wb(15,"button",8),V.ic("click",(function(){return s.activeModal.dismiss()})),V.Qc(16,"No, Cancel the Operation"),V.Vb(),V.Wb(17,"button",9),V.ic("click",(function(){return s.activeModal.close()})),V.Qc(18,"Yes"),V.Vb(),V.Vb()),2&e&&(V.Cb(8),V.Sc(" Are you sure you want to permanently delete the following ",s.sessionsToDelete.length," feedback sessions in the "),V.Cb(5),V.sc("ngForOf",s.sessionsToDelete))},directives:[o.t],styles:[""]}),e})();var A=i("Uqoa"),P=i("Pvcr"),H=i("MbNv"),_=i("YxrJ"),j=i("iRmZ"),q=i("++8I"),U=i("I8MS"),K=i("eQqG"),G=i("ax2R"),X=i("vKUq"),z=i("Babz"),Z=i("Lcal"),Y=i("W872"),J=i("chhc"),$=i("H5dr"),ee=i("kwSR");function se(e,s){1&e&&(V.Wb(0,"div",10),V.Qc(1," You have not created any courses yet, or you have no active courses. Go "),V.Wb(2,"a",11),V.Qc(3,"here"),V.Vb(),V.Qc(4," to create or unarchive a course.\n"),V.Vb())}function ie(e,s){if(1&e){const e=V.Xb();V.Wb(0,"div"),V.Wb(1,"tm-session-edit-form",12),V.ic("modelChange",(function(s){return V.Fc(e),V.kc(2).sessionEditFormModel=s}))("addNewSessionEvent",(function(){return V.Fc(e),V.kc(2).addNewSessionHandler()}))("copyOtherSessionsEvent",(function(){return V.Fc(e),V.kc(2).copyFromOtherSessionsHandler()}))("closeEditFormEvent",(function(){return V.Fc(e),V.kc(2).isSessionEditFormExpanded=!1})),V.Vb(),V.Vb()}if(2&e){const e=V.kc(2);V.Cb(1),V.sc("formMode",e.SessionEditFormMode.ADD)("model",e.sessionEditFormModel)("courseCandidates",e.courseCandidates)("templateSessions",e.templateSessions)}}function oe(e,s){if(1&e&&(V.Wb(0,"div",5),V.Oc(1,ie,2,4,"div",6),V.Vb()),2&e){const e=V.kc();V.sc("@collapseAnim",void 0),V.Cb(1),V.sc("tmIsLoading",e.isCopyOtherSessionLoading)}}function ne(e,s){1&e&&(V.Wb(0,"div",15),V.Qc(1," You have not created any sessions yet. Use the form above to create a session. "),V.Vb())}const te=function(e){return[e]};function ae(e,s){if(1&e){const e=V.Xb();V.Wb(0,"tm-sessions-table",16),V.ic("sortSessionsTableRowModelsEvent",(function(s){return V.Fc(e),V.kc(2).sortSessionsTableRowModelsEvent(s)}))("loadResponseRateEvent",(function(s){return V.Fc(e),V.kc(2).loadResponseRateEventHandler(s)}))("editSessionEvent",(function(s){return V.Fc(e),V.kc(2).editSessionEventHandler(s)}))("moveSessionToRecycleBinEvent",(function(s){return V.Fc(e),V.kc(2).moveSessionToRecycleBinEventHandler(s)}))("copySessionEvent",(function(s){return V.Fc(e),V.kc(2).copySessionEventHandler(s)}))("submitSessionAsInstructorEvent",(function(s){return V.Fc(e),V.kc(2).submitSessionAsInstructorEventHandler(s)}))("viewSessionResultEvent",(function(s){return V.Fc(e),V.kc(2).viewSessionResultEventHandler(s)}))("publishSessionEvent",(function(s){return V.Fc(e),V.kc(2).publishSessionEventHandler(s)}))("unpublishSessionEvent",(function(s){return V.Fc(e),V.kc(2).unpublishSessionEventHandler(s)}))("downloadSessionResultsEvent",(function(s){return V.Fc(e),V.kc(2).downloadSessionResultEventHandler(s)}))("resendResultsLinkToStudentsEvent",(function(s){V.Fc(e);const i=V.kc(2);return i.resendResultsLinkToRespondentsEventHandler(i.sessionsTableRowModels[s])}))("sendRemindersToStudentsEvent",(function(s){V.Fc(e);const i=V.kc(2);return i.sendRemindersToRespondentsEventHandler(i.sessionsTableRowModels[s])})),V.Vb()}if(2&e){const e=V.kc(2);V.sc("sessionsTableRowModels",e.sessionsTableRowModels)("sessionsTableRowModelsSortBy",e.sessionsTableRowModelsSortBy)("sessionsTableRowModelsSortOrder",e.sessionsTableRowModelsSortOrder)("courseCandidates",e.courseCandidates)("columnsToShow",V.wc(6,te,e.SessionsTableColumn.COURSE_ID))("headerColorScheme",e.SessionsTableHeaderColorScheme.BLUE)}}function ce(e,s){if(1&e&&(V.Wb(0,"div"),V.Oc(1,ne,2,0,"div",13),V.Oc(2,ae,1,8,"tm-sessions-table",14),V.Vb()),2&e){const e=V.kc();V.Cb(1),V.sc("ngIf",0===e.sessionsTableRowModels.length&&!e.isFeedbackSessionsLoading),V.Cb(1),V.sc("tmIsLoading",e.isFeedbackSessionsLoading)}}function re(e,s){if(1&e){const e=V.Xb();V.Wb(0,"tm-sessions-recycle-bin-table",17),V.ic("restoreSessionEvent",(function(s){return V.Fc(e),V.kc().restoreRecycleBinFeedbackSession(s)}))("restoreAllRecycleBinFeedbackSessionEvent",(function(){return V.Fc(e),V.kc().restoreAllRecycleBinFeedbackSession()}))("permanentlyDeleteSessionEvent",(function(s){return V.Fc(e),V.kc().permanentDeleteSession(s)}))("permanentDeleteAllSessionsEvent",(function(){return V.Fc(e),V.kc().permanentDeleteAllSessions()}))("sortRecycleBinFeedbackSessionRowsEvent",(function(s){return V.Fc(e),V.kc().sortRecycleBinFeedbackSessionRowsEvent(s)}))("recycleBinExpandEvent",(function(){V.Fc(e);const s=V.kc();return s.isRecycleBinExpanded=!s.isRecycleBinExpanded})),V.Vb()}if(2&e){const e=V.kc();V.sc("isRecycleBinExpanded",e.isRecycleBinExpanded)("recycleBinFeedbackSessionRowModels",e.recycleBinFeedbackSessionRowModels)("recycleBinFeedbackSessionRowModelsSortBy",e.recycleBinFeedbackSessionRowModelsSortBy)("recycleBinFeedbackSessionRowModelsSortOrder",e.recycleBinFeedbackSessionRowModelsSortOrder)}}const de=[{path:"",component:(()=>{class e extends B.a{constructor(e,s,i,o,n,t,a,c,r,d,l,b,u,h){super(e,c,s,i,o,n,r,t,d,l,a),this.courseService=b,this.route=u,this.timezoneService=h,this.SortBy=M.a,this.SortOrder=M.b,this.SessionEditFormMode=w.a,this.SessionsTableColumn=T.a,this.SessionsTableHeaderColorScheme=T.b,this.courseId="",this.courseCandidates=[],this.templateSessions=[],this.sessionEditFormModel={courseId:"",timeZone:"UTC",courseName:"",feedbackSessionName:"",instructions:"Please answer all the given questions.",submissionStartTime:{hour:23,minute:59},submissionStartDate:{year:0,month:0,day:0},submissionEndTime:{hour:23,minute:59},submissionEndDate:{year:0,month:0,day:0},gracePeriod:15,sessionVisibleSetting:R.o.AT_OPEN,customSessionVisibleTime:{hour:23,minute:59},customSessionVisibleDate:{year:0,month:0,day:0},responseVisibleSetting:R.n.LATER,customResponseVisibleTime:{hour:23,minute:59},customResponseVisibleDate:{year:0,month:0,day:0},submissionStatus:R.f.OPEN,publishStatus:R.e.NOT_PUBLISHED,isClosingEmailEnabled:!0,isPublishedEmailEnabled:!0,templateSessionName:"",isSaving:!1,isEditable:!0,isDeleting:!1,isCopying:!1,hasVisibleSettingsPanelExpanded:!1,hasEmailSettingsPanelExpanded:!1},this.isSessionEditFormExpanded=!1,this.sessionsTableRowModels=[],this.sessionsTableRowModelsSortBy=M.a.NONE,this.sessionsTableRowModelsSortOrder=M.b.ASC,this.isRecycleBinExpanded=!1,this.recycleBinFeedbackSessionRowModels=[],this.recycleBinFeedbackSessionRowModelsSortBy=M.a.NONE,this.recycleBinFeedbackSessionRowModelsSortOrder=M.b.ASC,this.isCopyOtherSessionLoading=!1,this.isCoursesLoading=!0,this.isFeedbackSessionsLoading=!0,this.isMoveToRecycleBinLoading=!1,this.isCopySessionLoading=!1,this.isRecycleBinLoading=!0,this.isRestoreFeedbackSessionLoading=!1,this.isPermanentDeleteLoading=!1,this.hasCourseLoadingFailed=!1,this.hasFeedbackSessionLoadingFailed=!1}ngOnInit(){this.route.queryParams.subscribe(e=>{this.courseId=e.courseid}),this.isSessionEditFormExpanded=!!this.courseId,this.templateSessions=this.feedbackSessionsService.getTemplateSessions(),this.loadCandidatesCourse(),this.loadFeedbackSessions(),this.loadRecycleBinFeedbackSessions()}copyFromOtherSessionsHandler(){this.isCopyOtherSessionLoading=!0;const e=this.ngbModal.open(N);e.componentInstance.copyToCourseId=this.sessionEditFormModel.courseId,e.componentInstance.courseCandidates=this.courseCandidates,e.componentInstance.existingFeedbackSession=this.sessionsTableRowModels.map(e=>e.feedbackSession),e.result.then(e=>{this.copyFeedbackSession(e.fromFeedbackSession,e.newFeedbackSessionName,e.copyToCourseId).pipe(Object(g.a)(()=>this.isCopyOtherSessionLoading=!1)).subscribe(e=>{this.navigationService.navigateWithSuccessMessage(this.router,"/web/instructor/sessions/edit","The feedback session has been copied. Please modify settings/questions as necessary.",{courseid:e.courseId,fsname:e.feedbackSessionName})},e=>{this.statusMessageService.showErrorToast(e.error.message)})})}loadCandidatesCourse(){this.isCoursesLoading=!0,this.courseService.getInstructorCoursesThatAreActive().pipe(Object(g.a)(()=>this.isCoursesLoading=!1)).subscribe(e=>{this.courseCandidates=e.courses,this.initDefaultValuesForSessionEditForm()},e=>{this.resetAllModels(),this.hasCourseLoadingFailed=!0,this.statusMessageService.showErrorToast(e.error.message)})}initDefaultValuesForSessionEditForm(){const e=this.courseCandidates.find(e=>e.courseId===this.courseId);e?(this.sessionEditFormModel.courseId=e.courseId,this.sessionEditFormModel.courseName=e.courseName,this.sessionEditFormModel.timeZone=e.timeZone):0!==this.courseCandidates.length&&(this.sessionEditFormModel.courseId=this.courseCandidates[0].courseId,this.sessionEditFormModel.courseName=this.courseCandidates[0].courseName,this.sessionEditFormModel.timeZone=this.courseCandidates[0].timeZone),0!==this.templateSessions.length&&(this.sessionEditFormModel.templateSessionName=this.templateSessions[0].name);const s=m()().add(1,"hours");this.sessionEditFormModel.submissionStartDate={year:s.year(),month:s.month()+1,day:s.date()},this.sessionEditFormModel.submissionStartTime={minute:0===s.hour()?59:0,hour:0===s.hour()?23:s.hour()};const i=m()().add(1,"days");this.sessionEditFormModel.submissionEndDate={year:i.year(),month:i.month()+1,day:i.date()},this.sessionEditFormModel.submissionEndTime={minute:59,hour:23}}addNewSessionHandler(){this.sessionEditFormModel.isSaving=!0;const e=[];Object(S.a)([this.resolveLocalDateTime(this.sessionEditFormModel.submissionStartDate,this.sessionEditFormModel.submissionStartTime,this.sessionEditFormModel.timeZone,"Submission opening time",e),this.resolveLocalDateTime(this.sessionEditFormModel.submissionEndDate,this.sessionEditFormModel.submissionEndTime,this.sessionEditFormModel.timeZone,"Submission closing time",e),this.sessionEditFormModel.sessionVisibleSetting===R.o.CUSTOM?this.resolveLocalDateTime(this.sessionEditFormModel.customSessionVisibleDate,this.sessionEditFormModel.customSessionVisibleTime,this.sessionEditFormModel.timeZone,"Session visible time",e):Object(p.a)(0),this.sessionEditFormModel.responseVisibleSetting===R.n.CUSTOM?this.resolveLocalDateTime(this.sessionEditFormModel.customResponseVisibleDate,this.sessionEditFormModel.customResponseVisibleTime,this.sessionEditFormModel.timeZone,"Response visible time",e):Object(p.a)(0)]).pipe(Object(v.a)(e=>this.feedbackSessionsService.createFeedbackSession(this.sessionEditFormModel.courseId,{feedbackSessionName:this.sessionEditFormModel.feedbackSessionName,instructions:this.sessionEditFormModel.instructions,submissionStartTimestamp:e[0],submissionEndTimestamp:e[1],gracePeriod:this.sessionEditFormModel.gracePeriod,sessionVisibleSetting:this.sessionEditFormModel.sessionVisibleSetting,customSessionVisibleTimestamp:e[2],responseVisibleSetting:this.sessionEditFormModel.responseVisibleSetting,customResponseVisibleTimestamp:e[3],isClosingEmailEnabled:this.sessionEditFormModel.isClosingEmailEnabled,isPublishedEmailEnabled:this.sessionEditFormModel.isPublishedEmailEnabled}))).subscribe(s=>{const i=this.feedbackSessionsService.getTemplateSessions().find(e=>e.name===this.sessionEditFormModel.templateSessionName);i&&Object(p.a)(...i.questions).pipe(Object(f.a)(e=>this.feedbackQuestionsService.createFeedbackQuestion(s.courseId,s.feedbackSessionName,{questionNumber:e.questionNumber,questionBrief:e.questionBrief,questionDescription:e.questionDescription,questionDetails:e.questionDetails,questionType:e.questionType,giverType:e.giverType,recipientType:e.recipientType,numberOfEntitiesToGiveFeedbackToSetting:e.numberOfEntitiesToGiveFeedbackToSetting,customNumberOfEntitiesToGiveFeedbackTo:e.customNumberOfEntitiesToGiveFeedbackTo,showResponsesTo:e.showResponsesTo,showGiverNameTo:e.showGiverNameTo,showRecipientNameTo:e.showRecipientNameTo}))).subscribe(()=>{},e=>{this.sessionEditFormModel.isSaving=!1,this.statusMessageService.showErrorToast("The session is created but the template questions cannot be created: "+e.error.message)},()=>{this.navigationService.navigateByURLWithParamEncoding(this.router,"/web/instructor/sessions/edit",{courseid:s.courseId,fsname:s.feedbackSessionName}).then(()=>{e.forEach(e=>{this.statusMessageService.showWarningToast(e)}),this.statusMessageService.showSuccessToast('The feedback session has been added.Click the "Add New Question" button below to begin adding questions for the feedback session.')})})},e=>{this.sessionEditFormModel.isSaving=!1,this.statusMessageService.showErrorToast(e.error.message)})}resolveLocalDateTime(e,s,i,o,n){const t=m()();t.set("year",e.year),t.set("month",e.month-1),t.set("date",e.day),t.set("hour",s.hour),t.set("minute",s.minute);const a=t.format(y.a);return this.timezoneService.getResolvedTimestamp(a,i,o).pipe(Object(k.a)(e=>{0!==e.message.length&&n.push(e.message)}),Object(E.a)(e=>e.timestamp))}loadFeedbackSessions(){this.isFeedbackSessionsLoading=!0,this.feedbackSessionsService.getFeedbackSessionsForInstructor().pipe(Object(g.a)(()=>this.isFeedbackSessionsLoading=!1)).subscribe(e=>{e.feedbackSessions.forEach(e=>{this.sessionsTableRowModels.push({feedbackSession:e,responseRate:"",isLoadingResponseRate:!1,instructorPrivilege:e.privileges||F.a})})},e=>{this.resetAllModels(),this.hasFeedbackSessionLoadingFailed=!0,this.statusMessageService.showErrorToast(e.error.message)},()=>this.sortSessionsTableRowModelsEvent(M.a.COURSE_ID))}sortSessionsTableRowModelsEvent(e){this.sessionsTableRowModelsSortBy=e,this.sessionsTableRowModelsSortOrder=this.sessionsTableRowModelsSortOrder===M.b.DESC?M.b.ASC:M.b.DESC,this.sessionsTableRowModels.sort(this.sortModelsBy(e,this.sessionsTableRowModelsSortOrder))}sortRecycleBinFeedbackSessionRowsEvent(e){this.recycleBinFeedbackSessionRowModelsSortBy=e,this.recycleBinFeedbackSessionRowModelsSortOrder=this.recycleBinFeedbackSessionRowModelsSortOrder===M.b.DESC?M.b.ASC:M.b.DESC,this.recycleBinFeedbackSessionRowModels.sort(this.sortModelsBy(e,this.recycleBinFeedbackSessionRowModelsSortOrder))}loadResponseRateEventHandler(e){this.loadResponseRate(this.sessionsTableRowModels[e])}editSessionEventHandler(e){this.editSession(this.sessionsTableRowModels[e])}restoreRecycleBinFeedbackSession(e){this.isRestoreFeedbackSessionLoading=!0,this.feedbackSessionsService.deleteSessionFromRecycleBin(e.feedbackSession.courseId,e.feedbackSession.feedbackSessionName).pipe(Object(g.a)(()=>this.isRestoreFeedbackSessionLoading=!1)).subscribe(s=>{this.recycleBinFeedbackSessionRowModels.splice(this.recycleBinFeedbackSessionRowModels.indexOf(e),1),this.sessionsTableRowModels.push({feedbackSession:s,responseRate:"",isLoadingResponseRate:!1,instructorPrivilege:s.privileges||F.a}),this.statusMessageService.showSuccessToast("The feedback session has been restored.")},e=>{this.statusMessageService.showErrorToast(e.error.message)})}moveSessionToRecycleBinEventHandler(e){this.isMoveToRecycleBinLoading=!0;const s=this.sessionsTableRowModels[e];this.feedbackSessionsService.moveSessionToRecycleBin(s.feedbackSession.courseId,s.feedbackSession.feedbackSessionName).pipe(Object(g.a)(()=>this.isMoveToRecycleBinLoading=!1)).subscribe(e=>{this.sessionsTableRowModels.splice(this.sessionsTableRowModels.indexOf(s),1),this.recycleBinFeedbackSessionRowModels.push({feedbackSession:e}),this.statusMessageService.showSuccessToast("The feedback session has been deleted. You can restore it from the deleted sessions table below.")},e=>{this.statusMessageService.showErrorToast(e.error.message)})}copySessionEventHandler(e){this.isCopySessionLoading=!0,this.failedToCopySessions={};const s=this.createSessionCopyRequestsFromRowModel(this.sessionsTableRowModels[e.sessionToCopyRowIndex],e);1===s.length&&this.copySingleSession(s[0]),s.length>1&&Object(S.a)(s).pipe(Object(g.a)(()=>this.isCopySessionLoading=!1)).subscribe(e=>{e.length>0&&e.forEach(e=>{this.sessionsTableRowModels.push({feedbackSession:e,responseRate:"",isLoadingResponseRate:!1,instructorPrivilege:e.privileges||F.a})}),this.showCopyStatusMessage()})}submitSessionAsInstructorEventHandler(e){this.submitSessionAsInstructor(this.sessionsTableRowModels[e])}viewSessionResultEventHandler(e){this.viewSessionResult(this.sessionsTableRowModels[e])}publishSessionEventHandler(e){this.publishSession(this.sessionsTableRowModels[e])}unpublishSessionEventHandler(e){this.unpublishSession(this.sessionsTableRowModels[e])}downloadSessionResultEventHandler(e){this.downloadSessionResult(this.sessionsTableRowModels[e])}loadRecycleBinFeedbackSessions(){this.isRecycleBinLoading=!0,this.feedbackSessionsService.getFeedbackSessionsInRecycleBinForInstructor().pipe(Object(g.a)(()=>this.isRecycleBinLoading=!1)).subscribe(e=>{e.feedbackSessions.forEach(e=>{this.recycleBinFeedbackSessionRowModels.push({feedbackSession:e})})},e=>{this.resetAllModels(),this.hasFeedbackSessionLoadingFailed=!0,this.statusMessageService.showErrorToast(e.error.message)},()=>this.sortRecycleBinFeedbackSessionRowsEvent(M.a.SESSION_DELETION_DATE))}restoreAllRecycleBinFeedbackSession(){this.isRestoreFeedbackSessionLoading=!0;const e=[];this.recycleBinFeedbackSessionRowModels.forEach(s=>{e.push(this.feedbackSessionsService.deleteSessionFromRecycleBin(s.feedbackSession.courseId,s.feedbackSession.feedbackSessionName))}),Object(S.a)(e).pipe(Object(g.a)(()=>this.isRestoreFeedbackSessionLoading=!1)).subscribe(e=>{e.forEach(e=>{this.recycleBinFeedbackSessionRowModels=[],this.sessionsTableRowModels.push({feedbackSession:e,responseRate:"",isLoadingResponseRate:!1,instructorPrivilege:e.privileges||F.a})}),this.statusMessageService.showSuccessToast("All sessions have been restored.")},e=>{this.statusMessageService.showErrorToast(e.error.message)})}permanentDeleteSession(e){this.isPermanentDeleteLoading=!0;const s=this.ngbModal.open(D);s.componentInstance.courseId=e.feedbackSession.courseId,s.componentInstance.feedbackSessionName=e.feedbackSession.feedbackSessionName,s.result.then(()=>{this.feedbackSessionsService.deleteFeedbackSession(e.feedbackSession.courseId,e.feedbackSession.feedbackSessionName).pipe(Object(g.a)(()=>this.isPermanentDeleteLoading=!1)).subscribe(()=>{this.recycleBinFeedbackSessionRowModels.splice(this.recycleBinFeedbackSessionRowModels.indexOf(e),1),this.statusMessageService.showSuccessToast("The feedback session has been permanently deleted.")},e=>{this.statusMessageService.showErrorToast(e.error.message)})})}permanentDeleteAllSessions(){this.isPermanentDeleteLoading=!0;const e=this.ngbModal.open(Q);e.componentInstance.sessionsToDelete=this.recycleBinFeedbackSessionRowModels.map(e=>e.feedbackSession),e.result.then(()=>{const e=[];this.recycleBinFeedbackSessionRowModels.forEach(s=>{e.push(this.feedbackSessionsService.deleteFeedbackSession(s.feedbackSession.courseId,s.feedbackSession.feedbackSessionName))}),Object(S.a)(e).pipe(Object(g.a)(()=>this.isPermanentDeleteLoading=!1)).subscribe(()=>{this.recycleBinFeedbackSessionRowModels=[],this.statusMessageService.showSuccessToast("All sessions have been permanently deleted.")},e=>{this.statusMessageService.showErrorToast(e.error.message)})})}retryLoadingAllData(){this.hasFeedbackSessionLoadingFailed=!1,this.hasCourseLoadingFailed=!1,this.loadCandidatesCourse(),this.loadFeedbackSessions(),this.loadRecycleBinFeedbackSessions()}resetAllModels(){this.courseCandidates=[],this.sessionsTableRowModels=[],this.recycleBinFeedbackSessionRowModels=[]}}return e.\u0275fac=function(s){return new(s||e)(V.Qb(t.d),V.Qb(A.a),V.Qb(P.a),V.Qb(H.a),V.Qb(_.a),V.Qb(I.m),V.Qb(j.a),V.Qb(q.a),V.Qb(U.a),V.Qb(K.a),V.Qb(G.a),V.Qb(X.a),V.Qb(t.a),V.Qb(y.b))},e.\u0275cmp=V.Kb({type:e,selectors:[["tm-instructor-sessions-page"]],features:[V.zb],decls:16,vars:7,consts:[["class","alert alert-warning","role","alert",4,"ngIf"],["id","btn-add-session",1,"btn","btn-success",3,"disabled","click"],[1,"fas","fa-plus"],["class","margin-top-30px",4,"ngIf"],[3,"shouldShowRetry","message","retryEvent"],[1,"margin-top-30px"],[4,"tmIsLoading"],[1,"row"],[1,"col-12","text-muted"],[3,"isRecycleBinExpanded","recycleBinFeedbackSessionRowModels","recycleBinFeedbackSessionRowModelsSortBy","recycleBinFeedbackSessionRowModelsSortOrder","restoreSessionEvent","restoreAllRecycleBinFeedbackSessionEvent","permanentlyDeleteSessionEvent","permanentDeleteAllSessionsEvent","sortRecycleBinFeedbackSessionRowsEvent","recycleBinExpandEvent",4,"tmIsLoading"],["role","alert",1,"alert","alert-warning"],["tmRouterLink","/web/instructor/courses"],[3,"formMode","model","courseCandidates","templateSessions","modelChange","addNewSessionEvent","copyOtherSessionsEvent","closeEditFormEvent"],["class","alert alert-warning margin-top-30px","role","alert",4,"ngIf"],[3,"sessionsTableRowModels","sessionsTableRowModelsSortBy","sessionsTableRowModelsSortOrder","courseCandidates","columnsToShow","headerColorScheme","sortSessionsTableRowModelsEvent","loadResponseRateEvent","editSessionEvent","moveSessionToRecycleBinEvent","copySessionEvent","submitSessionAsInstructorEvent","viewSessionResultEvent","publishSessionEvent","unpublishSessionEvent","downloadSessionResultsEvent","resendResultsLinkToStudentsEvent","sendRemindersToStudentsEvent",4,"tmIsLoading"],["role","alert",1,"alert","alert-warning","margin-top-30px"],[3,"sessionsTableRowModels","sessionsTableRowModelsSortBy","sessionsTableRowModelsSortOrder","courseCandidates","columnsToShow","headerColorScheme","sortSessionsTableRowModelsEvent","loadResponseRateEvent","editSessionEvent","moveSessionToRecycleBinEvent","copySessionEvent","submitSessionAsInstructorEvent","viewSessionResultEvent","publishSessionEvent","unpublishSessionEvent","downloadSessionResultsEvent","resendResultsLinkToStudentsEvent","sendRemindersToStudentsEvent"],[3,"isRecycleBinExpanded","recycleBinFeedbackSessionRowModels","recycleBinFeedbackSessionRowModelsSortBy","recycleBinFeedbackSessionRowModelsSortOrder","restoreSessionEvent","restoreAllRecycleBinFeedbackSessionEvent","permanentlyDeleteSessionEvent","permanentDeleteAllSessionsEvent","sortRecycleBinFeedbackSessionRowsEvent","recycleBinExpandEvent"]],template:function(e,s){1&e&&(V.Oc(0,se,5,0,"div",0),V.Wb(1,"div"),V.Wb(2,"button",1),V.ic("click",(function(){return s.isSessionEditFormExpanded=!0})),V.Rb(3,"i",2),V.Qc(4," Add New Feedback Session "),V.Vb(),V.Vb(),V.Oc(5,oe,2,2,"div",3),V.Wb(6,"tm-loading-retry",4),V.ic("retryEvent",(function(){return s.retryLoadingAllData()})),V.Wb(7,"div",5),V.Oc(8,ce,3,2,"div",6),V.Vb(),V.Rb(9,"br"),V.Wb(10,"div",7),V.Wb(11,"div",8),V.Wb(12,"p"),V.Qc(13," Note: The table above doesn't contain sessions from archived courses and soft-deleted courses. To view sessions from an archived course, unarchive the course first; to view sessions from a course in recycle bin, restore the course first. "),V.Vb(),V.Vb(),V.Vb(),V.Wb(14,"div",5),V.Oc(15,re,1,4,"tm-sessions-recycle-bin-table",9),V.Vb(),V.Vb()),2&e&&(V.sc("ngIf",!s.isCoursesLoading&&0===s.courseCandidates.length&&!s.hasCourseLoadingFailed),V.Cb(2),V.sc("disabled",s.isSessionEditFormExpanded||s.isCoursesLoading),V.Cb(3),V.sc("ngIf",s.isSessionEditFormExpanded&&!s.isCoursesLoading),V.Cb(1),V.sc("shouldShowRetry",s.hasCourseLoadingFailed||s.hasFeedbackSessionLoadingFailed)("message","Failed to load data"),V.Cb(2),V.sc("tmIsLoading",s.isCoursesLoading||s.isMoveToRecycleBinLoading||s.isCopySessionLoading||s.isSendReminderLoading||s.isResultActionLoading),V.Cb(7),V.sc("tmIsLoading",s.isRecycleBinLoading||s.isRestoreFeedbackSessionLoading||s.isPermanentDeleteLoading))},directives:[o.u,z.a,Z.a,Y.a,J.a,$.a,ee.a],styles:[".margin-top-30px[_ngcontent-%COMP%]{margin-top:30px}.sortable-header[_ngcontent-%COMP%]{cursor:pointer}.actions-cell[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:2px}"],data:{animation:[C.a]}}),e})()}];let le=(()=>{class e{}return e.\u0275mod=V.Ob({type:e}),e.\u0275inj=V.Nb({factory:function(s){return new(s||e)},imports:[[o.c,r.a,b.a,n.j,l.a,d.a,t.h.forChild(de),c.a,a.a,u.a]]}),e})()},QlvD:function(e,s,i){"use strict";i.d(s,"a",(function(){return b}));var o=i("fXoL"),n=i("8xKp"),t=i("Wuvc"),a=i("ofXK"),c=i("fB2i"),r=i("3Pt+");const d=function(e){return{"editor-disabled":e}};function l(e,s){if(1&e){const e=o.Xb();o.Wb(0,"editor",2),o.ic("ngModelChange",(function(s){return o.Fc(e),o.kc().richTextChange.emit(s)})),o.Vb()}if(2&e){const e=o.kc();o.sc("ngClass",o.wc(5,d,e.isDisabled))("init",e.init)("disabled",e.isDisabled)("ngModel",e.richText),o.Db("placeholder",e.placeholderText)}}let b=(()=>{class e{constructor(){this.isDisabled=!1,this.minHeightInPx=150,this.placeholderText="",this.richText="",this.richTextChange=new o.n,this.init={},this.render=!1}ngOnInit(){this.init=this.getEditorSettings()}getEditorSettings(){return{base_url:n.a,skin_url:n.a+"/skins/ui/oxide",content_css:"/assets/tinymce/tinymce.css",suffix:".min",height:this.minHeightInPx,resize:!0,inline:!1,relative_urls:!1,convert_urls:!1,remove_linebreaks:!1,placeholder:this.placeholderText,plugins:["advlist autolink autoresize lists link image charmap hr anchor","searchreplace wordcount visualblocks visualchars code","insertdatetime nonbreaking save table directionality","emoticons paste textpattern"],menubar:!1,autoresize_bottom_margin:50,toolbar1:"styleselect | forecolor backcolor | bold italic underline strikethrough subscript superscript | alignleft aligncenter alignright alignjustify | bullist numlist | link image charmap emoticons"}}renderEditor(e){e.visible&&(this.render=!0)}}return e.\u0275fac=function(s){return new(s||e)},e.\u0275cmp=o.Kb({type:e,selectors:[["tm-rich-text-editor"]],inputs:{isDisabled:"isDisabled",minHeightInPx:"minHeightInPx",placeholderText:"placeholderText",richText:"richText"},outputs:{richTextChange:"richTextChange"},decls:2,vars:1,consts:[["inViewport","",3,"inViewportAction"],["class","editor",3,"ngClass","init","disabled","ngModel","ngModelChange",4,"ngIf"],[1,"editor",3,"ngClass","init","disabled","ngModel","ngModelChange"]],template:function(e,s){1&e&&(o.Wb(0,"div",0),o.ic("inViewportAction",(function(e){return s.renderEditor(e)})),o.Oc(1,l,1,7,"editor",1),o.Vb()),2&e&&(o.Cb(1),o.sc("ngIf",s.render))},directives:[t.a,a.u,c.a,a.r,r.p,r.s],styles:[".editor[_ngcontent-%COMP%]{background-color:#fff}.editor-disabled[_ngcontent-%COMP%]{background-color:#e9ecef;opacity:1}.editor-disabled[_ngcontent-%COMP%]     .tox-tinymce{opacity:.5}.placeholder[_ngcontent-%COMP%]{padding:.375rem .75rem;position:absolute}"]}),e})()}}]);