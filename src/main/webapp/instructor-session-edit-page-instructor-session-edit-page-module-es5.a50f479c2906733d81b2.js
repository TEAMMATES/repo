function _createForOfIteratorHelper(e,t){var i;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(i=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var s=0,n=function(){};return{s:n,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,r=!0,a=!1;return{s:function(){i=e[Symbol.iterator]()},n:function(){var e=i.next();return r=e.done,e},e:function(e){a=!0,o=e},f:function(){try{r||null==i.return||i.return()}finally{if(a)throw o}}}}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,s=new Array(t);i<t;i++)s[i]=e[i];return s}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var i,s=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;i=Reflect.construct(s,arguments,n)}else i=s.apply(this,arguments);return _possibleConstructorReturn(this,i)}}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{QlvD:function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));var s=i("fXoL"),n=i("8xKp"),o=i("Wuvc"),r=i("ofXK"),a=i("fB2i"),c=i("3Pt+"),u=function(e){return{"editor-disabled":e}};function d(e,t){if(1&e){var i=s.Xb();s.Wb(0,"editor",2),s.ic("ngModelChange",(function(e){return s.Fc(i),s.kc().richTextChange.emit(e)})),s.Vb()}if(2&e){var n=s.kc();s.sc("ngClass",s.wc(5,u,n.isDisabled))("init",n.init)("disabled",n.isDisabled)("ngModel",n.richText),s.Db("placeholder",n.placeholderText)}}var l=function(){var e=function(){function e(){_classCallCheck(this,e),this.isDisabled=!1,this.minHeightInPx=150,this.placeholderText="",this.richText="",this.richTextChange=new s.n,this.init={},this.render=!1}return _createClass(e,[{key:"ngOnInit",value:function(){this.init=this.getEditorSettings()}},{key:"getEditorSettings",value:function(){return{base_url:n.a,skin_url:n.a+"/skins/ui/oxide",content_css:"/assets/tinymce/tinymce.css",suffix:".min",height:this.minHeightInPx,resize:!0,inline:!1,relative_urls:!1,convert_urls:!1,remove_linebreaks:!1,placeholder:this.placeholderText,plugins:["advlist autolink autoresize lists link image charmap hr anchor","searchreplace wordcount visualblocks visualchars code","insertdatetime nonbreaking save table directionality","emoticons paste textpattern"],menubar:!1,autoresize_bottom_margin:50,toolbar1:"styleselect | forecolor backcolor | bold italic underline strikethrough subscript superscript | alignleft aligncenter alignright alignjustify | bullist numlist | link image charmap emoticons"}}},{key:"renderEditor",value:function(e){e.visible&&(this.render=!0)}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=s.Kb({type:e,selectors:[["tm-rich-text-editor"]],inputs:{isDisabled:"isDisabled",minHeightInPx:"minHeightInPx",placeholderText:"placeholderText",richText:"richText"},outputs:{richTextChange:"richTextChange"},decls:2,vars:1,consts:[["inViewport","",3,"inViewportAction"],["class","editor",3,"ngClass","init","disabled","ngModel","ngModelChange",4,"ngIf"],[1,"editor",3,"ngClass","init","disabled","ngModel","ngModelChange"]],template:function(e,t){1&e&&(s.Wb(0,"div",0),s.ic("inViewportAction",(function(e){return t.renderEditor(e)})),s.Oc(1,d,1,7,"editor",1),s.Vb()),2&e&&(s.Cb(1),s.sc("ngIf",t.render))},directives:[o.a,r.u,a.a,r.r,c.p,c.s],styles:[".editor[_ngcontent-%COMP%]{background-color:#fff}.editor-disabled[_ngcontent-%COMP%]{background-color:#e9ecef;opacity:1}.editor-disabled[_ngcontent-%COMP%]     .tox-tinymce{opacity:.5}.placeholder[_ngcontent-%COMP%]{padding:.375rem .75rem;position:absolute}"]}),e}()},RMfs:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var s=i("R8lv"),n=i("fXoL"),o=function(){var e=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"transform",value:function(e){switch(e){case s.d.MCQ:return"Multiple-choice (single answer) question";case s.d.CONTRIB:return"Team contribution question";case s.d.TEXT:return"Essay question";case s.d.NUMSCALE:return"Numerical-scale question";case s.d.MSQ:return"Multiple-choice (multiple answers) question";case s.d.RANK_OPTIONS:return"Rank (options) question";case s.d.RANK_RECIPIENTS:return"Rank (recipients) question";case s.d.RUBRIC:return"Rubric question";case s.d.CONSTSUM_OPTIONS:return"Distribute points (among options) question";case s.d.CONSTSUM_RECIPIENTS:return"Distribute points (among recipients) question";default:return"Unknown"}}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275pipe=n.Pb({name:"questionTypeName",type:e,pure:!0}),e}()},RPsU:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var s=i("ofXK"),n=i("fXoL"),o=function(){var e=function e(){_classCallCheck(this,e)};return e.\u0275mod=n.Ob({type:e}),e.\u0275inj=n.Nb({factory:function(t){return new(t||e)},imports:[[s.c]]}),e}()},UGSt:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var s=i("fXoL"),n=function(){var e=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"transform",value:function(e){return Object.keys(e).map((function(t){return e[t]}))}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275pipe=s.Pb({name:"enumToArray",type:e,pure:!0}),e}()},ovlq:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var s=i("R8lv"),n=i("fXoL"),o=function(){var e=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"transform",value:function(e){switch(e){case s.c.STUDENTS:return"students";case s.c.STUDENTS_EXCLUDING_SELF:return"students (excluding self)";case s.c.TEAMS:return"teams";case s.c.TEAMS_EXCLUDING_SELF:return"teams (excluding own team)";case s.c.OWN_TEAM_MEMBERS_INCLUDING_SELF:return"team members";case s.c.OWN_TEAM_MEMBERS:return"team members (excluding self)";case s.c.INSTRUCTORS:return"instructors";default:return"unknown"}}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275pipe=n.Pb({name:"generatedChoice",type:e,pure:!0}),e}()},vqVA:function(e,t,i){"use strict";i.r(t),i.d(t,"InstructorSessionEditPageModule",(function(){return xe}));var s=i("ofXK"),n=i("3Pt+"),o=i("tyNb"),r=i("1kSV"),a=i("n6pr"),c=i("1GcU"),u=i("mYbV"),d=i("aSpy"),l=i("GXA2"),b=i("qVc+"),m=i("SEFB"),f=i("TOej"),p=i("pjmv"),h=i.n(p),g=i("cp0P"),v=i("LRne"),S=i("nYR2"),T=i("eIep"),E=i("vkgz"),y=i("lJxs"),k=i("bOdf"),C=i("5+tZ"),F=i("A3DQ"),M=i("R8lv"),w=i("9jjE"),O=i("7qkN"),Q=i("84gB"),q=i("ZpFW"),N=i("G/Uz"),I=i("/Tzu"),R=i("BBzn"),_=i("p6cw"),V=i("fXoL"),P=i("I8MS"),D=i("RMfs");function A(e,t){1&e&&V.Rb(0,"i",16)}function x(e,t){1&e&&V.Rb(0,"i",17)}function W(e,t){1&e&&V.Rb(0,"i",16)}function B(e,t){1&e&&V.Rb(0,"i",17)}function G(e,t){1&e&&V.Rb(0,"i",16)}function L(e,t){1&e&&V.Rb(0,"i",17)}function j(e,t){1&e&&V.Rb(0,"i",16)}function U(e,t){1&e&&V.Rb(0,"i",17)}function H(e,t){if(1&e){var i=V.Xb();V.Wb(0,"tr"),V.Wb(1,"td"),V.Wb(2,"input",18),V.ic("ngModelChange",(function(e){return V.Fc(i),t.$implicit.isSelected=e})),V.Vb(),V.Vb(),V.Wb(3,"td"),V.Qc(4),V.Vb(),V.Wb(5,"td"),V.Qc(6),V.Vb(),V.Wb(7,"td"),V.Qc(8),V.lc(9,"questionTypeName"),V.Vb(),V.Wb(10,"td"),V.Qc(11),V.Vb(),V.Vb()}if(2&e){var s=t.$implicit;V.Cb(2),V.sc("ngModel",s.isSelected),V.Cb(2),V.Rc(s.courseId),V.Cb(2),V.Rc(s.feedbackSessionName),V.Cb(2),V.Rc(V.mc(9,5,s.question.questionType)),V.Cb(3),V.Rc(s.question.questionBrief)}}var X,z=((X=function(){function e(t,i){_classCallCheck(this,e),this.activeModal=t,this.tableComparatorService=i,this.SortBy=_.a,this.SortOrder=_.b,this.questionToCopyCandidates=[],this.candidatesSortBy=_.a.NONE,this.candidatesSortOrder=_.b.ASC}return _createClass(e,[{key:"ngOnInit",value:function(){}},{key:"getSelectedQuestions",value:function(){return this.questionToCopyCandidates.filter((function(e){return e.isSelected})).map((function(e){return e.question}))}},{key:"sortQuestionToCopyCandidates",value:function(e){this.candidatesSortBy=e,this.candidatesSortOrder=this.candidatesSortOrder===_.b.DESC?_.b.ASC:_.b.DESC,this.questionToCopyCandidates.sort(this.sortCandidatesBy(e,this.candidatesSortOrder))}},{key:"sortCandidatesBy",value:function(e,t){var i=this;return function(s,n){var o,r;switch(e){case _.a.SESSION_NAME:o=s.feedbackSessionName,r=n.feedbackSessionName;break;case _.a.COURSE_ID:o=s.courseId,r=n.courseId;break;case _.a.QUESTION_TYPE:o=String(s.question.questionType),r=String(n.question.questionType);break;case _.a.QUESTION_TEXT:o=s.question.questionBrief,r=n.question.questionBrief;break;default:o="",r=""}return i.tableComparatorService.compare(e,t,o,r)}}},{key:"hasAnyQuestionsToCopySelected",get:function(){return void 0!==this.questionToCopyCandidates.find((function(e){return e.isSelected}))}}]),e}()).\u0275fac=function(e){return new(e||X)(V.Qb(r.a),V.Qb(P.a))},X.\u0275cmp=V.Kb({type:X,selectors:[["tm-copy-questions-from-other-sessions-modal"]],decls:43,vars:10,consts:[[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],["id","copy-question-modal",1,"modal-body"],[1,"table","table-bordered","table-responsive-lg"],[1,"bg-primary","text-white"],[1,"sortable-header",3,"click"],[1,"fa-stack"],[1,"fas","fa-sort"],["class","fas fa-sort-down",4,"ngIf"],["class","fas fa-sort-up",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"modal-footer"],["id","btn-confirm-copy-question","type","button",1,"btn","btn-primary",3,"disabled","click"],["type","button",1,"btn","btn-light",3,"click"],[1,"fas","fa-sort-down"],[1,"fas","fa-sort-up"],["type","checkbox",1,"form-control",3,"ngModel","ngModelChange"]],template:function(e,t){1&e&&(V.Wb(0,"div",0),V.Wb(1,"h4",1),V.Qc(2,"Copy Questions"),V.Vb(),V.Wb(3,"button",2),V.ic("click",(function(){return t.activeModal.dismiss()})),V.Wb(4,"span",3),V.Qc(5,"\xd7"),V.Vb(),V.Vb(),V.Vb(),V.Wb(6,"div",4),V.Wb(7,"table",5),V.Wb(8,"thead",6),V.Wb(9,"tr"),V.Wb(10,"th"),V.Qc(11,"#"),V.Vb(),V.Wb(12,"th",7),V.ic("click",(function(){return t.sortQuestionToCopyCandidates(t.SortBy.COURSE_ID)})),V.Qc(13," Course ID "),V.Wb(14,"span",8),V.Rb(15,"i",9),V.Oc(16,A,1,0,"i",10),V.Oc(17,x,1,0,"i",11),V.Vb(),V.Vb(),V.Wb(18,"th",7),V.ic("click",(function(){return t.sortQuestionToCopyCandidates(t.SortBy.SESSION_NAME)})),V.Qc(19," Session Name "),V.Wb(20,"span",8),V.Rb(21,"i",9),V.Oc(22,W,1,0,"i",10),V.Oc(23,B,1,0,"i",11),V.Vb(),V.Vb(),V.Wb(24,"th",7),V.ic("click",(function(){return t.sortQuestionToCopyCandidates(t.SortBy.QUESTION_TYPE)})),V.Qc(25," Question Type "),V.Wb(26,"span",8),V.Rb(27,"i",9),V.Oc(28,G,1,0,"i",10),V.Oc(29,L,1,0,"i",11),V.Vb(),V.Vb(),V.Wb(30,"th",7),V.ic("click",(function(){return t.sortQuestionToCopyCandidates(t.SortBy.QUESTION_TEXT)})),V.Qc(31," Question Text "),V.Wb(32,"span",8),V.Rb(33,"i",9),V.Oc(34,j,1,0,"i",10),V.Oc(35,U,1,0,"i",11),V.Vb(),V.Vb(),V.Vb(),V.Vb(),V.Wb(36,"tbody"),V.Oc(37,H,12,7,"tr",12),V.Vb(),V.Vb(),V.Vb(),V.Wb(38,"div",13),V.Wb(39,"button",14),V.ic("click",(function(){return t.activeModal.close(t.getSelectedQuestions())})),V.Qc(40,"Copy"),V.Vb(),V.Wb(41,"button",15),V.ic("click",(function(){return t.activeModal.dismiss()})),V.Qc(42,"Cancel"),V.Vb(),V.Vb()),2&e&&(V.Cb(16),V.sc("ngIf",t.candidatesSortBy===t.SortBy.COURSE_ID&&t.candidatesSortOrder===t.SortOrder.DESC),V.Cb(1),V.sc("ngIf",t.candidatesSortBy===t.SortBy.COURSE_ID&&t.candidatesSortOrder===t.SortOrder.ASC),V.Cb(5),V.sc("ngIf",t.candidatesSortBy===t.SortBy.SESSION_NAME&&t.candidatesSortOrder===t.SortOrder.DESC),V.Cb(1),V.sc("ngIf",t.candidatesSortBy===t.SortBy.SESSION_NAME&&t.candidatesSortOrder===t.SortOrder.ASC),V.Cb(5),V.sc("ngIf",t.candidatesSortBy===t.SortBy.QUESTION_TYPE&&t.candidatesSortOrder===t.SortOrder.DESC),V.Cb(1),V.sc("ngIf",t.candidatesSortBy===t.SortBy.QUESTION_TYPE&&t.candidatesSortOrder===t.SortOrder.ASC),V.Cb(5),V.sc("ngIf",t.candidatesSortBy===t.SortBy.QUESTION_TEXT&&t.candidatesSortOrder===t.SortOrder.DESC),V.Cb(1),V.sc("ngIf",t.candidatesSortBy===t.SortBy.QUESTION_TEXT&&t.candidatesSortOrder===t.SortOrder.ASC),V.Cb(2),V.sc("ngForOf",t.questionToCopyCandidates),V.Cb(2),V.sc("disabled",!t.hasAnyQuestionsToCopySelected))},directives:[s.u,s.t,n.a,n.p,n.s],pipes:[D.a],styles:[".sortable-header[_ngcontent-%COMP%]{cursor:pointer}#copy-question-modal[_ngcontent-%COMP%]{table-layout:auto;margin-bottom:50px}.modal-footer[_ngcontent-%COMP%]{position:fixed;bottom:0;height:50px;width:69.8%;-ms-flex-pack:right;justify-content:right;background-color:#fff}.form-control[_ngcontent-%COMP%]{height:calc(.5em + 1.5vh);width:calc(.5em + 1.5vw)}"]}),X),J=i("JUCI"),Z=i("YxrJ"),K=i("iJt+");function $(e,t){if(1&e&&(V.Wb(0,"div"),V.Wb(1,"div",14),V.Rb(2,"tm-question-edit-form",15),V.Vb(),V.Vb()),2&e){var i=V.kc().$implicit;V.sc("@collapseAnim",void 0),V.Cb(2),V.sc("formModel",i.model)}}function Y(e,t){if(1&e){var i=V.Xb();V.Wb(0,"div",9),V.Wb(1,"div",10),V.ic("click",(function(){var e=t.$implicit;return e.isShowDetails=!e.isShowDetails})),V.Wb(2,"label"),V.Wb(3,"input",11),V.ic("ngModelChange",(function(e){return V.Fc(i),t.$implicit.isSelected=e}))("click",(function(e){return V.Fc(i),e.stopPropagation()})),V.Vb(),V.Vb(),V.Qc(4,"\xa0 "),V.Rb(5,"span",12),V.Vb(),V.Oc(6,$,3,2,"div",13),V.Vb()}if(2&e){var s=t.$implicit;V.Cb(3),V.sc("ngModel",s.isSelected),V.Cb(2),V.sc("innerHTML",s.description,V.Gc),V.Cb(1),V.sc("ngIf",s.isShowDetails)}}var ee,te=((ee=function(){function e(t,i){_classCallCheck(this,e),this.activeModal=t,this.feedbackQuestionsService=i,this.templateQuestionModels=[],this.templateQuestionModels=this.feedbackQuestionsService.getTemplateQuestions().map((function(e){return{description:e.description,isShowDetails:!1,isSelected:!1,model:{feedbackQuestionId:"",questionNumber:e.question.questionNumber,questionBrief:e.question.questionBrief,questionDescription:e.question.questionDescription,isQuestionHasResponses:!1,questionType:e.question.questionType,questionDetails:e.question.questionDetails,giverType:e.question.giverType,recipientType:e.question.recipientType,numberOfEntitiesToGiveFeedbackToSetting:e.question.numberOfEntitiesToGiveFeedbackToSetting,customNumberOfEntitiesToGiveFeedbackTo:e.question.customNumberOfEntitiesToGiveFeedbackTo||1,showResponsesTo:e.question.showResponsesTo,showGiverNameTo:e.question.showGiverNameTo,showRecipientNameTo:e.question.showRecipientNameTo,isEditable:!1,isSaving:!1,isCollapsed:!1,isVisibilityChanged:!1,isFeedbackPathChanged:!1,isQuestionDetailsChanged:!1}}}))}return _createClass(e,[{key:"ngOnInit",value:function(){}},{key:"getSelectedQuestions",value:function(){return this.templateQuestionModels.filter((function(e){return e.isSelected})).map((function(e){return e.model})).map((function(e){return{feedbackQuestionId:"",questionNumber:0,questionBrief:e.questionBrief,questionDescription:e.questionDescription,questionType:e.questionType,questionDetails:e.questionDetails,giverType:e.giverType,recipientType:e.recipientType,numberOfEntitiesToGiveFeedbackToSetting:e.numberOfEntitiesToGiveFeedbackToSetting,customNumberOfEntitiesToGiveFeedbackTo:e.customNumberOfEntitiesToGiveFeedbackTo,showResponsesTo:e.showResponsesTo,showGiverNameTo:e.showGiverNameTo,showRecipientNameTo:e.showRecipientNameTo}}))}},{key:"hasAnyTemplateQuestionSelected",get:function(){return this.templateQuestionModels.some((function(e){return e.isSelected}))}}]),e}()).\u0275fac=function(e){return new(e||ee)(V.Qb(r.a),V.Qb(Z.a))},ee.\u0275cmp=V.Kb({type:ee,selectors:[["ng-component"]],decls:13,vars:2,consts:[[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],["id","template-question-modal",1,"modal-body"],["class","card margin-top-20px",4,"ngFor","ngForOf"],[1,"modal-footer"],["id","btn-confirm-template","type","button",1,"btn","btn-primary",3,"disabled","click"],["type","button",1,"btn","btn-light",3,"click"],[1,"card","margin-top-20px"],[1,"card-header","cursor-pointer",3,"click"],["type","checkbox",3,"ngModel","ngModelChange","click"],[1,"template-description",3,"innerHTML"],[4,"ngIf"],[1,"card-body"],["isDisplayOnly","true",3,"formModel"]],template:function(e,t){1&e&&(V.Wb(0,"div",0),V.Wb(1,"h4",1),V.Qc(2,"Add Template Questions"),V.Vb(),V.Wb(3,"button",2),V.ic("click",(function(){return t.activeModal.dismiss()})),V.Wb(4,"span",3),V.Qc(5,"\xd7"),V.Vb(),V.Vb(),V.Vb(),V.Wb(6,"div",4),V.Oc(7,Y,7,3,"div",5),V.Vb(),V.Wb(8,"div",6),V.Wb(9,"button",7),V.ic("click",(function(){return t.activeModal.close(t.getSelectedQuestions())})),V.Qc(10,"Add"),V.Vb(),V.Wb(11,"button",8),V.ic("click",(function(){return t.activeModal.dismiss()})),V.Qc(12,"Close"),V.Vb(),V.Vb()),2&e&&(V.Cb(7),V.sc("ngForOf",t.templateQuestionModels),V.Cb(2),V.sc("disabled",!t.hasAnyTemplateQuestionSelected))},directives:[s.t,n.a,n.p,n.s,s.u,K.a],styles:[".margin-top-20px[_ngcontent-%COMP%]{margin-top:20px}.template-description[_ngcontent-%COMP%]{cursor:pointer}"],data:{animation:[J.a]}}),ee),ie=i("++8I"),se=i("Uqoa"),ne=i("Pvcr"),oe=i("MbNv"),re=i("eQqG"),ae=i("ax2R"),ce=i("iRmZ"),ue=i("vKUq"),de=i("Babz"),le=i("Lcal"),be=i("chhc"),me=i("W872"),fe=i("Wsbs"),pe=i("UGSt");function he(e,t){if(1&e){var i=V.Xb();V.Wb(0,"tm-session-edit-form",6),V.ic("modelChange",(function(e){return V.Fc(i),V.kc().sessionEditFormModel=e}))("editExistingSessionEvent",(function(){return V.Fc(i),V.kc().editExistingSessionHandler()}))("cancelEditingSessionEvent",(function(){return V.Fc(i),V.kc().cancelEditingSessionHandler()}))("deleteExistingSessionEvent",(function(){return V.Fc(i),V.kc().deleteExistingSessionHandler()}))("copyCurrentSessionEvent",(function(){return V.Fc(i),V.kc().copyCurrentSession()})),V.Vb()}if(2&e){var s=V.kc();V.sc("formMode",s.SessionEditFormMode.EDIT)("model",s.sessionEditFormModel)}}function ge(e,t){if(1&e){var i=V.Xb();V.Wb(0,"div",7),V.Wb(1,"button",8),V.ic("click",(function(){V.Fc(i);var e=V.kc();return e.isAllCollapsed?e.expandAll():e.collapseAll()})),V.Qc(2),V.Vb(),V.Vb()}if(2&e){var s=V.kc();V.Cb(2),V.Sc(" ",s.isAllCollapsed?"Expand":"Collapse"," All ")}}function ve(e,t){if(1&e){var i=V.Xb();V.Wb(0,"div"),V.Wb(1,"tm-question-edit-form",10),V.ic("saveExistingQuestionEvent",(function(){V.Fc(i);var e=t.index;return V.kc(2).saveExistingQuestionHandler(e)}))("discardExistingQuestionChangesEvent",(function(){V.Fc(i);var e=t.index;return V.kc(2).discardExistingQuestionHandler(e)}))("duplicateCurrentQuestionEvent",(function(){V.Fc(i);var e=t.index;return V.kc(2).duplicateCurrentQuestionHandler(e)}))("deleteCurrentQuestionEvent",(function(){V.Fc(i);var e=t.index;return V.kc(2).deleteExistingQuestionHandler(e)}))("formModelChange",(function(e){V.Fc(i);var s=t.index;return V.kc(2).questionEditFormModels[s]=e})),V.Vb(),V.Vb()}if(2&e){var s=t.index,n=V.kc(2);V.Cb(1),V.sc("formMode",n.QuestionEditFormMode.EDIT)("numOfQuestions",n.questionEditFormModels.length)("formModel",n.questionEditFormModels[s])}}function Se(e,t){if(1&e&&(V.Wb(0,"div"),V.Oc(1,ve,2,3,"div",9),V.Vb()),2&e){var i=V.kc();V.Cb(1),V.sc("ngForOf",i.questionEditFormModels)("ngForTrackBy",i.trackQuestionEditFormByFn)}}function Te(e,t){if(1&e){var i=V.Xb();V.Wb(0,"button",16),V.ic("click",(function(){V.Fc(i);var e=V.kc().$implicit;return V.kc(2).populateAndShowNewQuestionForm(e)})),V.Qc(1),V.lc(2,"questionTypeName"),V.Vb()}if(2&e){var s=V.kc().$implicit;V.Cb(1),V.Sc(" ",V.mc(2,1,s)," ")}}function Ee(e,t){if(1&e&&(V.Ub(0),V.Oc(1,Te,3,3,"button",23),V.Tb()),2&e){var i=t.$implicit,s=V.kc(2);V.Cb(1),V.sc("ngIf",i!==s.FeedbackQuestionType.CONSTSUM)}}function ye(e,t){1&e&&V.Rb(0,"tm-ajax-loading")}var ke=function(){return{questionId:"questions",section:"questions"}};function Ce(e,t){if(1&e){var i=V.Xb();V.Wb(0,"div",11),V.Wb(1,"div",12),V.Wb(2,"div",13),V.Wb(3,"button",14),V.Qc(4,"Add New Question"),V.Vb(),V.Wb(5,"div",15),V.Wb(6,"button",16),V.ic("click",(function(){return V.Fc(i),V.kc().templateQuestionModalHandler()})),V.Qc(7,"Choose from template questions"),V.Vb(),V.Rb(8,"div",17),V.Oc(9,Ee,2,1,"ng-container",18),V.lc(10,"enumToArray"),V.Vb(),V.Vb(),V.Wb(11,"a",19),V.Rb(12,"i",20),V.Vb(),V.Wb(13,"button",21),V.ic("click",(function(){return V.Fc(i),V.kc().copyQuestionsFromOtherSessionsHandler()})),V.Oc(14,ye,1,0,"tm-ajax-loading",22),V.Qc(15,"Copy Question"),V.Vb(),V.Vb(),V.Vb()}if(2&e){var s=V.kc();V.Cb(9),V.sc("ngForOf",V.mc(10,4,s.FeedbackQuestionType)),V.Cb(2),V.sc("queryParams",V.vc(6,ke)),V.Cb(2),V.sc("disabled",s.isCopyingQuestion),V.Cb(1),V.sc("ngIf",s.isCopyingQuestion)}}function Fe(e,t){if(1&e){var i=V.Xb();V.Wb(0,"tm-question-edit-form",24),V.ic("discardNewQuestionEvent",(function(){return V.Fc(i),V.kc().isAddingQuestionPanelExpanded=!1}))("createNewQuestionEvent",(function(){return V.Fc(i),V.kc().createNewQuestionHandler()}))("formModelChange",(function(e){return V.Fc(i),V.kc().newQuestionEditFormModel=e})),V.Vb()}if(2&e){var s=V.kc();V.sc("formMode",s.QuestionEditFormMode.ADD)("numOfQuestions",s.questionEditFormModels.length+1)("formModel",s.newQuestionEditFormModel)}}function Me(e,t){if(1&e&&(V.Wb(0,"option",35),V.Qc(1),V.Vb()),2&e){var i=t.$implicit;V.sc("ngValue",i.email),V.Cb(1),V.Tc("[",i.teamName,"] ",i.name,"")}}function we(e,t){1&e&&V.Sb(0)}var Oe=function(e,t,i){return{courseid:e,fsname:t,previewas:i}};function Qe(e,t){if(1&e&&(V.Wb(0,"a",36),V.Oc(1,we,1,0,"ng-container",37),V.Vb()),2&e){V.kc();var i=V.Cc(11),s=V.kc();V.sc("queryParams",V.yc(3,Oe,s.courseId,s.feedbackSessionName,s.emailOfStudentToPreview))("ngbTooltip",0!==s.emailOfStudentToPreview.length?"View how this session would look like to a student who is submitting feedback.":"Preview is unavailable if the course has yet to have any student enrolled."),V.Cb(1),V.sc("ngTemplateOutlet",i)}}function qe(e,t){if(1&e&&(V.Wb(0,"button",38),V.Qc(1,"Preview as Student"),V.Vb()),2&e){var i=V.kc(2);V.sc("disabled",0===i.emailOfStudentToPreview.length)}}function Ne(e,t){if(1&e&&(V.Wb(0,"option",35),V.Qc(1),V.Vb()),2&e){var i=t.$implicit;V.sc("ngValue",i.email),V.Cb(1),V.Rc(i.name)}}function Ie(e,t){1&e&&V.Sb(0)}function Re(e,t){if(1&e&&(V.Wb(0,"a",39),V.Oc(1,Ie,1,0,"ng-container",37),V.Vb()),2&e){V.kc();var i=V.Cc(17),s=V.kc();V.sc("queryParams",V.yc(2,Oe,s.courseId,s.feedbackSessionName,s.emailOfInstructorToPreview)),V.Cb(1),V.sc("ngTemplateOutlet",i)}}function _e(e,t){if(1&e&&(V.Wb(0,"button",40),V.Qc(1,"Preview as Instructor"),V.Vb()),2&e){var i=V.kc(2);V.sc("disabled",0===i.emailOfInstructorToPreview.length)}}function Ve(e,t){if(1&e){var i=V.Xb();V.Wb(0,"div",11),V.Wb(1,"div",12),V.Wb(2,"div",25),V.Wb(3,"div",26),V.Wb(4,"b"),V.Qc(5,"Preview Session:"),V.Vb(),V.Vb(),V.Wb(6,"div",27),V.Wb(7,"select",28),V.ic("ngModelChange",(function(e){return V.Fc(i),V.kc().emailOfStudentToPreview=e})),V.Oc(8,Me,2,3,"option",29),V.Vb(),V.Oc(9,Qe,2,7,"a",30),V.Oc(10,qe,2,1,"ng-template",null,31,V.Pc),V.Vb(),V.Wb(12,"div",27),V.Wb(13,"select",32),V.ic("ngModelChange",(function(e){return V.Fc(i),V.kc().emailOfInstructorToPreview=e})),V.Oc(14,Ne,2,2,"option",29),V.Vb(),V.Oc(15,Re,2,6,"a",33),V.Oc(16,_e,2,1,"ng-template",null,34,V.Pc),V.Vb(),V.Vb(),V.Vb(),V.Vb()}if(2&e){var s=V.Cc(11),n=V.Cc(17),o=V.kc();V.Cb(7),V.sc("ngModel",o.emailOfStudentToPreview),V.Cb(1),V.sc("ngForOf",o.studentsOfCourse),V.Cb(1),V.sc("ngIf",0!==o.emailOfStudentToPreview.length)("ngIfElse",s),V.Cb(4),V.sc("ngModel",o.emailOfInstructorToPreview),V.Cb(1),V.sc("ngForOf",o.instructorsCanBePreviewedAs),V.Cb(1),V.sc("ngIf",0!==o.emailOfInstructorToPreview.length)("ngIfElse",n)}}var Pe,De,Ae=[{path:"",component:(Pe=function(e){_inherits(i,e);var t=_createSuper(i);function i(e,s,n,o,r,a,c,u,d,l,b,m,f,p,h){var g;return _classCallCheck(this,i),(g=t.call(this,e,s,n,o,r,a,c,u,d,l)).studentService=b,g.courseService=m,g.route=f,g.timezoneService=p,g.changeDetectorRef=h,g.SessionEditFormMode=N.a,g.QuestionEditFormMode=q.a,g.FeedbackQuestionType=M.d,g.courseId="",g.feedbackSessionName="",g.isEditingMode=!1,g.courseName="",g.sessionEditFormModel={courseId:"",timeZone:"UTC",courseName:"",feedbackSessionName:"",instructions:"",submissionStartTime:{hour:23,minute:59},submissionStartDate:{year:0,month:0,day:0},submissionEndTime:{hour:23,minute:59},submissionEndDate:{year:0,month:0,day:0},gracePeriod:0,sessionVisibleSetting:M.o.AT_OPEN,customSessionVisibleTime:{hour:23,minute:59},customSessionVisibleDate:{year:0,month:0,day:0},responseVisibleSetting:M.n.CUSTOM,customResponseVisibleTime:{hour:23,minute:59},customResponseVisibleDate:{year:0,month:0,day:0},submissionStatus:M.f.OPEN,publishStatus:M.e.NOT_PUBLISHED,isClosingEmailEnabled:!0,isPublishedEmailEnabled:!0,templateSessionName:"",isSaving:!1,isEditable:!1,isDeleting:!1,isCopying:!1,hasVisibleSettingsPanelExpanded:!1,hasEmailSettingsPanelExpanded:!1},g.feedbackSessionModelBeforeEditing=JSON.parse(JSON.stringify(g.sessionEditFormModel)),g.feedbackQuestionModels=new Map,g.questionEditFormModels=[],g.newQuestionEditFormModel={feedbackQuestionId:"",questionNumber:0,questionBrief:"",questionDescription:"",isQuestionHasResponses:!1,questionType:M.d.TEXT,questionDetails:{questionType:M.d.TEXT,questionText:""},giverType:M.c.STUDENTS,recipientType:M.c.STUDENTS,numberOfEntitiesToGiveFeedbackToSetting:M.m.UNLIMITED,customNumberOfEntitiesToGiveFeedbackTo:1,showResponsesTo:[],showGiverNameTo:[],showRecipientNameTo:[],isEditable:!0,isSaving:!1,isCollapsed:!1,isVisibilityChanged:!1,isFeedbackPathChanged:!1,isQuestionDetailsChanged:!1},g.isAddingQuestionPanelExpanded=!1,g.isLoadingFeedbackSession=!1,g.hasLoadingFeedbackSessionFailed=!1,g.isLoadingFeedbackQuestions=!1,g.hasLoadingFeedbackQuestionsFailed=!1,g.isCopyingQuestion=!1,g.studentsOfCourse=[],g.emailOfStudentToPreview="",g.instructorsCanBePreviewedAs=[],g.emailOfInstructorToPreview="",g}return _createClass(i,[{key:"ngOnInit",value:function(){var e=this;this.route.queryParams.subscribe((function(t){e.courseId=t.courseid,e.feedbackSessionName=t.fsname,e.isEditingMode="true"===t.editingMode,e.loadFeedbackSession(),e.loadFeedbackQuestions(),e.getAllStudentsOfCourse(),e.getAllInstructorsCanBePreviewedAs()}))}},{key:"loadFeedbackSession",value:function(){var e=this;this.hasLoadingFeedbackSessionFailed=!1,this.isLoadingFeedbackSession=!0,this.courseService.getCourseAsInstructor(this.courseId).subscribe((function(t){e.courseName=t.courseName,e.feedbackSessionsService.getFeedbackSession({courseId:e.courseId,feedbackSessionName:e.feedbackSessionName,intent:w.b.FULL_DETAIL}).pipe(Object(S.a)((function(){return e.isLoadingFeedbackSession=!1}))).subscribe((function(t){e.sessionEditFormModel=e.getSessionEditFormModel(t,e.isEditingMode),e.feedbackSessionModelBeforeEditing=e.getSessionEditFormModel(t)}),(function(t){e.hasLoadingFeedbackSessionFailed=!0,e.statusMessageService.showErrorToast(t.error.message)}))}),(function(t){e.statusMessageService.showErrorToast(t.error.message),e.isLoadingFeedbackSession=!1,e.hasLoadingFeedbackSessionFailed=!0}))}},{key:"copyCurrentSession",value:function(){var e=this;this.sessionEditFormModel.isCopying=!0,this.courseService.getInstructorCoursesThatAreActive().subscribe((function(t){var i=e.ngbModal.open(Q.a);i.componentInstance.newFeedbackSessionName=e.feedbackSessionName,i.componentInstance.courseCandidates=t.courses,i.componentInstance.sessionToCopyCourseId=e.courseId,i.result.then((function(t){e.failedToCopySessions={};var i=e.createSessionCopyRequestsFromModal(t,e.courseId,e.feedbackSessionName);1===i.length&&e.copySingleSession(i[0]),i.length>1&&Object(g.a)(i).pipe(Object(S.a)((function(){return e.sessionEditFormModel.isCopying=!1}))).subscribe((function(){e.showCopyStatusMessage()}))}),(function(t){e.statusMessageService.showErrorToast(t.error.message)})).catch((function(){}))}))}},{key:"getSessionEditFormModel",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.getDateTimeAtTimezone(e.submissionStartTimestamp,e.timeZone),s=this.getDateTimeAtTimezone(e.submissionEndTimestamp,e.timeZone),n={isEditable:t,courseId:e.courseId,timeZone:e.timeZone,courseName:this.courseName,feedbackSessionName:e.feedbackSessionName,instructions:e.instructions,submissionStartTime:i.time,submissionStartDate:i.date,submissionEndTime:s.time,submissionEndDate:s.date,gracePeriod:e.gracePeriod,sessionVisibleSetting:e.sessionVisibleSetting,customSessionVisibleTime:{hour:23,minute:59},customSessionVisibleDate:{year:0,month:0,day:0},responseVisibleSetting:e.responseVisibleSetting,customResponseVisibleTime:{hour:23,minute:59},customResponseVisibleDate:{year:0,month:0,day:0},submissionStatus:e.submissionStatus,publishStatus:e.publishStatus,templateSessionName:"",isClosingEmailEnabled:e.isClosingEmailEnabled,isPublishedEmailEnabled:e.isPublishedEmailEnabled,isSaving:!1,isDeleting:!1,isCopying:!1,hasVisibleSettingsPanelExpanded:e.sessionVisibleSetting!==M.o.AT_OPEN||e.responseVisibleSetting!==M.n.LATER,hasEmailSettingsPanelExpanded:!e.isClosingEmailEnabled||!e.isPublishedEmailEnabled};if(e.customSessionVisibleTimestamp){var o=this.getDateTimeAtTimezone(e.customSessionVisibleTimestamp,e.timeZone);n.customSessionVisibleTime=o.time,n.customSessionVisibleDate=o.date}if(e.customResponseVisibleTimestamp){var r=this.getDateTimeAtTimezone(e.customResponseVisibleTimestamp,e.timeZone);n.customResponseVisibleTime=r.time,n.customResponseVisibleDate=r.date}return n}},{key:"getDateTimeAtTimezone",value:function(e,t){var i=this.timezoneService.getMomentInstance(e,t);return{date:{year:i.year(),month:i.month()+1,day:i.date()},time:{minute:i.minute(),hour:i.hour()}}}},{key:"editExistingSessionHandler",value:function(){var e=this;this.sessionEditFormModel.isEditable=!1,this.feedbackSessionModelBeforeEditing=JSON.parse(JSON.stringify(this.sessionEditFormModel)),this.sessionEditFormModel.isSaving=!0,Object(g.a)([this.resolveLocalDateTime(this.sessionEditFormModel.submissionStartDate,this.sessionEditFormModel.submissionStartTime,this.sessionEditFormModel.timeZone,"Submission opening time"),this.resolveLocalDateTime(this.sessionEditFormModel.submissionEndDate,this.sessionEditFormModel.submissionEndTime,this.sessionEditFormModel.timeZone,"Submission closing time"),this.sessionEditFormModel.sessionVisibleSetting===M.o.CUSTOM?this.resolveLocalDateTime(this.sessionEditFormModel.customSessionVisibleDate,this.sessionEditFormModel.customSessionVisibleTime,this.sessionEditFormModel.timeZone,"Session visible time"):Object(v.a)(0),this.sessionEditFormModel.responseVisibleSetting===M.n.CUSTOM?this.resolveLocalDateTime(this.sessionEditFormModel.customResponseVisibleDate,this.sessionEditFormModel.customResponseVisibleTime,this.sessionEditFormModel.timeZone,"Response visible time"):Object(v.a)(0)]).pipe(Object(T.a)((function(t){return e.feedbackSessionsService.updateFeedbackSession(e.courseId,e.feedbackSessionName,{instructions:e.sessionEditFormModel.instructions,submissionStartTimestamp:t[0],submissionEndTimestamp:t[1],gracePeriod:e.sessionEditFormModel.gracePeriod,sessionVisibleSetting:e.sessionEditFormModel.sessionVisibleSetting,customSessionVisibleTimestamp:t[2],responseVisibleSetting:e.sessionEditFormModel.responseVisibleSetting,customResponseVisibleTimestamp:t[3],isClosingEmailEnabled:e.sessionEditFormModel.isClosingEmailEnabled,isPublishedEmailEnabled:e.sessionEditFormModel.isPublishedEmailEnabled})})),Object(S.a)((function(){e.sessionEditFormModel.isSaving=!1}))).subscribe((function(t){e.sessionEditFormModel=e.getSessionEditFormModel(t),e.statusMessageService.showSuccessToast("The feedback session has been updated.")}),(function(t){e.statusMessageService.showErrorToast(t.error.message)}))}},{key:"cancelEditingSessionHandler",value:function(){this.sessionEditFormModel=JSON.parse(JSON.stringify(this.feedbackSessionModelBeforeEditing))}},{key:"resolveLocalDateTime",value:function(e,t,i,s){var n=this,o=h()();o.set("year",e.year),o.set("month",e.month-1),o.set("date",e.day),o.set("hour",t.hour),o.set("minute",t.minute);var r=o.format(F.a);return this.timezoneService.getResolvedTimestamp(r,i,s).pipe(Object(E.a)((function(e){0!==e.message.length&&n.statusMessageService.showWarningToast(e.message)})),Object(y.a)((function(e){return e.timestamp})))}},{key:"deleteExistingSessionHandler",value:function(){var e=this;this.sessionEditFormModel.isDeleting=!0,this.feedbackSessionsService.moveSessionToRecycleBin(this.courseId,this.feedbackSessionName).pipe(Object(S.a)((function(){return e.sessionEditFormModel.isDeleting=!1}))).subscribe((function(){e.navigationService.navigateWithSuccessMessage(e.router,"/web/instructor/sessions","The feedback session has been deleted. You can restore it from the deleted sessions table below.")}),(function(t){e.statusMessageService.showErrorToast(t.error.message)}))}},{key:"loadFeedbackQuestions",value:function(){var e=this;this.questionEditFormModels=[],this.hasLoadingFeedbackQuestionsFailed=!1,this.isLoadingFeedbackQuestions=!0,this.feedbackQuestionsService.getFeedbackQuestions({courseId:this.courseId,feedbackSessionName:this.feedbackSessionName,intent:w.b.FULL_DETAIL}).pipe(Object(S.a)((function(){return e.isLoadingFeedbackQuestions=!1}))).subscribe((function(t){t.questions.forEach((function(t){var i=e.getQuestionEditFormModel(t);e.questionEditFormModels.push(i),e.loadResponseStatusForQuestion(i),e.feedbackQuestionModels.set(t.feedbackQuestionId,t)}))}),(function(t){e.hasLoadingFeedbackQuestionsFailed=!0,e.statusMessageService.showErrorToast(t.error.message)}))}},{key:"trackQuestionEditFormByFn",value:function(e,t){return t.feedbackQuestionId}},{key:"getQuestionEditFormModel",value:function(e){return{feedbackQuestionId:e.feedbackQuestionId,questionNumber:e.questionNumber,questionBrief:e.questionBrief,questionDescription:e.questionDescription,isQuestionHasResponses:!1,questionType:e.questionType,questionDetails:this.deepCopy(e.questionDetails),giverType:e.giverType,recipientType:e.recipientType,numberOfEntitiesToGiveFeedbackToSetting:e.numberOfEntitiesToGiveFeedbackToSetting,customNumberOfEntitiesToGiveFeedbackTo:e.customNumberOfEntitiesToGiveFeedbackTo?e.customNumberOfEntitiesToGiveFeedbackTo:1,showResponsesTo:e.showResponsesTo,showGiverNameTo:e.showGiverNameTo,showRecipientNameTo:e.showRecipientNameTo,isEditable:!1,isSaving:!1,isCollapsed:!1,isVisibilityChanged:!1,isFeedbackPathChanged:!1,isQuestionDetailsChanged:!1}}},{key:"loadResponseStatusForQuestion",value:function(e){var t=this;this.feedbackSessionsService.hasResponsesForQuestion(e.feedbackQuestionId).subscribe((function(t){e.isQuestionHasResponses=t.hasResponses}),(function(e){t.statusMessageService.showErrorToast(e.error.message)}))}},{key:"saveExistingQuestionHandler",value:function(e){var t=this,i=this.questionEditFormModels[e],s=this.feedbackQuestionModels.get(i.feedbackQuestionId).questionNumber;i.isSaving=!0,this.feedbackQuestionsService.saveFeedbackQuestion(i.feedbackQuestionId,{questionNumber:i.questionNumber,questionBrief:i.questionBrief,questionDescription:i.questionDescription,questionDetails:i.questionDetails,questionType:i.questionType,giverType:i.giverType,recipientType:i.recipientType,numberOfEntitiesToGiveFeedbackToSetting:i.numberOfEntitiesToGiveFeedbackToSetting,customNumberOfEntitiesToGiveFeedbackTo:i.customNumberOfEntitiesToGiveFeedbackTo,showResponsesTo:i.showResponsesTo,showGiverNameTo:i.showGiverNameTo,showRecipientNameTo:i.showRecipientNameTo}).pipe(Object(S.a)((function(){i.isSaving=!1}))).subscribe((function(i){t.questionEditFormModels[e]=t.getQuestionEditFormModel(i),t.feedbackQuestionModels.set(i.feedbackQuestionId,i),t.loadResponseStatusForQuestion(t.questionEditFormModels[e]),s!==i.questionNumber&&(t.moveQuestionForm(s-1,i.questionNumber-1),t.normalizeQuestionNumberInQuestionForms()),t.statusMessageService.showSuccessToast("The changes to the question have been updated.")}),(function(e){t.statusMessageService.showErrorToast(e.error.message)}))}},{key:"moveQuestionForm",value:function(e,t){this.questionEditFormModels.splice(t,0,this.questionEditFormModels.splice(e,1)[0]);var i=Math.min(e,t),s=this.questionEditFormModels.slice(i,t+1).filter((function(e){return!e.isCollapsed}));s.forEach((function(e){return e.isCollapsed=!0})),this.changeDetectorRef.detectChanges(),s.forEach((function(e){return e.isCollapsed=!1}))}},{key:"normalizeQuestionNumberInQuestionForms",value:function(){for(var e=1;e<=this.questionEditFormModels.length;e+=1){var t=this.questionEditFormModels[e-1];t.questionNumber=e,this.feedbackQuestionModels.get(t.feedbackQuestionId).questionNumber=e}}},{key:"discardExistingQuestionHandler",value:function(e){var t=this.feedbackQuestionModels.get(this.questionEditFormModels[e].feedbackQuestionId);this.questionEditFormModels[e]=this.getQuestionEditFormModel(t)}},{key:"duplicateCurrentQuestionHandler",value:function(e){var t=this,i=this.questionEditFormModels[e];i.isSaving=!0,this.feedbackQuestionsService.createFeedbackQuestion(this.courseId,this.feedbackSessionName,{questionNumber:this.questionEditFormModels.length+1,questionBrief:i.questionBrief,questionDescription:i.questionDescription,questionDetails:i.questionDetails,questionType:i.questionType,giverType:i.giverType,recipientType:i.recipientType,numberOfEntitiesToGiveFeedbackToSetting:i.numberOfEntitiesToGiveFeedbackToSetting,customNumberOfEntitiesToGiveFeedbackTo:i.customNumberOfEntitiesToGiveFeedbackTo,showResponsesTo:i.showResponsesTo,showGiverNameTo:i.showGiverNameTo,showRecipientNameTo:i.showRecipientNameTo}).pipe(Object(S.a)((function(){i.isSaving=!1}))).subscribe((function(e){t.questionEditFormModels.push(t.getQuestionEditFormModel(e)),t.feedbackQuestionModels.set(e.feedbackQuestionId,e),t.statusMessageService.showSuccessToast("The question has been duplicated below.")}),(function(e){t.statusMessageService.showErrorToast(e.error.message)}))}},{key:"deleteExistingQuestionHandler",value:function(e){var t=this;this.simpleModalService.openConfirmationModal("Delete the question?",I.a.DANGER,"Warning: Deleted question cannot be recovered. <b>All existing responses for this question to be deleted.</b>").result.then((function(){var i=t.questionEditFormModels[e];t.feedbackQuestionsService.deleteFeedbackQuestion(i.feedbackQuestionId).subscribe((function(){t.feedbackQuestionModels.delete(i.feedbackQuestionId),t.questionEditFormModels.splice(e,1),t.normalizeQuestionNumberInQuestionForms(),t.statusMessageService.showSuccessToast("The question has been deleted.")}),(function(e){t.statusMessageService.showErrorToast(e.error.message)}))}),(function(){}))}},{key:"templateQuestionModalHandler",value:function(){var e=this;this.ngbModal.open(te,{windowClass:"modal-large"}).result.then((function(t){var i=e.questionEditFormModels.length;Object(v.a).apply(void 0,_toConsumableArray(t)).pipe(Object(k.a)((function(t){return i+=1,e.feedbackQuestionsService.createFeedbackQuestion(e.courseId,e.feedbackSessionName,{questionNumber:i,questionBrief:t.questionBrief,questionDescription:t.questionDescription,questionDetails:t.questionDetails,questionType:t.questionType,giverType:t.giverType,recipientType:t.recipientType,numberOfEntitiesToGiveFeedbackToSetting:t.numberOfEntitiesToGiveFeedbackToSetting,customNumberOfEntitiesToGiveFeedbackTo:t.customNumberOfEntitiesToGiveFeedbackTo,showResponsesTo:t.showResponsesTo,showGiverNameTo:t.showGiverNameTo,showRecipientNameTo:t.showRecipientNameTo})}))).subscribe((function(t){e.questionEditFormModels.push(e.getQuestionEditFormModel(t)),e.feedbackQuestionModels.set(t.feedbackQuestionId,t)}),(function(t){e.statusMessageService.showErrorToast(t.error.message)}),(function(){e.statusMessageService.showSuccessToast(1===t.length?"The question has been added to this feedback session.":"The questions have been added to this feedback session.")}))}),(function(){}))}},{key:"populateAndShowNewQuestionForm",value:function(e){this.isAddingQuestionPanelExpanded=!0;var t=this.feedbackQuestionsService.getNewQuestionModel(e);if(this.newQuestionEditFormModel={feedbackQuestionId:"",questionNumber:this.questionEditFormModels.length+1,questionBrief:t.questionBrief,questionDescription:t.questionDescription,isQuestionHasResponses:!1,questionType:t.questionType,questionDetails:t.questionDetails,giverType:t.giverType,recipientType:t.recipientType,numberOfEntitiesToGiveFeedbackToSetting:t.numberOfEntitiesToGiveFeedbackToSetting,customNumberOfEntitiesToGiveFeedbackTo:t.customNumberOfEntitiesToGiveFeedbackTo?t.customNumberOfEntitiesToGiveFeedbackTo:1,showResponsesTo:t.showResponsesTo,showGiverNameTo:t.showGiverNameTo,showRecipientNameTo:t.showRecipientNameTo,isEditable:!0,isSaving:!1,isCollapsed:!1,isVisibilityChanged:!1,isFeedbackPathChanged:!1,isQuestionDetailsChanged:!1},this.questionEditFormModels.length>0){var i=this.questionEditFormModels[this.questionEditFormModels.length-1],s=this.feedbackQuestionsService.getAllowedFeedbackPaths(e);s.has(i.giverType)&&-1!==s.get(i.giverType).indexOf(i.recipientType)&&(this.newQuestionEditFormModel.giverType=i.giverType,this.newQuestionEditFormModel.recipientType=i.recipientType,this.newQuestionEditFormModel.numberOfEntitiesToGiveFeedbackToSetting=i.numberOfEntitiesToGiveFeedbackToSetting,this.newQuestionEditFormModel.customNumberOfEntitiesToGiveFeedbackTo=i.customNumberOfEntitiesToGiveFeedbackTo);var n=this.feedbackQuestionsService.getNewVisibilityStateMachine(this.newQuestionEditFormModel.giverType,this.newQuestionEditFormModel.recipientType);n.applyVisibilitySettings({SHOW_RESPONSE:i.showResponsesTo,SHOW_GIVER_NAME:i.showGiverNameTo,SHOW_RECIPIENT_NAME:i.showRecipientNameTo});var o=n.getVisibilityTypesUnderVisibilityControl(O.a.SHOW_RESPONSE),r=n.getVisibilityTypesUnderVisibilityControl(O.a.SHOW_GIVER_NAME),a=n.getVisibilityTypesUnderVisibilityControl(O.a.SHOW_RECIPIENT_NAME),c=!1;if(this.feedbackQuestionsService.isCustomFeedbackVisibilitySettingAllowed(this.newQuestionEditFormModel.questionType))c=!0;else{var u,d=_createForOfIteratorHelper(this.feedbackQuestionsService.getCommonFeedbackVisibilitySettings(n,this.newQuestionEditFormModel.questionType));try{for(d.s();!(u=d.n()).done;){var l=u.value;if(this.isSameSet(o,l.visibilitySettings.SHOW_RESPONSE)&&this.isSameSet(r,l.visibilitySettings.SHOW_GIVER_NAME)&&this.isSameSet(a,l.visibilitySettings.SHOW_RECIPIENT_NAME)){c=!0;break}}}catch(b){d.e(b)}finally{d.f()}}c&&(this.newQuestionEditFormModel.showResponsesTo=o,this.newQuestionEditFormModel.showGiverNameTo=r,this.newQuestionEditFormModel.showRecipientNameTo=a)}this.scrollToNewEditForm()}},{key:"isSameSet",value:function(e,t){return e.length===t.length&&e.every((function(e){return t.includes(e)}))}},{key:"createNewQuestionHandler",value:function(){var e=this;this.newQuestionEditFormModel.isSaving=!0,this.feedbackQuestionsService.createFeedbackQuestion(this.courseId,this.feedbackSessionName,{questionNumber:this.newQuestionEditFormModel.questionNumber,questionBrief:this.newQuestionEditFormModel.questionBrief,questionDescription:this.newQuestionEditFormModel.questionDescription,questionDetails:this.newQuestionEditFormModel.questionDetails,questionType:this.newQuestionEditFormModel.questionType,giverType:this.newQuestionEditFormModel.giverType,recipientType:this.newQuestionEditFormModel.recipientType,numberOfEntitiesToGiveFeedbackToSetting:this.newQuestionEditFormModel.numberOfEntitiesToGiveFeedbackToSetting,customNumberOfEntitiesToGiveFeedbackTo:this.newQuestionEditFormModel.customNumberOfEntitiesToGiveFeedbackTo,showResponsesTo:this.newQuestionEditFormModel.showResponsesTo,showGiverNameTo:this.newQuestionEditFormModel.showGiverNameTo,showRecipientNameTo:this.newQuestionEditFormModel.showRecipientNameTo}).pipe(Object(S.a)((function(){e.newQuestionEditFormModel.isSaving=!1}))).subscribe((function(t){e.questionEditFormModels.push(e.getQuestionEditFormModel(t)),e.feedbackQuestionModels.set(t.feedbackQuestionId,t),e.moveQuestionForm(e.questionEditFormModels.length-1,t.questionNumber-1),e.normalizeQuestionNumberInQuestionForms(),e.isAddingQuestionPanelExpanded=!1,e.statusMessageService.showSuccessToast("The question has been added to this feedback session.")}),(function(t){e.statusMessageService.showErrorToast(t.error.message)}))}},{key:"copyQuestionsFromOtherSessionsHandler",value:function(){var e=this;this.isCopyingQuestion=!0;var t=[];this.feedbackSessionsService.getFeedbackSessionsForInstructor().pipe(Object(T.a)((function(e){return Object(v.a).apply(void 0,_toConsumableArray(e.feedbackSessions))})),Object(C.a)((function(t){return e.feedbackQuestionsService.getFeedbackQuestions({courseId:t.courseId,feedbackSessionName:t.feedbackSessionName,intent:w.b.FULL_DETAIL}).pipe(Object(y.a)((function(e){return e.questions.map((function(e){return{courseId:t.courseId,feedbackSessionName:t.feedbackSessionName,question:e,isSelected:!1}}))})))})),Object(S.a)((function(){return e.isCopyingQuestion=!1}))).subscribe((function(e){t.push.apply(t,_toConsumableArray(e))}),(function(t){e.statusMessageService.showErrorToast(t.error.message)}),(function(){var i=e.ngbModal.open(z);i.componentInstance.questionToCopyCandidates=t,i.result.then((function(t){e.isCopyingQuestion=!0,Object(v.a).apply(void 0,_toConsumableArray(t)).pipe(Object(k.a)((function(t){return e.feedbackQuestionsService.createFeedbackQuestion(e.courseId,e.feedbackSessionName,{questionNumber:e.questionEditFormModels.length+1,questionBrief:t.questionBrief,questionDescription:t.questionDescription,questionDetails:t.questionDetails,questionType:t.questionType,giverType:t.giverType,recipientType:t.recipientType,numberOfEntitiesToGiveFeedbackToSetting:t.numberOfEntitiesToGiveFeedbackToSetting,customNumberOfEntitiesToGiveFeedbackTo:t.customNumberOfEntitiesToGiveFeedbackTo,showResponsesTo:t.showResponsesTo,showGiverNameTo:t.showGiverNameTo,showRecipientNameTo:t.showRecipientNameTo})})),Object(S.a)((function(){return e.isCopyingQuestion=!1}))).subscribe((function(t){e.questionEditFormModels.push(e.getQuestionEditFormModel(t)),e.feedbackQuestionModels.set(t.feedbackQuestionId,t),e.statusMessageService.showSuccessToast("The question has been added to this feedback session.")}),(function(t){e.statusMessageService.showErrorToast(t.error.message)}))}))}))}},{key:"getAllStudentsOfCourse",value:function(){var e=this;this.studentService.getStudentsFromCourse({courseId:this.courseId}).subscribe((function(t){e.studentsOfCourse=t.students,e.studentsOfCourse.sort((function(e,t){var i=e.teamName.localeCompare(t.teamName);return 0===i?e.name.localeCompare(t.name):i})),e.studentsOfCourse.length>=1&&(e.emailOfStudentToPreview=e.studentsOfCourse[0].email)}),(function(t){e.statusMessageService.showErrorToast(t.error.message)}))}},{key:"getAllInstructorsCanBePreviewedAs",value:function(){var e=this;this.instructorService.loadInstructors({courseId:this.courseId,intent:w.b.FULL_DETAIL}).subscribe((function(t){e.instructorsCanBePreviewedAs=t.instructors,e.instructorsCanBePreviewedAs.sort((function(e,t){return e.name.localeCompare(t.name)})),e.instructorsCanBePreviewedAs.length>=1&&(e.emailOfInstructorToPreview=e.instructorsCanBePreviewedAs[0].email)}),(function(t){e.statusMessageService.showErrorToast(t.error.message)}))}},{key:"expandAll",value:function(){this.questionEditFormModels.forEach((function(e){e.isCollapsed=!1}))}},{key:"collapseAll",value:function(){this.questionEditFormModels.forEach((function(e){e.isCollapsed=!0}))}},{key:"deepCopy",value:function(e){return JSON.parse(JSON.stringify(e))}},{key:"scrollToNewEditForm",value:function(){setTimeout((function(){var e=document.querySelectorAll("tm-question-edit-form"),t=e[e.length-1].getBoundingClientRect().top+window.pageYOffset+-70;window.scrollTo({top:t,behavior:"smooth"})}),0)}},{key:"isAllCollapsed",get:function(){return this.questionEditFormModels.some((function(e){return e.isCollapsed}))}}]),i}(R.a),Pe.\u0275fac=function(e){return new(e||Pe)(V.Qb(o.d),V.Qb(ie.a),V.Qb(se.a),V.Qb(ne.a),V.Qb(oe.a),V.Qb(Z.a),V.Qb(P.a),V.Qb(r.m),V.Qb(re.a),V.Qb(ae.a),V.Qb(ce.a),V.Qb(ue.a),V.Qb(o.a),V.Qb(F.b),V.Qb(V.h))},Pe.\u0275cmp=V.Kb({type:Pe,selectors:[["tm-instructor-session-edit-page"]],features:[V.zb],decls:10,vars:10,consts:[[3,"shouldShowRetry","message","retryEvent"],[3,"formMode","model","modelChange","editExistingSessionEvent","cancelEditingSessionEvent","deleteExistingSessionEvent","copyCurrentSessionEvent",4,"tmIsLoading"],["class","offset-md-10 margin-vertical-20px",4,"ngIf"],[4,"tmIsLoading"],["class","card",4,"ngIf"],[3,"formMode","numOfQuestions","formModel","discardNewQuestionEvent","createNewQuestionEvent","formModelChange",4,"ngIf"],[3,"formMode","model","modelChange","editExistingSessionEvent","cancelEditingSessionEvent","deleteExistingSessionEvent","copyCurrentSessionEvent"],[1,"offset-md-10","margin-vertical-20px"],[1,"btn","expand-btn","btn-light","margin-top-30px",3,"click"],[4,"ngFor","ngForOf","ngForTrackBy"],[3,"formMode","numOfQuestions","formModel","saveExistingQuestionEvent","discardExistingQuestionChangesEvent","duplicateCurrentQuestionEvent","deleteCurrentQuestionEvent","formModelChange"],[1,"card"],[1,"card-body","background-color-light-blue","text-center"],["ngbDropdown","",1,"d-inline-block"],["id","btn-new-question","ngbDropdownToggle","",1,"btn","btn-primary"],["id","new-question-dropdown","ngbDropdownMenu",""],[1,"dropdown-item",3,"click"],[1,"dropdown-divider"],[4,"ngFor","ngForOf"],["type","button","target","_blank","rel","noopener noreferrer","tmRouterLink","/web/instructor/help",1,"btn","btn-link",3,"queryParams"],[1,"fas","fa-info-circle"],["id","btn-copy-question",1,"btn","btn-primary",3,"disabled","click"],[4,"ngIf"],["class","dropdown-item",3,"click",4,"ngIf"],[3,"formMode","numOfQuestions","formModel","discardNewQuestionEvent","createNewQuestionEvent","formModelChange"],[1,"row","align-items-center"],[1,"col-lg-2","text-lg-right"],[1,"col-lg-5"],["id","preview-student",1,"form-control","preview-select",3,"ngModel","ngModelChange"],[3,"ngValue",4,"ngFor","ngForOf"],["tmRouterLink","/web/sessions/submission","target","_blank","rel","noopener noreferrer",3,"queryParams","ngbTooltip",4,"ngIf","ngIfElse"],["previewStudentBtn",""],["id","preview-instructor",1,"form-control","preview-select",3,"ngModel","ngModelChange"],["tmRouterLink","/web/instructor/sessions/submission","target","_blank","rel","noopener noreferrer","ngbTooltip","View how this session would look like to an instructor who is submitting feedback. Only instructors with submit privileges are included in the list.",3,"queryParams",4,"ngIf","ngIfElse"],["previewInstructorBtn",""],[3,"ngValue"],["tmRouterLink","/web/sessions/submission","target","_blank","rel","noopener noreferrer",3,"queryParams","ngbTooltip"],[4,"ngTemplateOutlet"],["id","btn-preview-student",1,"btn","btn-primary",3,"disabled"],["tmRouterLink","/web/instructor/sessions/submission","target","_blank","rel","noopener noreferrer","ngbTooltip","View how this session would look like to an instructor who is submitting feedback. Only instructors with submit privileges are included in the list.",3,"queryParams"],["id","btn-preview-instructor",1,"btn","btn-primary",3,"disabled"]],template:function(e,t){1&e&&(V.Wb(0,"tm-loading-retry",0),V.ic("retryEvent",(function(){return t.loadFeedbackSession()})),V.Oc(1,he,1,2,"tm-session-edit-form",1),V.Vb(),V.Wb(2,"tm-loading-retry",0),V.ic("retryEvent",(function(){return t.loadFeedbackQuestions()})),V.Oc(3,ge,3,1,"div",2),V.Oc(4,Se,2,2,"div",3),V.Rb(5,"br"),V.Oc(6,Ce,16,7,"div",4),V.Oc(7,Fe,1,3,"tm-question-edit-form",5),V.Rb(8,"br"),V.Oc(9,Ve,18,8,"div",4),V.Vb()),2&e&&(V.sc("shouldShowRetry",t.hasLoadingFeedbackSessionFailed)("message","Failed to load feedback session"),V.Cb(1),V.sc("tmIsLoading",t.isLoadingFeedbackSession),V.Cb(1),V.sc("shouldShowRetry",t.hasLoadingFeedbackQuestionsFailed)("message","Failed to load feedback questions"),V.Cb(1),V.sc("ngIf",!t.isLoadingFeedbackQuestions),V.Cb(1),V.sc("tmIsLoading",t.isLoadingFeedbackQuestions),V.Cb(2),V.sc("ngIf",!t.isLoadingFeedbackQuestions&&!t.isAddingQuestionPanelExpanded),V.Cb(1),V.sc("ngIf",t.isAddingQuestionPanelExpanded),V.Cb(2),V.sc("ngIf",!t.isLoadingFeedbackQuestions))},directives:[de.a,le.a,s.u,be.a,s.t,K.a,r.g,r.k,r.i,me.a,fe.a,n.B,n.p,n.s,n.u,n.E,r.w,s.B],pipes:[pe.a,D.a],styles:[".background-color-light-blue[_ngcontent-%COMP%]{background-color:#eaeff5}.preview-select[_ngcontent-%COMP%]{float:left;width:50%}.expand-btn[_ngcontent-%COMP%]{width:100%}.margin-vertical-20px[_ngcontent-%COMP%]{margin-bottom:20px;margin-top:20px}"]}),Pe)}],xe=((De=function e(){_classCallCheck(this,e)}).\u0275mod=V.Ob({type:De}),De.\u0275inj=V.Nb({factory:function(e){return new(e||De)},imports:[[a.a,s.c,n.j,r.d,r.j,r.y,m.a,b.a,l.a,c.a,o.h.forChild(Ae),d.a,u.a,f.a]]}),De)},zAMY:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var s=i("fXoL"),n=i("ofXK");function o(e,t){1&e&&s.Rb(0,"i",3)}function r(e,t){1&e&&s.Rb(0,"i",4)}var a=function(){var e=function(){function e(){_classCallCheck(this,e),this.isExpanded=!1}return _createClass(e,[{key:"ngOnInit",value:function(){}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=s.Kb({type:e,selectors:[["tm-panel-chevron"]],inputs:{isExpanded:"isExpanded"},decls:3,vars:2,consts:[[1,"chevron"],["class","fas fa-chevron-down",4,"ngIf"],["class","fas fa-chevron-up",4,"ngIf"],[1,"fas","fa-chevron-down"],[1,"fas","fa-chevron-up"]],template:function(e,t){1&e&&(s.Wb(0,"div",0),s.Oc(1,o,1,0,"i",1),s.Oc(2,r,1,0,"i",2),s.Vb()),2&e&&(s.Cb(1),s.sc("ngIf",!t.isExpanded),s.Cb(1),s.sc("ngIf",t.isExpanded))},directives:[n.u],styles:[".chevron[_ngcontent-%COMP%]{display:-ms-inline-flexbox;display:inline-flex;vertical-align:middle}"]}),e}()}}]);