function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,s){if(e){if("string"==typeof e)return _arrayLikeToArray(e,s);var o=Object.prototype.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?_arrayLikeToArray(e,s):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,s){(null==s||s>e.length)&&(s=e.length);for(var o=0,n=new Array(s);o<s;o++)n[o]=e[o];return n}function _inherits(e,s){if("function"!=typeof s&&null!==s)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(s&&s.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),s&&_setPrototypeOf(e,s)}function _setPrototypeOf(e,s){return(_setPrototypeOf=Object.setPrototypeOf||function(e,s){return e.__proto__=s,e})(e,s)}function _createSuper(e){var s=_isNativeReflectConstruct();return function(){var o,n=_getPrototypeOf(e);if(s){var i=_getPrototypeOf(this).constructor;o=Reflect.construct(n,arguments,i)}else o=n.apply(this,arguments);return _possibleConstructorReturn(this,o)}}function _possibleConstructorReturn(e,s){return!s||"object"!=typeof s&&"function"!=typeof s?_assertThisInitialized(e):s}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _classCallCheck(e,s){if(!(e instanceof s))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,s){for(var o=0;o<s.length;o++){var n=s[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,s,o){return s&&_defineProperties(e.prototype,s),o&&_defineProperties(e,o),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{JgC6:function(e,s,o){"use strict";o.r(s),o.d(s,"InstructorSessionsPageModule",(function(){return Se}));var n=o("ofXK"),i=o("3Pt+"),t=o("tyNb"),r=o("mYbV"),a=o("aSpy"),c=o("qVc+"),d=o("f3aF"),l=o("vHwn"),u=o("SEFB"),b=o("TOej"),m=o("pjmv"),h=o.n(m),S=o("cp0P"),f=o("LRne"),p=o("nYR2"),v=o("eIep"),y=o("bOdf"),g=o("vkgz"),k=o("lJxs"),E=o("A3DQ"),R=o("R8lv"),F=o("Mdjh"),M=o("p6cw"),w=o("G/Uz"),T=o("BKNR"),C=o("JUCI"),O=o("TQ0J"),B=o("uBDz"),I=o("fXoL"),V=o("1kSV");function L(e,s){if(1&e&&(I.Wb(0,"option",17),I.Qc(1),I.Vb()),2&e){var o=s.$implicit;I.sc("ngValue",o.courseId),I.Cb(1),I.Rc(o.courseId)}}function _(e,s){if(1&e){var o=I.Xb();I.Wb(0,"tr"),I.Wb(1,"td"),I.Wb(2,"input",18),I.ic("ngModelChange",(function(e){return I.Fc(o),I.kc().copyFromFeedbackSession=e})),I.Vb(),I.Vb(),I.Wb(3,"td"),I.Qc(4),I.Vb(),I.Wb(5,"td"),I.Qc(6),I.Vb(),I.Vb()}if(2&e){var n=s.$implicit,i=I.kc();I.Cb(2),I.sc("ngModel",i.copyFromFeedbackSession)("value",n),I.Cb(2),I.Rc(n.courseId),I.Cb(2),I.Rc(n.feedbackSessionName)}}var W,N,D=((N=function(){function e(s){_classCallCheck(this,e),this.activeModal=s,this.FEEDBACK_SESSION_NAME_MAX_LENGTH=B.a,this.courseCandidates=[],this.existingFeedbackSession=[],this.copyToCourseId="",this.newFeedbackSessionName=""}return _createClass(e,[{key:"copy",value:function(){this.activeModal.close({fromFeedbackSession:this.copyFromFeedbackSession,newFeedbackSessionName:this.newFeedbackSessionName,copyToCourseId:this.copyToCourseId})}},{key:"ngOnInit",value:function(){}}]),e}()).\u0275fac=function(e){return new(e||N)(I.Qb(V.a))},N.\u0275cmp=I.Kb({type:N,selectors:[["tm-copy-from-other-sessions-modal"]],inputs:{courseCandidates:"courseCandidates",existingFeedbackSession:"existingFeedbackSession"},decls:39,vars:6,consts:[[1,"modal-header"],[1,"modal-title"],["type","button",1,"close",3,"click"],[1,"fas","fa-times"],[1,"modal-body"],[1,"row"],[1,"col-12"],[1,"form-group"],["id","copy-course-id",1,"form-control",3,"ngModel","ngModelChange"],[3,"ngValue",4,"ngFor","ngForOf"],["id","copy-session-name","type","text","maxlength","38","placeholder","e.g. Feedback for Project Presentation 1",1,"form-control",3,"ngModel","ngModelChange"],["id","copy-selection-table",1,"table-responsive-lg","table","table-bordered","table-hover"],[1,"bg-primary","text-white"],[4,"ngFor","ngForOf"],[1,"modal-footer"],["id","btn-confirm-copy","type","button",1,"btn","btn-primary",3,"disabled","click"],["type","button",1,"btn","btn-light",3,"click"],[3,"ngValue"],["type","radio","name","copySessionFrom",3,"ngModel","value","ngModelChange"]],template:function(e,s){1&e&&(I.Wb(0,"div",0),I.Wb(1,"h5",1),I.Qc(2,"Creating a new session by copying a previous session"),I.Vb(),I.Wb(3,"button",2),I.ic("click",(function(){return s.activeModal.dismiss()})),I.Rb(4,"i",3),I.Vb(),I.Vb(),I.Wb(5,"div",4),I.Wb(6,"div",5),I.Wb(7,"div",6),I.Wb(8,"div",7),I.Wb(9,"label"),I.Qc(10,"Create in course"),I.Vb(),I.Wb(11,"select",8),I.ic("ngModelChange",(function(e){return s.copyToCourseId=e})),I.Oc(12,L,2,2,"option",9),I.Vb(),I.Vb(),I.Wb(13,"div",7),I.Wb(14,"label"),I.Wb(15,"b"),I.Qc(16,"Name for new session"),I.Vb(),I.Vb(),I.Wb(17,"input",10),I.ic("ngModelChange",(function(e){return s.newFeedbackSessionName=e})),I.Vb(),I.Wb(18,"span"),I.Qc(19),I.Vb(),I.Vb(),I.Wb(20,"div",7),I.Wb(21,"label"),I.Wb(22,"b"),I.Qc(23,"Copy settings and questions from"),I.Vb(),I.Vb(),I.Wb(24,"table",11),I.Wb(25,"thead",12),I.Wb(26,"tr"),I.Wb(27,"th"),I.Qc(28,"\xa0"),I.Vb(),I.Wb(29,"th"),I.Qc(30,"Course ID"),I.Vb(),I.Wb(31,"th"),I.Qc(32,"Feedback Session Name"),I.Vb(),I.Vb(),I.Vb(),I.Oc(33,_,7,4,"tr",13),I.Vb(),I.Vb(),I.Vb(),I.Vb(),I.Vb(),I.Wb(34,"div",14),I.Wb(35,"button",15),I.ic("click",(function(){return s.copy()})),I.Qc(36,"Copy"),I.Vb(),I.Wb(37,"button",16),I.ic("click",(function(){return s.activeModal.dismiss()})),I.Qc(38,"Cancel"),I.Vb(),I.Vb()),2&e&&(I.Cb(11),I.sc("ngModel",s.copyToCourseId),I.Cb(1),I.sc("ngForOf",s.courseCandidates),I.Cb(5),I.sc("ngModel",s.newFeedbackSessionName),I.Cb(2),I.Sc("",s.FEEDBACK_SESSION_NAME_MAX_LENGTH-s.newFeedbackSessionName.length," characters left"),I.Cb(14),I.sc("ngForOf",s.existingFeedbackSession),I.Cb(2),I.sc("disabled",!s.copyFromFeedbackSession||!s.copyToCourseId||!s.newFeedbackSessionName))},directives:[i.B,i.p,i.s,n.t,i.c,i.k,i.u,i.E,i.x],styles:[""]}),N),x=((W=function(){function e(s){_classCallCheck(this,e),this.activeModal=s,this.courseId="",this.feedbackSessionName=""}return _createClass(e,[{key:"ngOnInit",value:function(){}}]),e}()).\u0275fac=function(e){return new(e||W)(I.Qb(V.a))},W.\u0275cmp=I.Kb({type:W,selectors:[["tm-session-permanent-deletion-confirm-modal"]],inputs:{courseId:"courseId",feedbackSessionName:"feedbackSessionName"},decls:13,vars:2,consts:[[1,"modal-header","bg-danger","text-white"],[1,"modal-title"],[1,"fas","fa-times-circle"],["type","button",1,"close",3,"click"],[1,"fas","fa-times"],[1,"modal-body"],[1,"modal-footer"],["type","button",1,"btn","btn-light",3,"click"],["type","button",1,"btn","btn-danger","modal-btn-ok",3,"click"]],template:function(e,s){1&e&&(I.Wb(0,"div",0),I.Wb(1,"h5",1),I.Rb(2,"i",2),I.Qc(3," Confirm deleting feedback session"),I.Vb(),I.Wb(4,"button",3),I.ic("click",(function(){return s.activeModal.dismiss()})),I.Rb(5,"i",4),I.Vb(),I.Vb(),I.Wb(6,"div",5),I.Qc(7),I.Vb(),I.Wb(8,"div",6),I.Wb(9,"button",7),I.ic("click",(function(){return s.activeModal.dismiss()})),I.Qc(10,"No, Cancel the Operation"),I.Vb(),I.Wb(11,"button",8),I.ic("click",(function(){return s.activeModal.close()})),I.Qc(12,"Yes"),I.Vb(),I.Vb()),2&e&&(I.Cb(7),I.Tc(" Are you sure you want to permanently delete the feedback session ",s.feedbackSessionName," in ",s.courseId,"?\n"))},styles:[""]}),W);function A(e,s){if(1&e&&(I.Wb(0,"li"),I.Qc(1),I.Vb()),2&e){var o=s.$implicit;I.Cb(1),I.Tc("",o.courseId,": ",o.feedbackSessionName,"")}}var P,Q=((P=function(){function e(s){_classCallCheck(this,e),this.activeModal=s,this.sessionsToDelete=[]}return _createClass(e,[{key:"ngOnInit",value:function(){}}]),e}()).\u0275fac=function(e){return new(e||P)(I.Qb(V.a))},P.\u0275cmp=I.Kb({type:P,selectors:[["tm-sessions-permanent-deletion-confirm-modal"]],inputs:{sessionsToDelete:"sessionsToDelete"},decls:19,vars:2,consts:[[1,"modal-header","bg-danger","text-white"],[1,"modal-title"],[1,"fas","fa-times-circle"],["type","button",1,"close",3,"click"],[1,"fas","fa-times"],[1,"modal-body"],[4,"ngFor","ngForOf"],[1,"modal-footer"],["type","button",1,"btn","btn-light",3,"click"],["type","button",1,"btn","btn-danger","modal-btn-ok",3,"click"]],template:function(e,s){1&e&&(I.Wb(0,"div",0),I.Wb(1,"h5",1),I.Rb(2,"i",2),I.Qc(3," Confirm deleting all feedback sessions in the Recycle Bin"),I.Vb(),I.Wb(4,"button",3),I.ic("click",(function(){return s.activeModal.dismiss()})),I.Rb(5,"i",4),I.Vb(),I.Vb(),I.Wb(6,"div",5),I.Wb(7,"div"),I.Qc(8),I.Wb(9,"b"),I.Qc(10,"Recycle Bin"),I.Vb(),I.Qc(11,"? "),I.Vb(),I.Wb(12,"ul"),I.Oc(13,A,2,2,"li",6),I.Vb(),I.Vb(),I.Wb(14,"div",7),I.Wb(15,"button",8),I.ic("click",(function(){return s.activeModal.dismiss()})),I.Qc(16,"No, Cancel the Operation"),I.Vb(),I.Wb(17,"button",9),I.ic("click",(function(){return s.activeModal.close()})),I.Qc(18,"Yes"),I.Vb(),I.Vb()),2&e&&(I.Cb(8),I.Sc(" Are you sure you want to permanently delete the following ",s.sessionsToDelete.length," feedback sessions in the "),I.Cb(5),I.sc("ngForOf",s.sessionsToDelete))},directives:[n.t],styles:[""]}),P),j=o("Uqoa"),H=o("Pvcr"),q=o("MbNv"),U=o("YxrJ"),z=o("iRmZ"),K=o("++8I"),G=o("I8MS"),X=o("eQqG"),Z=o("ax2R"),Y=o("vKUq"),J=o("Babz"),$=o("Lcal"),ee=o("W872"),se=o("chhc"),oe=o("H5dr"),ne=o("kwSR");function ie(e,s){1&e&&(I.Wb(0,"div",10),I.Qc(1," You have not created any courses yet, or you have no active courses. Go "),I.Wb(2,"a",11),I.Qc(3,"here"),I.Vb(),I.Qc(4," to create or unarchive a course.\n"),I.Vb())}function te(e,s){if(1&e){var o=I.Xb();I.Wb(0,"div"),I.Wb(1,"tm-session-edit-form",12),I.ic("modelChange",(function(e){return I.Fc(o),I.kc(2).sessionEditFormModel=e}))("addNewSessionEvent",(function(){return I.Fc(o),I.kc(2).addNewSessionHandler()}))("copyOtherSessionsEvent",(function(){return I.Fc(o),I.kc(2).copyFromOtherSessionsHandler()}))("closeEditFormEvent",(function(){return I.Fc(o),I.kc(2).isSessionEditFormExpanded=!1})),I.Vb(),I.Vb()}if(2&e){var n=I.kc(2);I.Cb(1),I.sc("formMode",n.SessionEditFormMode.ADD)("model",n.sessionEditFormModel)("courseCandidates",n.courseCandidates)("templateSessions",n.templateSessions)}}function re(e,s){if(1&e&&(I.Wb(0,"div",5),I.Oc(1,te,2,4,"div",6),I.Vb()),2&e){var o=I.kc();I.sc("@collapseAnim",void 0),I.Cb(1),I.sc("tmIsLoading",o.isCopyOtherSessionLoading)}}function ae(e,s){1&e&&(I.Wb(0,"div",15),I.Qc(1," You have not created any sessions yet. Use the form above to create a session. "),I.Vb())}var ce=function(e){return[e]};function de(e,s){if(1&e){var o=I.Xb();I.Wb(0,"tm-sessions-table",16),I.ic("sortSessionsTableRowModelsEvent",(function(e){return I.Fc(o),I.kc(2).sortSessionsTableRowModelsEvent(e)}))("loadResponseRateEvent",(function(e){return I.Fc(o),I.kc(2).loadResponseRateEventHandler(e)}))("editSessionEvent",(function(e){return I.Fc(o),I.kc(2).editSessionEventHandler(e)}))("moveSessionToRecycleBinEvent",(function(e){return I.Fc(o),I.kc(2).moveSessionToRecycleBinEventHandler(e)}))("copySessionEvent",(function(e){return I.Fc(o),I.kc(2).copySessionEventHandler(e)}))("submitSessionAsInstructorEvent",(function(e){return I.Fc(o),I.kc(2).submitSessionAsInstructorEventHandler(e)}))("viewSessionResultEvent",(function(e){return I.Fc(o),I.kc(2).viewSessionResultEventHandler(e)}))("publishSessionEvent",(function(e){return I.Fc(o),I.kc(2).publishSessionEventHandler(e)}))("unpublishSessionEvent",(function(e){return I.Fc(o),I.kc(2).unpublishSessionEventHandler(e)}))("downloadSessionResultsEvent",(function(e){return I.Fc(o),I.kc(2).downloadSessionResultEventHandler(e)}))("resendResultsLinkToStudentsEvent",(function(e){I.Fc(o);var s=I.kc(2);return s.resendResultsLinkToRespondentsEventHandler(s.sessionsTableRowModels[e])}))("sendRemindersToStudentsEvent",(function(e){I.Fc(o);var s=I.kc(2);return s.sendRemindersToRespondentsEventHandler(s.sessionsTableRowModels[e])})),I.Vb()}if(2&e){var n=I.kc(2);I.sc("sessionsTableRowModels",n.sessionsTableRowModels)("sessionsTableRowModelsSortBy",n.sessionsTableRowModelsSortBy)("sessionsTableRowModelsSortOrder",n.sessionsTableRowModelsSortOrder)("courseCandidates",n.courseCandidates)("columnsToShow",I.wc(6,ce,n.SessionsTableColumn.COURSE_ID))("headerColorScheme",n.SessionsTableHeaderColorScheme.BLUE)}}function le(e,s){if(1&e&&(I.Wb(0,"div"),I.Oc(1,ae,2,0,"div",13),I.Oc(2,de,1,8,"tm-sessions-table",14),I.Vb()),2&e){var o=I.kc();I.Cb(1),I.sc("ngIf",0===o.sessionsTableRowModels.length&&!o.isFeedbackSessionsLoading),I.Cb(1),I.sc("tmIsLoading",o.isFeedbackSessionsLoading)}}function ue(e,s){if(1&e){var o=I.Xb();I.Wb(0,"tm-sessions-recycle-bin-table",17),I.ic("restoreSessionEvent",(function(e){return I.Fc(o),I.kc().restoreRecycleBinFeedbackSession(e)}))("restoreAllRecycleBinFeedbackSessionEvent",(function(){return I.Fc(o),I.kc().restoreAllRecycleBinFeedbackSession()}))("permanentlyDeleteSessionEvent",(function(e){return I.Fc(o),I.kc().permanentDeleteSession(e)}))("permanentDeleteAllSessionsEvent",(function(){return I.Fc(o),I.kc().permanentDeleteAllSessions()}))("sortRecycleBinFeedbackSessionRowsEvent",(function(e){return I.Fc(o),I.kc().sortRecycleBinFeedbackSessionRowsEvent(e)}))("recycleBinExpandEvent",(function(){I.Fc(o);var e=I.kc();return e.isRecycleBinExpanded=!e.isRecycleBinExpanded})),I.Vb()}if(2&e){var n=I.kc();I.sc("isRecycleBinExpanded",n.isRecycleBinExpanded)("recycleBinFeedbackSessionRowModels",n.recycleBinFeedbackSessionRowModels)("recycleBinFeedbackSessionRowModelsSortBy",n.recycleBinFeedbackSessionRowModelsSortBy)("recycleBinFeedbackSessionRowModelsSortOrder",n.recycleBinFeedbackSessionRowModelsSortOrder)}}var be,me,he=[{path:"",component:(be=function(e){_inherits(o,e);var s=_createSuper(o);function o(e,n,i,t,r,a,c,d,l,u,b,m,h,S){var f;return _classCallCheck(this,o),(f=s.call(this,e,d,n,i,t,r,l,a,u,b,c)).courseService=m,f.route=h,f.timezoneService=S,f.SortBy=M.a,f.SortOrder=M.b,f.SessionEditFormMode=w.a,f.SessionsTableColumn=T.a,f.SessionsTableHeaderColorScheme=T.b,f.courseId="",f.courseCandidates=[],f.templateSessions=[],f.sessionEditFormModel={courseId:"",timeZone:"UTC",courseName:"",feedbackSessionName:"",instructions:"Please answer all the given questions.",submissionStartTime:{hour:23,minute:59},submissionStartDate:{year:0,month:0,day:0},submissionEndTime:{hour:23,minute:59},submissionEndDate:{year:0,month:0,day:0},gracePeriod:15,sessionVisibleSetting:R.o.AT_OPEN,customSessionVisibleTime:{hour:23,minute:59},customSessionVisibleDate:{year:0,month:0,day:0},responseVisibleSetting:R.n.LATER,customResponseVisibleTime:{hour:23,minute:59},customResponseVisibleDate:{year:0,month:0,day:0},submissionStatus:R.f.OPEN,publishStatus:R.e.NOT_PUBLISHED,isClosingEmailEnabled:!0,isPublishedEmailEnabled:!0,templateSessionName:"",isSaving:!1,isEditable:!0,isDeleting:!1,isCopying:!1,hasVisibleSettingsPanelExpanded:!1,hasEmailSettingsPanelExpanded:!1},f.isSessionEditFormExpanded=!1,f.sessionsTableRowModels=[],f.sessionsTableRowModelsSortBy=M.a.NONE,f.sessionsTableRowModelsSortOrder=M.b.ASC,f.isRecycleBinExpanded=!1,f.recycleBinFeedbackSessionRowModels=[],f.recycleBinFeedbackSessionRowModelsSortBy=M.a.NONE,f.recycleBinFeedbackSessionRowModelsSortOrder=M.b.ASC,f.isCopyOtherSessionLoading=!1,f.isCoursesLoading=!0,f.isFeedbackSessionsLoading=!0,f.isMoveToRecycleBinLoading=!1,f.isCopySessionLoading=!1,f.isRecycleBinLoading=!0,f.isRestoreFeedbackSessionLoading=!1,f.isPermanentDeleteLoading=!1,f.hasCourseLoadingFailed=!1,f.hasFeedbackSessionLoadingFailed=!1,f}return _createClass(o,[{key:"ngOnInit",value:function(){var e=this;this.route.queryParams.subscribe((function(s){e.courseId=s.courseid})),this.isSessionEditFormExpanded=!!this.courseId,this.templateSessions=this.feedbackSessionsService.getTemplateSessions(),this.loadCandidatesCourse(),this.loadFeedbackSessions(),this.loadRecycleBinFeedbackSessions()}},{key:"copyFromOtherSessionsHandler",value:function(){var e=this;this.isCopyOtherSessionLoading=!0;var s=this.ngbModal.open(D);s.componentInstance.copyToCourseId=this.sessionEditFormModel.courseId,s.componentInstance.courseCandidates=this.courseCandidates,s.componentInstance.existingFeedbackSession=this.sessionsTableRowModels.map((function(e){return e.feedbackSession})),s.result.then((function(s){e.copyFeedbackSession(s.fromFeedbackSession,s.newFeedbackSessionName,s.copyToCourseId).pipe(Object(p.a)((function(){return e.isCopyOtherSessionLoading=!1}))).subscribe((function(s){e.navigationService.navigateWithSuccessMessage(e.router,"/web/instructor/sessions/edit","The feedback session has been copied. Please modify settings/questions as necessary.",{courseid:s.courseId,fsname:s.feedbackSessionName})}),(function(s){e.statusMessageService.showErrorToast(s.error.message)}))}))}},{key:"loadCandidatesCourse",value:function(){var e=this;this.isCoursesLoading=!0,this.courseService.getInstructorCoursesThatAreActive().pipe(Object(p.a)((function(){return e.isCoursesLoading=!1}))).subscribe((function(s){e.courseCandidates=s.courses,e.initDefaultValuesForSessionEditForm()}),(function(s){e.resetAllModels(),e.hasCourseLoadingFailed=!0,e.statusMessageService.showErrorToast(s.error.message)}))}},{key:"initDefaultValuesForSessionEditForm",value:function(){var e=this,s=this.courseCandidates.find((function(s){return s.courseId===e.courseId}));s?(this.sessionEditFormModel.courseId=s.courseId,this.sessionEditFormModel.courseName=s.courseName,this.sessionEditFormModel.timeZone=s.timeZone):0!==this.courseCandidates.length&&(this.sessionEditFormModel.courseId=this.courseCandidates[0].courseId,this.sessionEditFormModel.courseName=this.courseCandidates[0].courseName,this.sessionEditFormModel.timeZone=this.courseCandidates[0].timeZone),0!==this.templateSessions.length&&(this.sessionEditFormModel.templateSessionName=this.templateSessions[0].name);var o=h()().add(1,"hours");this.sessionEditFormModel.submissionStartDate={year:o.year(),month:o.month()+1,day:o.date()},this.sessionEditFormModel.submissionStartTime={minute:0===o.hour()?59:0,hour:0===o.hour()?23:o.hour()};var n=h()().add(1,"days");this.sessionEditFormModel.submissionEndDate={year:n.year(),month:n.month()+1,day:n.date()},this.sessionEditFormModel.submissionEndTime={minute:59,hour:23}}},{key:"addNewSessionHandler",value:function(){var e=this;this.sessionEditFormModel.isSaving=!0;var s=[];Object(S.a)([this.resolveLocalDateTime(this.sessionEditFormModel.submissionStartDate,this.sessionEditFormModel.submissionStartTime,this.sessionEditFormModel.timeZone,"Submission opening time",s),this.resolveLocalDateTime(this.sessionEditFormModel.submissionEndDate,this.sessionEditFormModel.submissionEndTime,this.sessionEditFormModel.timeZone,"Submission closing time",s),this.sessionEditFormModel.sessionVisibleSetting===R.o.CUSTOM?this.resolveLocalDateTime(this.sessionEditFormModel.customSessionVisibleDate,this.sessionEditFormModel.customSessionVisibleTime,this.sessionEditFormModel.timeZone,"Session visible time",s):Object(f.a)(0),this.sessionEditFormModel.responseVisibleSetting===R.n.CUSTOM?this.resolveLocalDateTime(this.sessionEditFormModel.customResponseVisibleDate,this.sessionEditFormModel.customResponseVisibleTime,this.sessionEditFormModel.timeZone,"Response visible time",s):Object(f.a)(0)]).pipe(Object(v.a)((function(s){return e.feedbackSessionsService.createFeedbackSession(e.sessionEditFormModel.courseId,{feedbackSessionName:e.sessionEditFormModel.feedbackSessionName,instructions:e.sessionEditFormModel.instructions,submissionStartTimestamp:s[0],submissionEndTimestamp:s[1],gracePeriod:e.sessionEditFormModel.gracePeriod,sessionVisibleSetting:e.sessionEditFormModel.sessionVisibleSetting,customSessionVisibleTimestamp:s[2],responseVisibleSetting:e.sessionEditFormModel.responseVisibleSetting,customResponseVisibleTimestamp:s[3],isClosingEmailEnabled:e.sessionEditFormModel.isClosingEmailEnabled,isPublishedEmailEnabled:e.sessionEditFormModel.isPublishedEmailEnabled})}))).subscribe((function(o){var n=e.feedbackSessionsService.getTemplateSessions().find((function(s){return s.name===e.sessionEditFormModel.templateSessionName}));n&&Object(f.a).apply(void 0,_toConsumableArray(n.questions)).pipe(Object(y.a)((function(s){return e.feedbackQuestionsService.createFeedbackQuestion(o.courseId,o.feedbackSessionName,{questionNumber:s.questionNumber,questionBrief:s.questionBrief,questionDescription:s.questionDescription,questionDetails:s.questionDetails,questionType:s.questionType,giverType:s.giverType,recipientType:s.recipientType,numberOfEntitiesToGiveFeedbackToSetting:s.numberOfEntitiesToGiveFeedbackToSetting,customNumberOfEntitiesToGiveFeedbackTo:s.customNumberOfEntitiesToGiveFeedbackTo,showResponsesTo:s.showResponsesTo,showGiverNameTo:s.showGiverNameTo,showRecipientNameTo:s.showRecipientNameTo})}))).subscribe((function(){}),(function(s){e.sessionEditFormModel.isSaving=!1,e.statusMessageService.showErrorToast("The session is created but the template questions cannot be created: "+s.error.message)}),(function(){e.navigationService.navigateByURLWithParamEncoding(e.router,"/web/instructor/sessions/edit",{courseid:o.courseId,fsname:o.feedbackSessionName}).then((function(){s.forEach((function(s){e.statusMessageService.showWarningToast(s)})),e.statusMessageService.showSuccessToast('The feedback session has been added.Click the "Add New Question" button below to begin adding questions for the feedback session.')}))}))}),(function(s){e.sessionEditFormModel.isSaving=!1,e.statusMessageService.showErrorToast(s.error.message)}))}},{key:"resolveLocalDateTime",value:function(e,s,o,n,i){var t=h()();t.set("year",e.year),t.set("month",e.month-1),t.set("date",e.day),t.set("hour",s.hour),t.set("minute",s.minute);var r=t.format(E.a);return this.timezoneService.getResolvedTimestamp(r,o,n).pipe(Object(g.a)((function(e){0!==e.message.length&&i.push(e.message)})),Object(k.a)((function(e){return e.timestamp})))}},{key:"loadFeedbackSessions",value:function(){var e=this;this.isFeedbackSessionsLoading=!0,this.feedbackSessionsService.getFeedbackSessionsForInstructor().pipe(Object(p.a)((function(){return e.isFeedbackSessionsLoading=!1}))).subscribe((function(s){s.feedbackSessions.forEach((function(s){e.sessionsTableRowModels.push({feedbackSession:s,responseRate:"",isLoadingResponseRate:!1,instructorPrivilege:s.privileges||F.a})}))}),(function(s){e.resetAllModels(),e.hasFeedbackSessionLoadingFailed=!0,e.statusMessageService.showErrorToast(s.error.message)}),(function(){return e.sortSessionsTableRowModelsEvent(M.a.COURSE_ID)}))}},{key:"sortSessionsTableRowModelsEvent",value:function(e){this.sessionsTableRowModelsSortBy=e,this.sessionsTableRowModelsSortOrder=this.sessionsTableRowModelsSortOrder===M.b.DESC?M.b.ASC:M.b.DESC,this.sessionsTableRowModels.sort(this.sortModelsBy(e,this.sessionsTableRowModelsSortOrder))}},{key:"sortRecycleBinFeedbackSessionRowsEvent",value:function(e){this.recycleBinFeedbackSessionRowModelsSortBy=e,this.recycleBinFeedbackSessionRowModelsSortOrder=this.recycleBinFeedbackSessionRowModelsSortOrder===M.b.DESC?M.b.ASC:M.b.DESC,this.recycleBinFeedbackSessionRowModels.sort(this.sortModelsBy(e,this.recycleBinFeedbackSessionRowModelsSortOrder))}},{key:"loadResponseRateEventHandler",value:function(e){this.loadResponseRate(this.sessionsTableRowModels[e])}},{key:"editSessionEventHandler",value:function(e){this.editSession(this.sessionsTableRowModels[e])}},{key:"restoreRecycleBinFeedbackSession",value:function(e){var s=this;this.isRestoreFeedbackSessionLoading=!0,this.feedbackSessionsService.deleteSessionFromRecycleBin(e.feedbackSession.courseId,e.feedbackSession.feedbackSessionName).pipe(Object(p.a)((function(){return s.isRestoreFeedbackSessionLoading=!1}))).subscribe((function(o){s.recycleBinFeedbackSessionRowModels.splice(s.recycleBinFeedbackSessionRowModels.indexOf(e),1),s.sessionsTableRowModels.push({feedbackSession:o,responseRate:"",isLoadingResponseRate:!1,instructorPrivilege:o.privileges||F.a}),s.statusMessageService.showSuccessToast("The feedback session has been restored.")}),(function(e){s.statusMessageService.showErrorToast(e.error.message)}))}},{key:"moveSessionToRecycleBinEventHandler",value:function(e){var s=this;this.isMoveToRecycleBinLoading=!0;var o=this.sessionsTableRowModels[e];this.feedbackSessionsService.moveSessionToRecycleBin(o.feedbackSession.courseId,o.feedbackSession.feedbackSessionName).pipe(Object(p.a)((function(){return s.isMoveToRecycleBinLoading=!1}))).subscribe((function(e){s.sessionsTableRowModels.splice(s.sessionsTableRowModels.indexOf(o),1),s.recycleBinFeedbackSessionRowModels.push({feedbackSession:e}),s.statusMessageService.showSuccessToast("The feedback session has been deleted. You can restore it from the deleted sessions table below.")}),(function(e){s.statusMessageService.showErrorToast(e.error.message)}))}},{key:"copySessionEventHandler",value:function(e){var s=this;this.isCopySessionLoading=!0,this.failedToCopySessions={};var o=this.createSessionCopyRequestsFromRowModel(this.sessionsTableRowModels[e.sessionToCopyRowIndex],e);1===o.length&&this.copySingleSession(o[0]),o.length>1&&Object(S.a)(o).pipe(Object(p.a)((function(){return s.isCopySessionLoading=!1}))).subscribe((function(e){e.length>0&&e.forEach((function(e){s.sessionsTableRowModels.push({feedbackSession:e,responseRate:"",isLoadingResponseRate:!1,instructorPrivilege:e.privileges||F.a})})),s.showCopyStatusMessage()}))}},{key:"submitSessionAsInstructorEventHandler",value:function(e){this.submitSessionAsInstructor(this.sessionsTableRowModels[e])}},{key:"viewSessionResultEventHandler",value:function(e){this.viewSessionResult(this.sessionsTableRowModels[e])}},{key:"publishSessionEventHandler",value:function(e){this.publishSession(this.sessionsTableRowModels[e])}},{key:"unpublishSessionEventHandler",value:function(e){this.unpublishSession(this.sessionsTableRowModels[e])}},{key:"downloadSessionResultEventHandler",value:function(e){this.downloadSessionResult(this.sessionsTableRowModels[e])}},{key:"loadRecycleBinFeedbackSessions",value:function(){var e=this;this.isRecycleBinLoading=!0,this.feedbackSessionsService.getFeedbackSessionsInRecycleBinForInstructor().pipe(Object(p.a)((function(){return e.isRecycleBinLoading=!1}))).subscribe((function(s){s.feedbackSessions.forEach((function(s){e.recycleBinFeedbackSessionRowModels.push({feedbackSession:s})}))}),(function(s){e.resetAllModels(),e.hasFeedbackSessionLoadingFailed=!0,e.statusMessageService.showErrorToast(s.error.message)}),(function(){return e.sortRecycleBinFeedbackSessionRowsEvent(M.a.SESSION_DELETION_DATE)}))}},{key:"restoreAllRecycleBinFeedbackSession",value:function(){var e=this;this.isRestoreFeedbackSessionLoading=!0;var s=[];this.recycleBinFeedbackSessionRowModels.forEach((function(o){s.push(e.feedbackSessionsService.deleteSessionFromRecycleBin(o.feedbackSession.courseId,o.feedbackSession.feedbackSessionName))})),Object(S.a)(s).pipe(Object(p.a)((function(){return e.isRestoreFeedbackSessionLoading=!1}))).subscribe((function(s){s.forEach((function(s){e.recycleBinFeedbackSessionRowModels=[],e.sessionsTableRowModels.push({feedbackSession:s,responseRate:"",isLoadingResponseRate:!1,instructorPrivilege:s.privileges||F.a})})),e.statusMessageService.showSuccessToast("All sessions have been restored.")}),(function(s){e.statusMessageService.showErrorToast(s.error.message)}))}},{key:"permanentDeleteSession",value:function(e){var s=this;this.isPermanentDeleteLoading=!0;var o=this.ngbModal.open(x);o.componentInstance.courseId=e.feedbackSession.courseId,o.componentInstance.feedbackSessionName=e.feedbackSession.feedbackSessionName,o.result.then((function(){s.feedbackSessionsService.deleteFeedbackSession(e.feedbackSession.courseId,e.feedbackSession.feedbackSessionName).pipe(Object(p.a)((function(){return s.isPermanentDeleteLoading=!1}))).subscribe((function(){s.recycleBinFeedbackSessionRowModels.splice(s.recycleBinFeedbackSessionRowModels.indexOf(e),1),s.statusMessageService.showSuccessToast("The feedback session has been permanently deleted.")}),(function(e){s.statusMessageService.showErrorToast(e.error.message)}))}))}},{key:"permanentDeleteAllSessions",value:function(){var e=this;this.isPermanentDeleteLoading=!0;var s=this.ngbModal.open(Q);s.componentInstance.sessionsToDelete=this.recycleBinFeedbackSessionRowModels.map((function(e){return e.feedbackSession})),s.result.then((function(){var s=[];e.recycleBinFeedbackSessionRowModels.forEach((function(o){s.push(e.feedbackSessionsService.deleteFeedbackSession(o.feedbackSession.courseId,o.feedbackSession.feedbackSessionName))})),Object(S.a)(s).pipe(Object(p.a)((function(){return e.isPermanentDeleteLoading=!1}))).subscribe((function(){e.recycleBinFeedbackSessionRowModels=[],e.statusMessageService.showSuccessToast("All sessions have been permanently deleted.")}),(function(s){e.statusMessageService.showErrorToast(s.error.message)}))}))}},{key:"retryLoadingAllData",value:function(){this.hasFeedbackSessionLoadingFailed=!1,this.hasCourseLoadingFailed=!1,this.loadCandidatesCourse(),this.loadFeedbackSessions(),this.loadRecycleBinFeedbackSessions()}},{key:"resetAllModels",value:function(){this.courseCandidates=[],this.sessionsTableRowModels=[],this.recycleBinFeedbackSessionRowModels=[]}}]),o}(O.a),be.\u0275fac=function(e){return new(e||be)(I.Qb(t.d),I.Qb(j.a),I.Qb(H.a),I.Qb(q.a),I.Qb(U.a),I.Qb(V.m),I.Qb(z.a),I.Qb(K.a),I.Qb(G.a),I.Qb(X.a),I.Qb(Z.a),I.Qb(Y.a),I.Qb(t.a),I.Qb(E.b))},be.\u0275cmp=I.Kb({type:be,selectors:[["tm-instructor-sessions-page"]],features:[I.zb],decls:16,vars:7,consts:[["class","alert alert-warning","role","alert",4,"ngIf"],["id","btn-add-session",1,"btn","btn-success",3,"disabled","click"],[1,"fas","fa-plus"],["class","margin-top-30px",4,"ngIf"],[3,"shouldShowRetry","message","retryEvent"],[1,"margin-top-30px"],[4,"tmIsLoading"],[1,"row"],[1,"col-12","text-muted"],[3,"isRecycleBinExpanded","recycleBinFeedbackSessionRowModels","recycleBinFeedbackSessionRowModelsSortBy","recycleBinFeedbackSessionRowModelsSortOrder","restoreSessionEvent","restoreAllRecycleBinFeedbackSessionEvent","permanentlyDeleteSessionEvent","permanentDeleteAllSessionsEvent","sortRecycleBinFeedbackSessionRowsEvent","recycleBinExpandEvent",4,"tmIsLoading"],["role","alert",1,"alert","alert-warning"],["tmRouterLink","/web/instructor/courses"],[3,"formMode","model","courseCandidates","templateSessions","modelChange","addNewSessionEvent","copyOtherSessionsEvent","closeEditFormEvent"],["class","alert alert-warning margin-top-30px","role","alert",4,"ngIf"],[3,"sessionsTableRowModels","sessionsTableRowModelsSortBy","sessionsTableRowModelsSortOrder","courseCandidates","columnsToShow","headerColorScheme","sortSessionsTableRowModelsEvent","loadResponseRateEvent","editSessionEvent","moveSessionToRecycleBinEvent","copySessionEvent","submitSessionAsInstructorEvent","viewSessionResultEvent","publishSessionEvent","unpublishSessionEvent","downloadSessionResultsEvent","resendResultsLinkToStudentsEvent","sendRemindersToStudentsEvent",4,"tmIsLoading"],["role","alert",1,"alert","alert-warning","margin-top-30px"],[3,"sessionsTableRowModels","sessionsTableRowModelsSortBy","sessionsTableRowModelsSortOrder","courseCandidates","columnsToShow","headerColorScheme","sortSessionsTableRowModelsEvent","loadResponseRateEvent","editSessionEvent","moveSessionToRecycleBinEvent","copySessionEvent","submitSessionAsInstructorEvent","viewSessionResultEvent","publishSessionEvent","unpublishSessionEvent","downloadSessionResultsEvent","resendResultsLinkToStudentsEvent","sendRemindersToStudentsEvent"],[3,"isRecycleBinExpanded","recycleBinFeedbackSessionRowModels","recycleBinFeedbackSessionRowModelsSortBy","recycleBinFeedbackSessionRowModelsSortOrder","restoreSessionEvent","restoreAllRecycleBinFeedbackSessionEvent","permanentlyDeleteSessionEvent","permanentDeleteAllSessionsEvent","sortRecycleBinFeedbackSessionRowsEvent","recycleBinExpandEvent"]],template:function(e,s){1&e&&(I.Oc(0,ie,5,0,"div",0),I.Wb(1,"div"),I.Wb(2,"button",1),I.ic("click",(function(){return s.isSessionEditFormExpanded=!0})),I.Rb(3,"i",2),I.Qc(4," Add New Feedback Session "),I.Vb(),I.Vb(),I.Oc(5,re,2,2,"div",3),I.Wb(6,"tm-loading-retry",4),I.ic("retryEvent",(function(){return s.retryLoadingAllData()})),I.Wb(7,"div",5),I.Oc(8,le,3,2,"div",6),I.Vb(),I.Rb(9,"br"),I.Wb(10,"div",7),I.Wb(11,"div",8),I.Wb(12,"p"),I.Qc(13," Note: The table above doesn't contain sessions from archived courses and soft-deleted courses. To view sessions from an archived course, unarchive the course first; to view sessions from a course in recycle bin, restore the course first. "),I.Vb(),I.Vb(),I.Vb(),I.Wb(14,"div",5),I.Oc(15,ue,1,4,"tm-sessions-recycle-bin-table",9),I.Vb(),I.Vb()),2&e&&(I.sc("ngIf",!s.isCoursesLoading&&0===s.courseCandidates.length&&!s.hasCourseLoadingFailed),I.Cb(2),I.sc("disabled",s.isSessionEditFormExpanded||s.isCoursesLoading),I.Cb(3),I.sc("ngIf",s.isSessionEditFormExpanded&&!s.isCoursesLoading),I.Cb(1),I.sc("shouldShowRetry",s.hasCourseLoadingFailed||s.hasFeedbackSessionLoadingFailed)("message","Failed to load data"),I.Cb(2),I.sc("tmIsLoading",s.isCoursesLoading||s.isMoveToRecycleBinLoading||s.isCopySessionLoading||s.isSendReminderLoading||s.isResultActionLoading),I.Cb(7),I.sc("tmIsLoading",s.isRecycleBinLoading||s.isRestoreFeedbackSessionLoading||s.isPermanentDeleteLoading))},directives:[n.u,J.a,$.a,ee.a,se.a,oe.a,ne.a],styles:[".margin-top-30px[_ngcontent-%COMP%]{margin-top:30px}.sortable-header[_ngcontent-%COMP%]{cursor:pointer}.actions-cell[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:2px}"],data:{animation:[C.a]}}),be)}],Se=((me=function e(){_classCallCheck(this,e)}).\u0275mod=I.Ob({type:me}),me.\u0275inj=I.Nb({factory:function(e){return new(e||me)},imports:[[n.c,c.a,u.a,i.j,l.a,d.a,t.h.forChild(he),a.a,r.a,b.a]]}),me)},QlvD:function(e,s,o){"use strict";o.d(s,"a",(function(){return u}));var n=o("fXoL"),i=o("8xKp"),t=o("Wuvc"),r=o("ofXK"),a=o("fB2i"),c=o("3Pt+"),d=function(e){return{"editor-disabled":e}};function l(e,s){if(1&e){var o=n.Xb();n.Wb(0,"editor",2),n.ic("ngModelChange",(function(e){return n.Fc(o),n.kc().richTextChange.emit(e)})),n.Vb()}if(2&e){var i=n.kc();n.sc("ngClass",n.wc(5,d,i.isDisabled))("init",i.init)("disabled",i.isDisabled)("ngModel",i.richText),n.Db("placeholder",i.placeholderText)}}var u=function(){var e=function(){function e(){_classCallCheck(this,e),this.isDisabled=!1,this.minHeightInPx=150,this.placeholderText="",this.richText="",this.richTextChange=new n.n,this.init={},this.render=!1}return _createClass(e,[{key:"ngOnInit",value:function(){this.init=this.getEditorSettings()}},{key:"getEditorSettings",value:function(){return{base_url:i.a,skin_url:i.a+"/skins/ui/oxide",content_css:"/assets/tinymce/tinymce.css",suffix:".min",height:this.minHeightInPx,resize:!0,inline:!1,relative_urls:!1,convert_urls:!1,remove_linebreaks:!1,placeholder:this.placeholderText,plugins:["advlist autolink autoresize lists link image charmap hr anchor","searchreplace wordcount visualblocks visualchars code","insertdatetime nonbreaking save table directionality","emoticons paste textpattern"],menubar:!1,autoresize_bottom_margin:50,toolbar1:"styleselect | forecolor backcolor | bold italic underline strikethrough subscript superscript | alignleft aligncenter alignright alignjustify | bullist numlist | link image charmap emoticons"}}},{key:"renderEditor",value:function(e){e.visible&&(this.render=!0)}}]),e}();return e.\u0275fac=function(s){return new(s||e)},e.\u0275cmp=n.Kb({type:e,selectors:[["tm-rich-text-editor"]],inputs:{isDisabled:"isDisabled",minHeightInPx:"minHeightInPx",placeholderText:"placeholderText",richText:"richText"},outputs:{richTextChange:"richTextChange"},decls:2,vars:1,consts:[["inViewport","",3,"inViewportAction"],["class","editor",3,"ngClass","init","disabled","ngModel","ngModelChange",4,"ngIf"],[1,"editor",3,"ngClass","init","disabled","ngModel","ngModelChange"]],template:function(e,s){1&e&&(n.Wb(0,"div",0),n.ic("inViewportAction",(function(e){return s.renderEditor(e)})),n.Oc(1,l,1,7,"editor",1),n.Vb()),2&e&&(n.Cb(1),n.sc("ngIf",s.render))},directives:[t.a,r.u,a.a,r.r,c.p,c.s],styles:[".editor[_ngcontent-%COMP%]{background-color:#fff}.editor-disabled[_ngcontent-%COMP%]{background-color:#e9ecef;opacity:1}.editor-disabled[_ngcontent-%COMP%]     .tox-tinymce{opacity:.5}.placeholder[_ngcontent-%COMP%]{padding:.375rem .75rem;position:absolute}"]}),e}()}}]);