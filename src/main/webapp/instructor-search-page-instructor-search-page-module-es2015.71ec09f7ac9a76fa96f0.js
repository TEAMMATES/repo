(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{"++8I":function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));var r=s("vMQM"),n=s("fXoL"),c=s("mW1j");let o=(()=>{class e{constructor(e){this.httpRequestService=e}loadInstructors(e){const t={courseid:e.courseId};return e.intent&&(t.intent=e.intent),this.httpRequestService.get(r.d.INSTRUCTORS,t)}getInstructor(e){const t={courseid:e.courseId,intent:e.intent};return e.feedbackSessionName&&(t.fsname=e.feedbackSessionName),e.key&&(t.key=e.key),e.moderatedPerson&&(t.moderatedperson=e.moderatedPerson),e.previewAs&&(t.previewas=e.previewAs),this.httpRequestService.get(r.d.INSTRUCTOR,t)}createInstructor(e){return this.httpRequestService.post(r.d.INSTRUCTOR,{courseid:e.courseId},e.requestBody)}updateInstructor(e){return this.httpRequestService.put(r.d.INSTRUCTOR,{courseid:e.courseId},e.requestBody)}deleteInstructor(e){const t={courseid:e.courseId};return e.instructorEmail&&(t.instructoremail=e.instructorEmail),e.instructorId&&(t.instructorid=e.instructorId),this.httpRequestService.delete(r.d.INSTRUCTOR,t)}loadInstructorPrivilege(e){const t={courseid:e.courseId};return e.feedbackSessionName&&(t.fsname=e.feedbackSessionName),e.sectionName&&(t.sectionname=e.sectionName),e.instructorRole&&(t.instructorrole=e.instructorRole),e.instructorEmail&&(t.instructoremail=e.instructorEmail),e.instructorId&&(t.instructorid=e.instructorId),this.httpRequestService.get(r.d.INSTRUCTOR_PRIVILEGE,t)}updateInstructorPrivilege(e){return this.httpRequestService.put(r.d.INSTRUCTOR_PRIVILEGE,{courseid:e.courseId,instructoremail:e.instructorEmail},e.requestBody)}}return e.\u0275fac=function(t){return new(t||e)(n.ec(c.a))},e.\u0275prov=n.Mb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()},"7aI+":function(e,t,s){"use strict";s.r(t),s.d(t,"InstructorSearchPageModule",(function(){return R}));var r=s("ofXK"),n=s("tyNb"),c=s("aSpy"),o=s("qw4y"),i=s("cp0P"),u=s("LRne"),a=s("lJxs"),d=s("5+tZ"),h=s("nYR2"),m=s("fXoL"),l=s("Uqoa"),S=s("wCPp"),f=s("vKUq"),b=s("KVTi"),I=s("Lcal"),v=s("pDZj");function p(e,t){if(1&e){const e=m.Xb();m.Wb(0,"tm-student-result-table",3),m.ic("removeStudentFromCourseEvent",(function(t){return m.Fc(e),m.kc(2).removeStudentFromCourse(t)})),m.Vb()}if(2&e){const e=m.kc(2);m.sc("studentTables",e.studentsListRowTables)}}function g(e,t){if(1&e&&(m.Wb(0,"div"),m.Oc(1,p,1,1,"tm-student-result-table",2),m.Vb()),2&e){const e=m.kc();m.Cb(1),m.sc("ngIf",e.studentsListRowTables&&e.studentsListRowTables.length)}}const w=[{path:"",component:(()=>{class e{constructor(e,t,s){this.statusMessageService=e,this.searchService=t,this.courseService=s,this.searchParams={searchKey:""},this.studentsListRowTables=[],this.isSearching=!1}ngOnInit(){}search(){""!==this.searchParams.searchKey&&(this.isSearching=!0,this.searchService.searchInstructor(this.searchParams.searchKey).pipe(Object(a.a)(e=>this.getCoursesWithStudents(e.students)),Object(d.a)(e=>Object(i.a)([Object(u.a)(e),this.getPrivileges(e)])),Object(a.a)(e=>this.combinePrivileges(e)),Object(h.a)(()=>this.isSearching=!1)).subscribe(e=>{const t=e.searchStudentTables,s=!(!t||!t.length);this.studentsListRowTables=s?t:[],s||this.statusMessageService.showWarningToast("No results found.")},e=>{this.statusMessageService.showErrorToast(e.error.message)}))}getCoursesWithStudents(e){return Array.from(new Set(e.map(e=>e.courseId))).map(t=>({courseId:t,students:Array.from(new Set(e.filter(e=>e.courseId===t))).map(e=>({student:e,isAllowedToViewStudentInSection:!1,isAllowedToModifyStudent:!1}))}))}getPrivileges(e){if(0===e.length)return Object(u.a)([]);const t=[];return e.forEach(e=>{const s={};Array.from(new Set(e.students.map(e=>e.student.sectionName))).forEach(t=>{s[t]=this.searchService.searchInstructorPrivilege(e.courseId,t)}),e.students.forEach(e=>t.push(s[e.student.sectionName]))}),Object(i.a)(t)}combinePrivileges([e,t]){for(const s of e)for(const e of s.students){const s=t.shift();s&&(e.isAllowedToViewStudentInSection=s.canViewStudentInSections,e.isAllowedToModifyStudent=s.canModifyStudent)}return{searchStudentTables:e}}removeStudentFromCourse(e){const t=e.student.courseId,s=e.student.email;this.courseService.removeStudentFromCourse(t,s).subscribe(()=>{const r=this.studentsListRowTables.find(e=>e.courseId===t);r&&(r.students=r.students.filter(e=>e.student.email!==s)),this.statusMessageService.showSuccessToast(`Student "${e.student.name}" is successfully deleted from course "${t}"`)},e=>{this.statusMessageService.showErrorToast(e.error.message)})}}return e.\u0275fac=function(t){return new(t||e)(m.Qb(l.a),m.Qb(S.a),m.Qb(f.a))},e.\u0275cmp=m.Kb({type:e,selectors:[["tm-instructor-search-page"]],decls:2,vars:2,consts:[[3,"searchParams","searched","searchParamsChange"],[4,"tmIsLoading"],[3,"studentTables","removeStudentFromCourseEvent",4,"ngIf"],[3,"studentTables","removeStudentFromCourseEvent"]],template:function(e,t){1&e&&(m.Wb(0,"tm-instructor-search-bar",0),m.ic("searched",(function(){return t.search()}))("searchParamsChange",(function(e){return t.searchParams=e})),m.Vb(),m.Oc(1,g,2,1,"div",1)),2&e&&(m.sc("searchParams",t.searchParams),m.Cb(1),m.sc("tmIsLoading",t.isSearching))},directives:[b.a,I.a,r.u,v.a],styles:[""]}),e})()}];let R=(()=>{class e{}return e.\u0275mod=m.Ob({type:e}),e.\u0275inj=m.Nb({factory:function(t){return new(t||e)},imports:[[r.c,o.a,n.h.forChild(w),c.a]]}),e})()}}]);