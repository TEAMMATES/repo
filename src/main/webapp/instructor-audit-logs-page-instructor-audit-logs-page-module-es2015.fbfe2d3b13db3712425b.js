(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{"2gUZ":function(e,t,o){"use strict";o.r(t),o.d(t,"InstructorAuditLogsPageModule",(function(){return Y}));var i=o("ofXK"),s=o("3Pt+"),n=o("tyNb"),a=o("1kSV"),r=o("aSpy"),c=o("RPsU"),d=o("qVc+"),l=o("9Jqy"),b=o("pjmv"),u=o.n(b),m=o("cp0P"),g=o("bOdf"),h=o("nYR2"),f=o("bHdf"),p=o("lJxs"),v=o("A3DQ"),M=o("vMQM"),y=o("R8lv"),S=o("p6cw"),D=o("oQl6"),C=o("fXoL"),T=o("vKUq"),V=o("iRmZ"),O=o("65rL"),W=o("Uqoa"),E=o("Lcal"),I=o("tvVI"),k=o("zAMY"),F=o("h8PG");function w(e,t){if(1&e&&(C.Wb(0,"option"),C.Qc(1),C.Vb()),2&e){const e=t.$implicit;C.Cb(1),C.Sc(" ",e.courseId," ")}}function L(e,t){if(1&e&&(C.Wb(0,"option",30),C.Qc(1),C.Vb()),2&e){const e=t.$implicit;C.sc("value",e.email),C.Cb(1),C.Tc(" ",e.name," ",e.email?"<"+e.email+">":""," ")}}function R(e,t){if(1&e){const e=C.Xb();C.Wb(0,"div",2),C.Wb(1,"div",3),C.Wb(2,"div",4),C.Wb(3,"div",5),C.Wb(4,"div",6),C.Wb(5,"label",7),C.Qc(6,"Course ID"),C.Vb(),C.Vb(),C.Wb(7,"div",6),C.Wb(8,"select",8),C.ic("ngModelChange",(function(t){return C.Fc(e),C.kc().formModel.courseId=t})),C.Wb(9,"option",9),C.Qc(10,"Select Course ID"),C.Vb(),C.Oc(11,w,2,1,"option",10),C.Vb(),C.Vb(),C.Vb(),C.Wb(12,"div",11),C.Wb(13,"div",12),C.Wb(14,"label",13),C.Qc(15,"Search period from"),C.Vb(),C.Vb(),C.Wb(16,"div",14),C.Wb(17,"div",15),C.Wb(18,"input",16,17),C.ic("ngModelChange",(function(t){return C.Fc(e),C.kc().formModel.logsDateFrom=t})),C.Vb(),C.Wb(20,"button",18),C.ic("click",(function(){return C.Fc(e),C.Cc(19).toggle()})),C.Rb(21,"i",19),C.Vb(),C.Vb(),C.Wb(22,"div",20),C.Wb(23,"tm-time-picker",21),C.ic("timeChange",(function(t){return C.Fc(e),C.kc().formModel.logsTimeFrom=t})),C.Vb(),C.Vb(),C.Vb(),C.Vb(),C.Vb(),C.Wb(24,"div",4),C.Wb(25,"div",5),C.Wb(26,"div",6),C.Wb(27,"label",22),C.Qc(28,"Student Name (Optional)"),C.Vb(),C.Vb(),C.Wb(29,"div",6),C.Wb(30,"select",23),C.ic("ngModelChange",(function(t){return C.Fc(e),C.kc().formModel.studentEmail=t})),C.Oc(31,L,2,3,"option",24),C.Vb(),C.Vb(),C.Vb(),C.Wb(32,"div",11),C.Wb(33,"div",12),C.Wb(34,"label",25),C.Qc(35,"Search period until"),C.Vb(),C.Vb(),C.Wb(36,"div",14),C.Wb(37,"div",15),C.Wb(38,"input",26,27),C.ic("ngModelChange",(function(t){return C.Fc(e),C.kc().formModel.logsDateTo=t})),C.Vb(),C.Wb(40,"button",18),C.ic("click",(function(){return C.Fc(e),C.Cc(39).toggle()})),C.Rb(41,"i",19),C.Vb(),C.Vb(),C.Wb(42,"div",20),C.Wb(43,"tm-time-picker",21),C.ic("timeChange",(function(t){return C.Fc(e),C.kc().formModel.logsTimeTo=t})),C.Vb(),C.Vb(),C.Wb(44,"div",28),C.Wb(45,"button",29),C.ic("click",(function(){return C.Fc(e),C.kc().search()})),C.Qc(46,"Search"),C.Vb(),C.Vb(),C.Vb(),C.Vb(),C.Vb(),C.Vb(),C.Vb()}if(2&e){const e=C.kc();C.Cb(8),C.sc("ngModel",e.formModel.courseId),C.Cb(3),C.sc("ngForOf",e.courses),C.Cb(7),C.sc("minDate",e.earliestSearchDate)("maxDate",e.dateToday)("ngModel",e.formModel.logsDateFrom),C.Cb(5),C.sc("time",e.formModel.logsTimeFrom),C.Cb(7),C.sc("ngModel",e.formModel.studentEmail),C.Cb(1),C.sc("ngForOf",e.courseToStudents[e.formModel.courseId]),C.Cb(7),C.sc("minDate",e.earliestSearchDate)("maxDate",e.dateToday)("ngModel",e.formModel.logsDateTo),C.Cb(5),C.sc("time",e.formModel.logsTimeTo),C.Cb(2),C.sc("disabled",!e.formModel.courseId||e.isSearching)}}function N(e,t){if(1&e&&(C.Wb(0,"div",3),C.Rb(1,"tm-sortable-table",38),C.Vb()),2&e){const e=C.kc(2).$implicit,t=C.kc(2);C.Cb(1),C.sc("rows",e.logRowsData)("columns",e.logColumnsData)("initialSortBy",t.SortBy.GIVER_NAME)}}function Q(e,t){1&e&&(C.Wb(0,"div",39),C.Wb(1,"i"),C.Qc(2,"No activity for this feedback session in selected search period"),C.Vb(),C.Vb())}function x(e,t){if(1&e&&(C.Wb(0,"div"),C.Oc(1,N,2,3,"div",36),C.Oc(2,Q,3,0,"ng-template",null,37,C.Pc),C.Vb()),2&e){const e=C.Cc(3),t=C.kc().$implicit;C.Cb(1),C.sc("ngIf",t.logRowsData[0])("ngIfElse",e)}}function _(e,t){if(1&e&&(C.Wb(0,"div"),C.Wb(1,"div",31),C.Wb(2,"div",32),C.ic("click",(function(){const e=t.$implicit;return e.isTabExpanded=!e.isTabExpanded})),C.Qc(3),C.Wb(4,"div",33),C.Rb(5,"tm-panel-chevron",34),C.Vb(),C.Vb(),C.Oc(6,x,4,2,"div",35),C.Vb(),C.Vb()),2&e){const e=t.$implicit;C.Cb(3),C.Sc(" ",e.feedbackSessionName," "),C.Cb(2),C.sc("isExpanded",e.isTabExpanded),C.Cb(1),C.sc("ngIf",e.isTabExpanded)}}function A(e,t){if(1&e&&(C.Wb(0,"div"),C.Oc(1,_,7,3,"div",10),C.Vb()),2&e){const e=C.kc();C.Cb(1),C.sc("ngForOf",e.searchResults)}}const P=[{path:"",component:(()=>{class e{constructor(e,t,o,i,s){this.courseService=e,this.studentService=t,this.logsService=o,this.timezoneService=i,this.statusMessageService=s,this.LOGS_RETENTION_PERIOD=M.a.LOGS_RETENTION_PERIOD,this.SortBy=S.a,this.formModel={logsDateFrom:{year:0,month:0,day:0},logsTimeFrom:{hour:0,minute:0},logsDateTo:{year:0,month:0,day:0},logsTimeTo:{hour:0,minute:0},courseId:"",studentEmail:""},this.dateToday={year:0,month:0,day:0},this.earliestSearchDate={year:0,month:0,day:0},this.courses=[],this.courseToStudents={},this.searchResults=[],this.isLoading=!0,this.isSearching=!1}ngOnInit(){const e=new Date;this.dateToday.year=e.getFullYear(),this.dateToday.month=e.getMonth()+1,this.dateToday.day=e.getDate();const t=new Date(Date.now()-24*this.LOGS_RETENTION_PERIOD*60*60*1e3);this.earliestSearchDate.year=t.getFullYear(),this.earliestSearchDate.month=t.getMonth()+1,this.earliestSearchDate.day=t.getDate(),this.formModel.logsDateFrom=Object.assign(Object.assign({},this.dateToday),{day:e.getDate()-1}),this.formModel.logsDateTo=Object.assign({},this.dateToday),this.formModel.logsTimeFrom={hour:23,minute:59},this.formModel.logsTimeTo={hour:23,minute:59},this.loadData()}search(){this.isSearching=!0,this.searchResults=[];const e=[this.resolveLocalDateTime(this.formModel.logsDateFrom,this.formModel.logsTimeFrom,"Search period from"),this.resolveLocalDateTime(this.formModel.logsDateTo,this.formModel.logsTimeTo,"Search period until")];Object(m.a)(e).pipe(Object(g.a)(e=>this.logsService.searchFeedbackSessionLog({courseId:this.formModel.courseId,searchFrom:e[0].toString(),searchUntil:e[1].toString(),studentEmail:this.formModel.studentEmail})),Object(h.a)(()=>this.isSearching=!1)).subscribe(e=>{e.feedbackSessionLogs.map(e=>this.searchResults.push(this.toFeedbackSessionLogModel(e)))},e=>this.statusMessageService.showErrorToast(e.error.message))}loadData(){const e={courseId:"",email:"",name:"",sectionName:"",teamName:""};this.courseService.getAllCoursesAsInstructor("active").pipe(Object(g.a)(e=>e.courses.map(e=>(this.courses.push(e),this.studentService.getStudentsFromCourse({courseId:e.courseId})))),Object(f.a)(),Object(h.a)(()=>this.isLoading=!1)).subscribe(t=>this.courseToStudents[t.students[0].courseId]=[e,...t.students],e=>this.statusMessageService.showErrorToast(e.error.message))}resolveLocalDateTime(e,t,o){const i=u()();i.set("year",e.year),i.set("month",e.month-1),i.set("date",e.day),i.set("hour",t.hour),i.set("minute",t.minute);const s=i.format(v.a);return this.timezoneService.getResolvedTimestamp(s,this.timezoneService.guessTimezone(),o).pipe(Object(p.a)(e=>e.timestamp))}toFeedbackSessionLogModel(e){return{isTabExpanded:!1,feedbackSessionName:e.feedbackSessionData.feedbackSessionName,logColumnsData:[{header:"Time",sortBy:S.a.LOG_DATE},{header:"Name",sortBy:S.a.GIVER_NAME},{header:"Activity",sortBy:S.a.LOG_TYPE},{header:"Email",sortBy:S.a.RESPONDENT_EMAIL},{header:"Section",sortBy:S.a.SECTION_NAME},{header:"Team",sortBy:S.a.TEAM_NAME}],logRowsData:e.feedbackSessionLogEntries.map(t=>[{value:this.timezoneService.formatToString(t.timestamp,e.feedbackSessionData.timeZone,"ddd, DD MMM, YYYY hh:mm:ss A")},{value:t.studentData.name},{value:y.l[t.feedbackSessionLogType.toString()]===y.l.FEEDBACK_SESSION_ACCESS?"Viewed the submission page":"Submitted responses"},{value:t.studentData.email},{value:t.studentData.sectionName},{value:t.studentData.teamName}])}}}return e.\u0275fac=function(t){return new(t||e)(C.Qb(T.a),C.Qb(V.a),C.Qb(O.a),C.Qb(v.b),C.Qb(W.a))},e.\u0275cmp=C.Kb({type:e,selectors:[["tm-instructor-audit-logs-page"]],features:[C.Bb([{provide:a.e,useClass:D.a}])],decls:10,vars:3,consts:[["class","card bg-form no-border",4,"tmIsLoading"],[4,"tmIsLoading"],[1,"card","bg-form","no-border"],[1,"card-body"],[1,"row","form-group"],[1,"col-4"],[1,"col-12"],["for","course-id-dropdown",1,"font-weight-bold"],["id","course-id-dropdown",1,"form-control","col-12",3,"ngModel","ngModelChange"],["value","","disabled","","selected","","hidden",""],[4,"ngFor","ngForOf"],[1,"col-8"],[1,"col-12","mb-1"],["for","logs-from-datepicker",1,"font-weight-bold"],[1,"input-group"],[1,"col-md-6","input-group"],["id","logs-from-datepicker","type","text","ngbDatepicker","",1,"form-control",3,"minDate","maxDate","ngModel","ngModelChange"],["logsFromDp","ngbDatepicker"],["type","button",1,"btn","btn-light",3,"click"],[1,"fas","fa-calendar-alt"],[1,"col-md-3"],[3,"time","timeChange"],["for","student-name-dropdown",1,"font-weight-bold"],["id","student-name-dropdown",1,"form-control","col-12",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["for","logs-to-datepicker",1,"font-weight-bold"],["id","logs-to-datepicker","type","text","ngbDatepicker","",1,"form-control",3,"minDate","maxDate","ngModel","ngModelChange"],["logsToDp","ngbDatepicker"],[1,"col-md-2"],["id","search-button",1,"float-right","btn","btn-primary",3,"disabled","click"],[3,"value"],[1,"card","mb-3","alert-success-border"],[1,"card-header","alert-success","cursor-pointer",3,"click"],[1,"card-header-btn-toolbar"],[3,"isExpanded"],[4,"ngIf"],["class","card-body",4,"ngIf","ngIfElse"],["noActivityTemplate",""],[3,"rows","columns","initialSortBy"],[1,"no-activity-body"]],template:function(e,t){1&e&&(C.Wb(0,"h1"),C.Qc(1,"Student Activity Logs"),C.Vb(),C.Wb(2,"p"),C.Qc(3,"This page allows you to find when your students have accessed or submitted a particular feedback session for a given course. The earliest date you can search for is "),C.Wb(4,"b"),C.Qc(5),C.Vb(),C.Qc(6," before today."),C.Vb(),C.Rb(7,"hr"),C.Oc(8,R,47,13,"div",0),C.Oc(9,A,2,1,"div",1)),2&e&&(C.Cb(5),C.Sc("",t.LOGS_RETENTION_PERIOD," days"),C.Cb(3),C.sc("tmIsLoading",t.isLoading),C.Cb(1),C.sc("tmIsLoading",t.isSearching))},directives:[E.a,s.B,s.p,s.s,s.u,s.E,i.t,a.l,s.c,I.a,k.a,i.u,F.a],styles:[".bg-form[_ngcontent-%COMP%]{background-color:#eaeff5}.no-border[_ngcontent-%COMP%]{border:0}.alert-success-border[_ngcontent-%COMP%]{border-color:#c3e6cb}.no-activity-body[_ngcontent-%COMP%]{padding:.5rem 1rem}"]}),e})()}];let Y=(()=>{class e{}return e.\u0275mod=C.Ob({type:e}),e.\u0275inj=C.Nb({factory:function(t){return new(t||e)},imports:[[i.c,n.h.forChild(P),a.f,s.j,d.a,a.j,r.a,c.a,l.a]]}),e})()},RPsU:function(e,t,o){"use strict";o.d(t,"a",(function(){return n}));var i=o("ofXK"),s=o("fXoL");let n=(()=>{class e{}return e.\u0275mod=s.Ob({type:e}),e.\u0275inj=s.Nb({factory:function(t){return new(t||e)},imports:[[i.c]]}),e})()},oQl6:function(e,t,o){"use strict";o.d(t,"a",(function(){return r}));var i=o("1kSV"),s=o("pjmv"),n=o.n(s),a=o("fXoL");let r=(()=>{class e extends i.e{format(e){if(null==e)return"";const t=n()();return t.set("year",e.year),t.set("month",e.month-1),t.set("date",e.day),t.format("ddd, DD MMM, YYYY")}parse(e){const t=n()(e,"ddd, DD MMM, YYYY");return{year:t.year(),month:t.month()+1,day:t.date()}}}return e.\u0275fac=function(t){return c(t||e)},e.\u0275prov=a.Mb({token:e,factory:e.\u0275fac}),e})();const c=a.Yb(r)},tvVI:function(e,t,o){"use strict";o.d(t,"a",(function(){return l}));var i=o("fXoL"),s=o("3Pt+"),n=o("ofXK");const a=function(e){return{hour:e,minute:0}};function r(e,t){if(1&e&&(i.Wb(0,"option",2),i.Qc(1),i.Vb()),2&e){const e=t.$implicit,o=i.kc();i.sc("ngValue",i.wc(2,a,e)),i.Cb(1),i.Sc(" ",o.addLeadingZeros(2,e),":00H ")}}function c(e,t){if(1&e&&(i.Wb(0,"option",2),i.Qc(1),i.Vb()),2&e){const e=i.kc();i.sc("ngValue",e.time),i.Cb(1),i.Tc("",e.addLeadingZeros(2,e.time.hour),":",e.addLeadingZeros(2,e.time.minute),"H")}}const d=function(){return{hour:23,minute:59}};let l=(()=>{class e{constructor(){this.isDisabled=!1,this.time={hour:0,minute:0},this.timeChange=new i.n}ngOnInit(){}triggerTimeChange(e){this.timeChange.emit(e)}range(e,t){const o=[];for(let i=e;i<t;i+=1)o.push(i);return o}timeCompareFn(e,t){return e&&t&&e.hour===t.hour&&e.minute===t.minute}isInFixedList(e){return e.hour>=1&&e.hour<=22&&0===e.minute||23===e.hour&&59===e.minute}addLeadingZeros(e,t){return("0".repeat(e)+t).slice(-e)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=i.Kb({type:e,selectors:[["tm-time-picker"]],inputs:{isDisabled:"isDisabled",time:"time"},outputs:{timeChange:"timeChange"},decls:5,vars:7,consts:[[1,"form-control",3,"ngModel","disabled","compareWith","ngModelChange"],[3,"ngValue",4,"ngFor","ngForOf"],[3,"ngValue"],[3,"ngValue",4,"ngIf"]],template:function(e,t){1&e&&(i.Wb(0,"select",0),i.ic("ngModelChange",(function(e){return t.triggerTimeChange(e)})),i.Oc(1,r,2,4,"option",1),i.Wb(2,"option",2),i.Qc(3,"23:59H"),i.Vb(),i.Oc(4,c,2,3,"option",3),i.Vb()),2&e&&(i.sc("ngModel",t.time)("disabled",t.isDisabled)("compareWith",t.timeCompareFn),i.Cb(1),i.sc("ngForOf",t.range(1,24)),i.Cb(1),i.sc("ngValue",i.vc(6,d)),i.Cb(2),i.sc("ngIf",!t.isInFixedList(t.time)))},directives:[s.B,s.p,s.s,n.t,s.u,s.E,n.u],styles:[""]}),e})()},zAMY:function(e,t,o){"use strict";o.d(t,"a",(function(){return r}));var i=o("fXoL"),s=o("ofXK");function n(e,t){1&e&&i.Rb(0,"i",3)}function a(e,t){1&e&&i.Rb(0,"i",4)}let r=(()=>{class e{constructor(){this.isExpanded=!1}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=i.Kb({type:e,selectors:[["tm-panel-chevron"]],inputs:{isExpanded:"isExpanded"},decls:3,vars:2,consts:[[1,"chevron"],["class","fas fa-chevron-down",4,"ngIf"],["class","fas fa-chevron-up",4,"ngIf"],[1,"fas","fa-chevron-down"],[1,"fas","fa-chevron-up"]],template:function(e,t){1&e&&(i.Wb(0,"div",0),i.Oc(1,n,1,0,"i",1),i.Oc(2,a,1,0,"i",2),i.Vb()),2&e&&(i.Cb(1),i.sc("ngIf",!t.isExpanded),i.Cb(1),i.sc("ngIf",t.isExpanded))},directives:[s.u],styles:[".chevron[_ngcontent-%COMP%]{display:-ms-inline-flexbox;display:inline-flex;vertical-align:middle}"]}),e})()}}]);