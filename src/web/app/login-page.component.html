<div class="d-flex flex-column align-items-center" *tmIsLoading="isPageLoading">
  <div class="card bg-light" style="width: 500px;">
    <div *ngIf="isLoginPage">
      <div class="card-header">
        <strong>Not Logged In</strong>
      </div>
      <div class="card-body d-flex flex-column align-items-center">
        <div>
          <button class="btn btn-light" style="min-width: 150px;" (click)="signInWithGoogle()" [disabled]="isSigningInWithGoogle">
            <tm-ajax-loading *ngIf="isSigningInWithGoogle"></tm-ajax-loading>Log In with Google
          </button>
        </div>
        <div class="mt-2">
          <button class="btn btn-danger" style="min-width: 150px;" (click)="isSignInWithEmail = true; isLoginPage = false;">Log In with Email</button>
        </div>
      </div>
    </div>
    <div *ngIf="isSignInWithEmail">
      <div class="card-header">
        <strong>Log In with Email</strong>
      </div>
      <div class="card-body">
        <form [formGroup]="formLogin" (ngSubmit)="signInWithEmail(formLogin)">
          <div class="form-group row">
            <label class="col-sm-2 col-form-label">
              <strong>Email:</strong>
            </label>
            <div class="col-sm-10">
              <input class="form-control" type="email" formControlName="email" maxlength="254" email="true" spellcheck="false">
            </div>
          </div>
          <div *ngIf="captchaSiteKey !== ''" class="form-group row">
            <div class="col-sm-2"></div>
            <div class="col-sm-10">
              <ngx-recaptcha2 #captchaElem
                              [siteKey]="captchaSiteKey"
                              (success)="handleSuccess($event)"
                              [useGlobalDomain]="false"
                              [size]="size"
                              [hl]="lang"
                              formControlName="recaptcha">
              </ngx-recaptcha2>
            </div>
          </div>
          <div class="form-group row">
            <div class="col-sm-2"></div>
            <div class="col-sm-10">
              <button type="submit" class="btn btn-primary" [disabled]="isSigningInWithEmail">
                <tm-ajax-loading *ngIf="isSigningInWithEmail"></tm-ajax-loading>Login
              </button>
              <button class="btn btn-light ml-2" (click)="isSignInWithEmail=false; isLoginPage=true">Cancel</button>
            </div>
          </div>
        </form>
      </div>
    </div>
    <div *ngIf="isSignInLinkEmailSent">
      <div class="card-header">
        <strong>Login Email Sent</strong>
      </div>
      <div class="card-body">
        <p>A login email with additional instructions was sent to {{formLogin.controls.email.value}}.<br>Check your email to complete login.</p>
        <a href="#" style="text-decoration: underline;" (click)="isTroubleGettingEmail=true; isSignInLinkEmailSent=false;">
          Trouble getting email?
        </a>
      </div>
    </div>
    <div *ngIf="isTroubleGettingEmail">
      <div class="card-header">
        <strong>Trouble Getting Email</strong>
      </div>
      <div class="card-body">
        <p>Try these common fixes:</p>
        <ul>
          <li>Check if the email was marked as spam or filtered.</li>
          <li>Check your internet connection.</li>
          <li>Check that you did not misspell your email.</li>
          <li>Check that your inbox space is not running out or other inbox settings related issues.</li>
        </ul>
        <p class="mt-3">If the steps above didn't work, you can resend the email. Note that this will deactivate the link in the older email.</p>
        <div>
          <button class="btn btn-primary" (click)="resendEmail()">Resend</button>
          <button class="btn btn-light ml-2" (click)="isTroubleGettingEmail=false; isSignInLinkEmailSent=true;">Back</button>
        </div>
      </div>
    </div>
  </div>
</div>
