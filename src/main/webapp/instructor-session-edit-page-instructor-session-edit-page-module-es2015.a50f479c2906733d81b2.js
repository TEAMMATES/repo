(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{QlvD:function(e,s,i){"use strict";i.d(s,"a",(function(){return l}));var t=i("fXoL"),o=i("8xKp"),n=i("Wuvc"),r=i("ofXK"),a=i("fB2i"),c=i("3Pt+");const d=function(e){return{"editor-disabled":e}};function u(e,s){if(1&e){const e=t.Xb();t.Wb(0,"editor",2),t.ic("ngModelChange",(function(s){return t.Fc(e),t.kc().richTextChange.emit(s)})),t.Vb()}if(2&e){const e=t.kc();t.sc("ngClass",t.wc(5,d,e.isDisabled))("init",e.init)("disabled",e.isDisabled)("ngModel",e.richText),t.Db("placeholder",e.placeholderText)}}let l=(()=>{class e{constructor(){this.isDisabled=!1,this.minHeightInPx=150,this.placeholderText="",this.richText="",this.richTextChange=new t.n,this.init={},this.render=!1}ngOnInit(){this.init=this.getEditorSettings()}getEditorSettings(){return{base_url:o.a,skin_url:o.a+"/skins/ui/oxide",content_css:"/assets/tinymce/tinymce.css",suffix:".min",height:this.minHeightInPx,resize:!0,inline:!1,relative_urls:!1,convert_urls:!1,remove_linebreaks:!1,placeholder:this.placeholderText,plugins:["advlist autolink autoresize lists link image charmap hr anchor","searchreplace wordcount visualblocks visualchars code","insertdatetime nonbreaking save table directionality","emoticons paste textpattern"],menubar:!1,autoresize_bottom_margin:50,toolbar1:"styleselect | forecolor backcolor | bold italic underline strikethrough subscript superscript | alignleft aligncenter alignright alignjustify | bullist numlist | link image charmap emoticons"}}renderEditor(e){e.visible&&(this.render=!0)}}return e.\u0275fac=function(s){return new(s||e)},e.\u0275cmp=t.Kb({type:e,selectors:[["tm-rich-text-editor"]],inputs:{isDisabled:"isDisabled",minHeightInPx:"minHeightInPx",placeholderText:"placeholderText",richText:"richText"},outputs:{richTextChange:"richTextChange"},decls:2,vars:1,consts:[["inViewport","",3,"inViewportAction"],["class","editor",3,"ngClass","init","disabled","ngModel","ngModelChange",4,"ngIf"],[1,"editor",3,"ngClass","init","disabled","ngModel","ngModelChange"]],template:function(e,s){1&e&&(t.Wb(0,"div",0),t.ic("inViewportAction",(function(e){return s.renderEditor(e)})),t.Oc(1,u,1,7,"editor",1),t.Vb()),2&e&&(t.Cb(1),t.sc("ngIf",s.render))},directives:[n.a,r.u,a.a,r.r,c.p,c.s],styles:[".editor[_ngcontent-%COMP%]{background-color:#fff}.editor-disabled[_ngcontent-%COMP%]{background-color:#e9ecef;opacity:1}.editor-disabled[_ngcontent-%COMP%]     .tox-tinymce{opacity:.5}.placeholder[_ngcontent-%COMP%]{padding:.375rem .75rem;position:absolute}"]}),e})()},RMfs:function(e,s,i){"use strict";i.d(s,"a",(function(){return n}));var t=i("R8lv"),o=i("fXoL");let n=(()=>{class e{transform(e){switch(e){case t.d.MCQ:return"Multiple-choice (single answer) question";case t.d.CONTRIB:return"Team contribution question";case t.d.TEXT:return"Essay question";case t.d.NUMSCALE:return"Numerical-scale question";case t.d.MSQ:return"Multiple-choice (multiple answers) question";case t.d.RANK_OPTIONS:return"Rank (options) question";case t.d.RANK_RECIPIENTS:return"Rank (recipients) question";case t.d.RUBRIC:return"Rubric question";case t.d.CONSTSUM_OPTIONS:return"Distribute points (among options) question";case t.d.CONSTSUM_RECIPIENTS:return"Distribute points (among recipients) question";default:return"Unknown"}}}return e.\u0275fac=function(s){return new(s||e)},e.\u0275pipe=o.Pb({name:"questionTypeName",type:e,pure:!0}),e})()},RPsU:function(e,s,i){"use strict";i.d(s,"a",(function(){return n}));var t=i("ofXK"),o=i("fXoL");let n=(()=>{class e{}return e.\u0275mod=o.Ob({type:e}),e.\u0275inj=o.Nb({factory:function(s){return new(s||e)},imports:[[t.c]]}),e})()},UGSt:function(e,s,i){"use strict";i.d(s,"a",(function(){return o}));var t=i("fXoL");let o=(()=>{class e{transform(e){return Object.keys(e).map(s=>e[s])}}return e.\u0275fac=function(s){return new(s||e)},e.\u0275pipe=t.Pb({name:"enumToArray",type:e,pure:!0}),e})()},ovlq:function(e,s,i){"use strict";i.d(s,"a",(function(){return n}));var t=i("R8lv"),o=i("fXoL");let n=(()=>{class e{transform(e){switch(e){case t.c.STUDENTS:return"students";case t.c.STUDENTS_EXCLUDING_SELF:return"students (excluding self)";case t.c.TEAMS:return"teams";case t.c.TEAMS_EXCLUDING_SELF:return"teams (excluding own team)";case t.c.OWN_TEAM_MEMBERS_INCLUDING_SELF:return"team members";case t.c.OWN_TEAM_MEMBERS:return"team members (excluding self)";case t.c.INSTRUCTORS:return"instructors";default:return"unknown"}}}return e.\u0275fac=function(s){return new(s||e)},e.\u0275pipe=o.Pb({name:"generatedChoice",type:e,pure:!0}),e})()},vqVA:function(e,s,i){"use strict";i.r(s),i.d(s,"InstructorSessionEditPageModule",(function(){return De}));var t=i("ofXK"),o=i("3Pt+"),n=i("tyNb"),r=i("1kSV"),a=i("n6pr"),c=i("1GcU"),d=i("mYbV"),u=i("aSpy"),l=i("GXA2"),b=i("qVc+"),m=i("SEFB"),h=i("TOej"),p=i("pjmv"),g=i.n(p),f=i("cp0P"),S=i("LRne"),T=i("nYR2"),E=i("eIep"),v=i("vkgz"),k=i("lJxs"),F=i("bOdf"),y=i("5+tZ"),M=i("A3DQ"),Q=i("R8lv"),C=i("9jjE"),w=i("7qkN"),O=i("84gB"),q=i("ZpFW"),N=i("G/Uz"),I=i("/Tzu"),V=i("BBzn"),R=i("p6cw"),D=i("fXoL"),P=i("I8MS"),x=i("RMfs");function W(e,s){1&e&&D.Rb(0,"i",16)}function A(e,s){1&e&&D.Rb(0,"i",17)}function B(e,s){1&e&&D.Rb(0,"i",16)}function _(e,s){1&e&&D.Rb(0,"i",17)}function G(e,s){1&e&&D.Rb(0,"i",16)}function L(e,s){1&e&&D.Rb(0,"i",17)}function U(e,s){1&e&&D.Rb(0,"i",16)}function H(e,s){1&e&&D.Rb(0,"i",17)}function j(e,s){if(1&e){const e=D.Xb();D.Wb(0,"tr"),D.Wb(1,"td"),D.Wb(2,"input",18),D.ic("ngModelChange",(function(i){return D.Fc(e),s.$implicit.isSelected=i})),D.Vb(),D.Vb(),D.Wb(3,"td"),D.Qc(4),D.Vb(),D.Wb(5,"td"),D.Qc(6),D.Vb(),D.Wb(7,"td"),D.Qc(8),D.lc(9,"questionTypeName"),D.Vb(),D.Wb(10,"td"),D.Qc(11),D.Vb(),D.Vb()}if(2&e){const e=s.$implicit;D.Cb(2),D.sc("ngModel",e.isSelected),D.Cb(2),D.Rc(e.courseId),D.Cb(2),D.Rc(e.feedbackSessionName),D.Cb(2),D.Rc(D.mc(9,5,e.question.questionType)),D.Cb(3),D.Rc(e.question.questionBrief)}}let X=(()=>{class e{constructor(e,s){this.activeModal=e,this.tableComparatorService=s,this.SortBy=R.a,this.SortOrder=R.b,this.questionToCopyCandidates=[],this.candidatesSortBy=R.a.NONE,this.candidatesSortOrder=R.b.ASC}ngOnInit(){}getSelectedQuestions(){return this.questionToCopyCandidates.filter(e=>e.isSelected).map(e=>e.question)}sortQuestionToCopyCandidates(e){this.candidatesSortBy=e,this.candidatesSortOrder=this.candidatesSortOrder===R.b.DESC?R.b.ASC:R.b.DESC,this.questionToCopyCandidates.sort(this.sortCandidatesBy(e,this.candidatesSortOrder))}sortCandidatesBy(e,s){return(i,t)=>{let o,n;switch(e){case R.a.SESSION_NAME:o=i.feedbackSessionName,n=t.feedbackSessionName;break;case R.a.COURSE_ID:o=i.courseId,n=t.courseId;break;case R.a.QUESTION_TYPE:o=String(i.question.questionType),n=String(t.question.questionType);break;case R.a.QUESTION_TEXT:o=i.question.questionBrief,n=t.question.questionBrief;break;default:o="",n=""}return this.tableComparatorService.compare(e,s,o,n)}}get hasAnyQuestionsToCopySelected(){return void 0!==this.questionToCopyCandidates.find(e=>e.isSelected)}}return e.\u0275fac=function(s){return new(s||e)(D.Qb(r.a),D.Qb(P.a))},e.\u0275cmp=D.Kb({type:e,selectors:[["tm-copy-questions-from-other-sessions-modal"]],decls:43,vars:10,consts:[[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],["id","copy-question-modal",1,"modal-body"],[1,"table","table-bordered","table-responsive-lg"],[1,"bg-primary","text-white"],[1,"sortable-header",3,"click"],[1,"fa-stack"],[1,"fas","fa-sort"],["class","fas fa-sort-down",4,"ngIf"],["class","fas fa-sort-up",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"modal-footer"],["id","btn-confirm-copy-question","type","button",1,"btn","btn-primary",3,"disabled","click"],["type","button",1,"btn","btn-light",3,"click"],[1,"fas","fa-sort-down"],[1,"fas","fa-sort-up"],["type","checkbox",1,"form-control",3,"ngModel","ngModelChange"]],template:function(e,s){1&e&&(D.Wb(0,"div",0),D.Wb(1,"h4",1),D.Qc(2,"Copy Questions"),D.Vb(),D.Wb(3,"button",2),D.ic("click",(function(){return s.activeModal.dismiss()})),D.Wb(4,"span",3),D.Qc(5,"\xd7"),D.Vb(),D.Vb(),D.Vb(),D.Wb(6,"div",4),D.Wb(7,"table",5),D.Wb(8,"thead",6),D.Wb(9,"tr"),D.Wb(10,"th"),D.Qc(11,"#"),D.Vb(),D.Wb(12,"th",7),D.ic("click",(function(){return s.sortQuestionToCopyCandidates(s.SortBy.COURSE_ID)})),D.Qc(13," Course ID "),D.Wb(14,"span",8),D.Rb(15,"i",9),D.Oc(16,W,1,0,"i",10),D.Oc(17,A,1,0,"i",11),D.Vb(),D.Vb(),D.Wb(18,"th",7),D.ic("click",(function(){return s.sortQuestionToCopyCandidates(s.SortBy.SESSION_NAME)})),D.Qc(19," Session Name "),D.Wb(20,"span",8),D.Rb(21,"i",9),D.Oc(22,B,1,0,"i",10),D.Oc(23,_,1,0,"i",11),D.Vb(),D.Vb(),D.Wb(24,"th",7),D.ic("click",(function(){return s.sortQuestionToCopyCandidates(s.SortBy.QUESTION_TYPE)})),D.Qc(25," Question Type "),D.Wb(26,"span",8),D.Rb(27,"i",9),D.Oc(28,G,1,0,"i",10),D.Oc(29,L,1,0,"i",11),D.Vb(),D.Vb(),D.Wb(30,"th",7),D.ic("click",(function(){return s.sortQuestionToCopyCandidates(s.SortBy.QUESTION_TEXT)})),D.Qc(31," Question Text "),D.Wb(32,"span",8),D.Rb(33,"i",9),D.Oc(34,U,1,0,"i",10),D.Oc(35,H,1,0,"i",11),D.Vb(),D.Vb(),D.Vb(),D.Vb(),D.Wb(36,"tbody"),D.Oc(37,j,12,7,"tr",12),D.Vb(),D.Vb(),D.Vb(),D.Wb(38,"div",13),D.Wb(39,"button",14),D.ic("click",(function(){return s.activeModal.close(s.getSelectedQuestions())})),D.Qc(40,"Copy"),D.Vb(),D.Wb(41,"button",15),D.ic("click",(function(){return s.activeModal.dismiss()})),D.Qc(42,"Cancel"),D.Vb(),D.Vb()),2&e&&(D.Cb(16),D.sc("ngIf",s.candidatesSortBy===s.SortBy.COURSE_ID&&s.candidatesSortOrder===s.SortOrder.DESC),D.Cb(1),D.sc("ngIf",s.candidatesSortBy===s.SortBy.COURSE_ID&&s.candidatesSortOrder===s.SortOrder.ASC),D.Cb(5),D.sc("ngIf",s.candidatesSortBy===s.SortBy.SESSION_NAME&&s.candidatesSortOrder===s.SortOrder.DESC),D.Cb(1),D.sc("ngIf",s.candidatesSortBy===s.SortBy.SESSION_NAME&&s.candidatesSortOrder===s.SortOrder.ASC),D.Cb(5),D.sc("ngIf",s.candidatesSortBy===s.SortBy.QUESTION_TYPE&&s.candidatesSortOrder===s.SortOrder.DESC),D.Cb(1),D.sc("ngIf",s.candidatesSortBy===s.SortBy.QUESTION_TYPE&&s.candidatesSortOrder===s.SortOrder.ASC),D.Cb(5),D.sc("ngIf",s.candidatesSortBy===s.SortBy.QUESTION_TEXT&&s.candidatesSortOrder===s.SortOrder.DESC),D.Cb(1),D.sc("ngIf",s.candidatesSortBy===s.SortBy.QUESTION_TEXT&&s.candidatesSortOrder===s.SortOrder.ASC),D.Cb(2),D.sc("ngForOf",s.questionToCopyCandidates),D.Cb(2),D.sc("disabled",!s.hasAnyQuestionsToCopySelected))},directives:[t.u,t.t,o.a,o.p,o.s],pipes:[x.a],styles:[".sortable-header[_ngcontent-%COMP%]{cursor:pointer}#copy-question-modal[_ngcontent-%COMP%]{table-layout:auto;margin-bottom:50px}.modal-footer[_ngcontent-%COMP%]{position:fixed;bottom:0;height:50px;width:69.8%;-ms-flex-pack:right;justify-content:right;background-color:#fff}.form-control[_ngcontent-%COMP%]{height:calc(.5em + 1.5vh);width:calc(.5em + 1.5vw)}"]}),e})();var z=i("JUCI"),J=i("YxrJ"),Z=i("iJt+");function K(e,s){if(1&e&&(D.Wb(0,"div"),D.Wb(1,"div",14),D.Rb(2,"tm-question-edit-form",15),D.Vb(),D.Vb()),2&e){const e=D.kc().$implicit;D.sc("@collapseAnim",void 0),D.Cb(2),D.sc("formModel",e.model)}}function $(e,s){if(1&e){const e=D.Xb();D.Wb(0,"div",9),D.Wb(1,"div",10),D.ic("click",(function(){const e=s.$implicit;return e.isShowDetails=!e.isShowDetails})),D.Wb(2,"label"),D.Wb(3,"input",11),D.ic("ngModelChange",(function(i){return D.Fc(e),s.$implicit.isSelected=i}))("click",(function(s){return D.Fc(e),s.stopPropagation()})),D.Vb(),D.Vb(),D.Qc(4,"\xa0 "),D.Rb(5,"span",12),D.Vb(),D.Oc(6,K,3,2,"div",13),D.Vb()}if(2&e){const e=s.$implicit;D.Cb(3),D.sc("ngModel",e.isSelected),D.Cb(2),D.sc("innerHTML",e.description,D.Gc),D.Cb(1),D.sc("ngIf",e.isShowDetails)}}let Y=(()=>{class e{constructor(e,s){this.activeModal=e,this.feedbackQuestionsService=s,this.templateQuestionModels=[],this.templateQuestionModels=this.feedbackQuestionsService.getTemplateQuestions().map(e=>({description:e.description,isShowDetails:!1,isSelected:!1,model:{feedbackQuestionId:"",questionNumber:e.question.questionNumber,questionBrief:e.question.questionBrief,questionDescription:e.question.questionDescription,isQuestionHasResponses:!1,questionType:e.question.questionType,questionDetails:e.question.questionDetails,giverType:e.question.giverType,recipientType:e.question.recipientType,numberOfEntitiesToGiveFeedbackToSetting:e.question.numberOfEntitiesToGiveFeedbackToSetting,customNumberOfEntitiesToGiveFeedbackTo:e.question.customNumberOfEntitiesToGiveFeedbackTo||1,showResponsesTo:e.question.showResponsesTo,showGiverNameTo:e.question.showGiverNameTo,showRecipientNameTo:e.question.showRecipientNameTo,isEditable:!1,isSaving:!1,isCollapsed:!1,isVisibilityChanged:!1,isFeedbackPathChanged:!1,isQuestionDetailsChanged:!1}}))}ngOnInit(){}get hasAnyTemplateQuestionSelected(){return this.templateQuestionModels.some(e=>e.isSelected)}getSelectedQuestions(){return this.templateQuestionModels.filter(e=>e.isSelected).map(e=>e.model).map(e=>({feedbackQuestionId:"",questionNumber:0,questionBrief:e.questionBrief,questionDescription:e.questionDescription,questionType:e.questionType,questionDetails:e.questionDetails,giverType:e.giverType,recipientType:e.recipientType,numberOfEntitiesToGiveFeedbackToSetting:e.numberOfEntitiesToGiveFeedbackToSetting,customNumberOfEntitiesToGiveFeedbackTo:e.customNumberOfEntitiesToGiveFeedbackTo,showResponsesTo:e.showResponsesTo,showGiverNameTo:e.showGiverNameTo,showRecipientNameTo:e.showRecipientNameTo}))}}return e.\u0275fac=function(s){return new(s||e)(D.Qb(r.a),D.Qb(J.a))},e.\u0275cmp=D.Kb({type:e,selectors:[["ng-component"]],decls:13,vars:2,consts:[[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],["id","template-question-modal",1,"modal-body"],["class","card margin-top-20px",4,"ngFor","ngForOf"],[1,"modal-footer"],["id","btn-confirm-template","type","button",1,"btn","btn-primary",3,"disabled","click"],["type","button",1,"btn","btn-light",3,"click"],[1,"card","margin-top-20px"],[1,"card-header","cursor-pointer",3,"click"],["type","checkbox",3,"ngModel","ngModelChange","click"],[1,"template-description",3,"innerHTML"],[4,"ngIf"],[1,"card-body"],["isDisplayOnly","true",3,"formModel"]],template:function(e,s){1&e&&(D.Wb(0,"div",0),D.Wb(1,"h4",1),D.Qc(2,"Add Template Questions"),D.Vb(),D.Wb(3,"button",2),D.ic("click",(function(){return s.activeModal.dismiss()})),D.Wb(4,"span",3),D.Qc(5,"\xd7"),D.Vb(),D.Vb(),D.Vb(),D.Wb(6,"div",4),D.Oc(7,$,7,3,"div",5),D.Vb(),D.Wb(8,"div",6),D.Wb(9,"button",7),D.ic("click",(function(){return s.activeModal.close(s.getSelectedQuestions())})),D.Qc(10,"Add"),D.Vb(),D.Wb(11,"button",8),D.ic("click",(function(){return s.activeModal.dismiss()})),D.Qc(12,"Close"),D.Vb(),D.Vb()),2&e&&(D.Cb(7),D.sc("ngForOf",s.templateQuestionModels),D.Cb(2),D.sc("disabled",!s.hasAnyTemplateQuestionSelected))},directives:[t.t,o.a,o.p,o.s,t.u,Z.a],styles:[".margin-top-20px[_ngcontent-%COMP%]{margin-top:20px}.template-description[_ngcontent-%COMP%]{cursor:pointer}"],data:{animation:[z.a]}}),e})();var ee=i("++8I"),se=i("Uqoa"),ie=i("Pvcr"),te=i("MbNv"),oe=i("eQqG"),ne=i("ax2R"),re=i("iRmZ"),ae=i("vKUq"),ce=i("Babz"),de=i("Lcal"),ue=i("chhc"),le=i("W872"),be=i("Wsbs"),me=i("UGSt");function he(e,s){if(1&e){const e=D.Xb();D.Wb(0,"tm-session-edit-form",6),D.ic("modelChange",(function(s){return D.Fc(e),D.kc().sessionEditFormModel=s}))("editExistingSessionEvent",(function(){return D.Fc(e),D.kc().editExistingSessionHandler()}))("cancelEditingSessionEvent",(function(){return D.Fc(e),D.kc().cancelEditingSessionHandler()}))("deleteExistingSessionEvent",(function(){return D.Fc(e),D.kc().deleteExistingSessionHandler()}))("copyCurrentSessionEvent",(function(){return D.Fc(e),D.kc().copyCurrentSession()})),D.Vb()}if(2&e){const e=D.kc();D.sc("formMode",e.SessionEditFormMode.EDIT)("model",e.sessionEditFormModel)}}function pe(e,s){if(1&e){const e=D.Xb();D.Wb(0,"div",7),D.Wb(1,"button",8),D.ic("click",(function(){D.Fc(e);const s=D.kc();return s.isAllCollapsed?s.expandAll():s.collapseAll()})),D.Qc(2),D.Vb(),D.Vb()}if(2&e){const e=D.kc();D.Cb(2),D.Sc(" ",e.isAllCollapsed?"Expand":"Collapse"," All ")}}function ge(e,s){if(1&e){const e=D.Xb();D.Wb(0,"div"),D.Wb(1,"tm-question-edit-form",10),D.ic("saveExistingQuestionEvent",(function(){D.Fc(e);const i=s.index;return D.kc(2).saveExistingQuestionHandler(i)}))("discardExistingQuestionChangesEvent",(function(){D.Fc(e);const i=s.index;return D.kc(2).discardExistingQuestionHandler(i)}))("duplicateCurrentQuestionEvent",(function(){D.Fc(e);const i=s.index;return D.kc(2).duplicateCurrentQuestionHandler(i)}))("deleteCurrentQuestionEvent",(function(){D.Fc(e);const i=s.index;return D.kc(2).deleteExistingQuestionHandler(i)}))("formModelChange",(function(i){D.Fc(e);const t=s.index;return D.kc(2).questionEditFormModels[t]=i})),D.Vb(),D.Vb()}if(2&e){const e=s.index,i=D.kc(2);D.Cb(1),D.sc("formMode",i.QuestionEditFormMode.EDIT)("numOfQuestions",i.questionEditFormModels.length)("formModel",i.questionEditFormModels[e])}}function fe(e,s){if(1&e&&(D.Wb(0,"div"),D.Oc(1,ge,2,3,"div",9),D.Vb()),2&e){const e=D.kc();D.Cb(1),D.sc("ngForOf",e.questionEditFormModels)("ngForTrackBy",e.trackQuestionEditFormByFn)}}function Se(e,s){if(1&e){const e=D.Xb();D.Wb(0,"button",16),D.ic("click",(function(){D.Fc(e);const s=D.kc().$implicit;return D.kc(2).populateAndShowNewQuestionForm(s)})),D.Qc(1),D.lc(2,"questionTypeName"),D.Vb()}if(2&e){const e=D.kc().$implicit;D.Cb(1),D.Sc(" ",D.mc(2,1,e)," ")}}function Te(e,s){if(1&e&&(D.Ub(0),D.Oc(1,Se,3,3,"button",23),D.Tb()),2&e){const e=s.$implicit,i=D.kc(2);D.Cb(1),D.sc("ngIf",e!==i.FeedbackQuestionType.CONSTSUM)}}function Ee(e,s){1&e&&D.Rb(0,"tm-ajax-loading")}const ve=function(){return{questionId:"questions",section:"questions"}};function ke(e,s){if(1&e){const e=D.Xb();D.Wb(0,"div",11),D.Wb(1,"div",12),D.Wb(2,"div",13),D.Wb(3,"button",14),D.Qc(4,"Add New Question"),D.Vb(),D.Wb(5,"div",15),D.Wb(6,"button",16),D.ic("click",(function(){return D.Fc(e),D.kc().templateQuestionModalHandler()})),D.Qc(7,"Choose from template questions"),D.Vb(),D.Rb(8,"div",17),D.Oc(9,Te,2,1,"ng-container",18),D.lc(10,"enumToArray"),D.Vb(),D.Vb(),D.Wb(11,"a",19),D.Rb(12,"i",20),D.Vb(),D.Wb(13,"button",21),D.ic("click",(function(){return D.Fc(e),D.kc().copyQuestionsFromOtherSessionsHandler()})),D.Oc(14,Ee,1,0,"tm-ajax-loading",22),D.Qc(15,"Copy Question"),D.Vb(),D.Vb(),D.Vb()}if(2&e){const e=D.kc();D.Cb(9),D.sc("ngForOf",D.mc(10,4,e.FeedbackQuestionType)),D.Cb(2),D.sc("queryParams",D.vc(6,ve)),D.Cb(2),D.sc("disabled",e.isCopyingQuestion),D.Cb(1),D.sc("ngIf",e.isCopyingQuestion)}}function Fe(e,s){if(1&e){const e=D.Xb();D.Wb(0,"tm-question-edit-form",24),D.ic("discardNewQuestionEvent",(function(){return D.Fc(e),D.kc().isAddingQuestionPanelExpanded=!1}))("createNewQuestionEvent",(function(){return D.Fc(e),D.kc().createNewQuestionHandler()}))("formModelChange",(function(s){return D.Fc(e),D.kc().newQuestionEditFormModel=s})),D.Vb()}if(2&e){const e=D.kc();D.sc("formMode",e.QuestionEditFormMode.ADD)("numOfQuestions",e.questionEditFormModels.length+1)("formModel",e.newQuestionEditFormModel)}}function ye(e,s){if(1&e&&(D.Wb(0,"option",35),D.Qc(1),D.Vb()),2&e){const e=s.$implicit;D.sc("ngValue",e.email),D.Cb(1),D.Tc("[",e.teamName,"] ",e.name,"")}}function Me(e,s){1&e&&D.Sb(0)}const Qe=function(e,s,i){return{courseid:e,fsname:s,previewas:i}};function Ce(e,s){if(1&e&&(D.Wb(0,"a",36),D.Oc(1,Me,1,0,"ng-container",37),D.Vb()),2&e){D.kc();const e=D.Cc(11),s=D.kc();D.sc("queryParams",D.yc(3,Qe,s.courseId,s.feedbackSessionName,s.emailOfStudentToPreview))("ngbTooltip",0!==s.emailOfStudentToPreview.length?"View how this session would look like to a student who is submitting feedback.":"Preview is unavailable if the course has yet to have any student enrolled."),D.Cb(1),D.sc("ngTemplateOutlet",e)}}function we(e,s){if(1&e&&(D.Wb(0,"button",38),D.Qc(1,"Preview as Student"),D.Vb()),2&e){const e=D.kc(2);D.sc("disabled",0===e.emailOfStudentToPreview.length)}}function Oe(e,s){if(1&e&&(D.Wb(0,"option",35),D.Qc(1),D.Vb()),2&e){const e=s.$implicit;D.sc("ngValue",e.email),D.Cb(1),D.Rc(e.name)}}function qe(e,s){1&e&&D.Sb(0)}function Ne(e,s){if(1&e&&(D.Wb(0,"a",39),D.Oc(1,qe,1,0,"ng-container",37),D.Vb()),2&e){D.kc();const e=D.Cc(17),s=D.kc();D.sc("queryParams",D.yc(2,Qe,s.courseId,s.feedbackSessionName,s.emailOfInstructorToPreview)),D.Cb(1),D.sc("ngTemplateOutlet",e)}}function Ie(e,s){if(1&e&&(D.Wb(0,"button",40),D.Qc(1,"Preview as Instructor"),D.Vb()),2&e){const e=D.kc(2);D.sc("disabled",0===e.emailOfInstructorToPreview.length)}}function Ve(e,s){if(1&e){const e=D.Xb();D.Wb(0,"div",11),D.Wb(1,"div",12),D.Wb(2,"div",25),D.Wb(3,"div",26),D.Wb(4,"b"),D.Qc(5,"Preview Session:"),D.Vb(),D.Vb(),D.Wb(6,"div",27),D.Wb(7,"select",28),D.ic("ngModelChange",(function(s){return D.Fc(e),D.kc().emailOfStudentToPreview=s})),D.Oc(8,ye,2,3,"option",29),D.Vb(),D.Oc(9,Ce,2,7,"a",30),D.Oc(10,we,2,1,"ng-template",null,31,D.Pc),D.Vb(),D.Wb(12,"div",27),D.Wb(13,"select",32),D.ic("ngModelChange",(function(s){return D.Fc(e),D.kc().emailOfInstructorToPreview=s})),D.Oc(14,Oe,2,2,"option",29),D.Vb(),D.Oc(15,Ne,2,6,"a",33),D.Oc(16,Ie,2,1,"ng-template",null,34,D.Pc),D.Vb(),D.Vb(),D.Vb(),D.Vb()}if(2&e){const e=D.Cc(11),s=D.Cc(17),i=D.kc();D.Cb(7),D.sc("ngModel",i.emailOfStudentToPreview),D.Cb(1),D.sc("ngForOf",i.studentsOfCourse),D.Cb(1),D.sc("ngIf",0!==i.emailOfStudentToPreview.length)("ngIfElse",e),D.Cb(4),D.sc("ngModel",i.emailOfInstructorToPreview),D.Cb(1),D.sc("ngForOf",i.instructorsCanBePreviewedAs),D.Cb(1),D.sc("ngIf",0!==i.emailOfInstructorToPreview.length)("ngIfElse",s)}}const Re=[{path:"",component:(()=>{class e extends V.a{constructor(e,s,i,t,o,n,r,a,c,d,u,l,b,m,h){super(e,s,i,t,o,n,r,a,c,d),this.studentService=u,this.courseService=l,this.route=b,this.timezoneService=m,this.changeDetectorRef=h,this.SessionEditFormMode=N.a,this.QuestionEditFormMode=q.a,this.FeedbackQuestionType=Q.d,this.courseId="",this.feedbackSessionName="",this.isEditingMode=!1,this.courseName="",this.sessionEditFormModel={courseId:"",timeZone:"UTC",courseName:"",feedbackSessionName:"",instructions:"",submissionStartTime:{hour:23,minute:59},submissionStartDate:{year:0,month:0,day:0},submissionEndTime:{hour:23,minute:59},submissionEndDate:{year:0,month:0,day:0},gracePeriod:0,sessionVisibleSetting:Q.o.AT_OPEN,customSessionVisibleTime:{hour:23,minute:59},customSessionVisibleDate:{year:0,month:0,day:0},responseVisibleSetting:Q.n.CUSTOM,customResponseVisibleTime:{hour:23,minute:59},customResponseVisibleDate:{year:0,month:0,day:0},submissionStatus:Q.f.OPEN,publishStatus:Q.e.NOT_PUBLISHED,isClosingEmailEnabled:!0,isPublishedEmailEnabled:!0,templateSessionName:"",isSaving:!1,isEditable:!1,isDeleting:!1,isCopying:!1,hasVisibleSettingsPanelExpanded:!1,hasEmailSettingsPanelExpanded:!1},this.feedbackSessionModelBeforeEditing=JSON.parse(JSON.stringify(this.sessionEditFormModel)),this.feedbackQuestionModels=new Map,this.questionEditFormModels=[],this.newQuestionEditFormModel={feedbackQuestionId:"",questionNumber:0,questionBrief:"",questionDescription:"",isQuestionHasResponses:!1,questionType:Q.d.TEXT,questionDetails:{questionType:Q.d.TEXT,questionText:""},giverType:Q.c.STUDENTS,recipientType:Q.c.STUDENTS,numberOfEntitiesToGiveFeedbackToSetting:Q.m.UNLIMITED,customNumberOfEntitiesToGiveFeedbackTo:1,showResponsesTo:[],showGiverNameTo:[],showRecipientNameTo:[],isEditable:!0,isSaving:!1,isCollapsed:!1,isVisibilityChanged:!1,isFeedbackPathChanged:!1,isQuestionDetailsChanged:!1},this.isAddingQuestionPanelExpanded=!1,this.isLoadingFeedbackSession=!1,this.hasLoadingFeedbackSessionFailed=!1,this.isLoadingFeedbackQuestions=!1,this.hasLoadingFeedbackQuestionsFailed=!1,this.isCopyingQuestion=!1,this.studentsOfCourse=[],this.emailOfStudentToPreview="",this.instructorsCanBePreviewedAs=[],this.emailOfInstructorToPreview=""}get isAllCollapsed(){return this.questionEditFormModels.some(e=>e.isCollapsed)}ngOnInit(){this.route.queryParams.subscribe(e=>{this.courseId=e.courseid,this.feedbackSessionName=e.fsname,this.isEditingMode="true"===e.editingMode,this.loadFeedbackSession(),this.loadFeedbackQuestions(),this.getAllStudentsOfCourse(),this.getAllInstructorsCanBePreviewedAs()})}loadFeedbackSession(){this.hasLoadingFeedbackSessionFailed=!1,this.isLoadingFeedbackSession=!0,this.courseService.getCourseAsInstructor(this.courseId).subscribe(e=>{this.courseName=e.courseName,this.feedbackSessionsService.getFeedbackSession({courseId:this.courseId,feedbackSessionName:this.feedbackSessionName,intent:C.b.FULL_DETAIL}).pipe(Object(T.a)(()=>this.isLoadingFeedbackSession=!1)).subscribe(e=>{this.sessionEditFormModel=this.getSessionEditFormModel(e,this.isEditingMode),this.feedbackSessionModelBeforeEditing=this.getSessionEditFormModel(e)},e=>{this.hasLoadingFeedbackSessionFailed=!0,this.statusMessageService.showErrorToast(e.error.message)})},e=>{this.statusMessageService.showErrorToast(e.error.message),this.isLoadingFeedbackSession=!1,this.hasLoadingFeedbackSessionFailed=!0})}copyCurrentSession(){this.sessionEditFormModel.isCopying=!0,this.courseService.getInstructorCoursesThatAreActive().subscribe(e=>{const s=this.ngbModal.open(O.a);s.componentInstance.newFeedbackSessionName=this.feedbackSessionName,s.componentInstance.courseCandidates=e.courses,s.componentInstance.sessionToCopyCourseId=this.courseId,s.result.then(e=>{this.failedToCopySessions={};const s=this.createSessionCopyRequestsFromModal(e,this.courseId,this.feedbackSessionName);1===s.length&&this.copySingleSession(s[0]),s.length>1&&Object(f.a)(s).pipe(Object(T.a)(()=>this.sessionEditFormModel.isCopying=!1)).subscribe(()=>{this.showCopyStatusMessage()})},e=>{this.statusMessageService.showErrorToast(e.error.message)}).catch(()=>{})})}getSessionEditFormModel(e,s=!1){const i=this.getDateTimeAtTimezone(e.submissionStartTimestamp,e.timeZone),t=this.getDateTimeAtTimezone(e.submissionEndTimestamp,e.timeZone),o={isEditable:s,courseId:e.courseId,timeZone:e.timeZone,courseName:this.courseName,feedbackSessionName:e.feedbackSessionName,instructions:e.instructions,submissionStartTime:i.time,submissionStartDate:i.date,submissionEndTime:t.time,submissionEndDate:t.date,gracePeriod:e.gracePeriod,sessionVisibleSetting:e.sessionVisibleSetting,customSessionVisibleTime:{hour:23,minute:59},customSessionVisibleDate:{year:0,month:0,day:0},responseVisibleSetting:e.responseVisibleSetting,customResponseVisibleTime:{hour:23,minute:59},customResponseVisibleDate:{year:0,month:0,day:0},submissionStatus:e.submissionStatus,publishStatus:e.publishStatus,templateSessionName:"",isClosingEmailEnabled:e.isClosingEmailEnabled,isPublishedEmailEnabled:e.isPublishedEmailEnabled,isSaving:!1,isDeleting:!1,isCopying:!1,hasVisibleSettingsPanelExpanded:e.sessionVisibleSetting!==Q.o.AT_OPEN||e.responseVisibleSetting!==Q.n.LATER,hasEmailSettingsPanelExpanded:!e.isClosingEmailEnabled||!e.isPublishedEmailEnabled};if(e.customSessionVisibleTimestamp){const s=this.getDateTimeAtTimezone(e.customSessionVisibleTimestamp,e.timeZone);o.customSessionVisibleTime=s.time,o.customSessionVisibleDate=s.date}if(e.customResponseVisibleTimestamp){const s=this.getDateTimeAtTimezone(e.customResponseVisibleTimestamp,e.timeZone);o.customResponseVisibleTime=s.time,o.customResponseVisibleDate=s.date}return o}getDateTimeAtTimezone(e,s){const i=this.timezoneService.getMomentInstance(e,s);return{date:{year:i.year(),month:i.month()+1,day:i.date()},time:{minute:i.minute(),hour:i.hour()}}}editExistingSessionHandler(){this.sessionEditFormModel.isEditable=!1,this.feedbackSessionModelBeforeEditing=JSON.parse(JSON.stringify(this.sessionEditFormModel)),this.sessionEditFormModel.isSaving=!0,Object(f.a)([this.resolveLocalDateTime(this.sessionEditFormModel.submissionStartDate,this.sessionEditFormModel.submissionStartTime,this.sessionEditFormModel.timeZone,"Submission opening time"),this.resolveLocalDateTime(this.sessionEditFormModel.submissionEndDate,this.sessionEditFormModel.submissionEndTime,this.sessionEditFormModel.timeZone,"Submission closing time"),this.sessionEditFormModel.sessionVisibleSetting===Q.o.CUSTOM?this.resolveLocalDateTime(this.sessionEditFormModel.customSessionVisibleDate,this.sessionEditFormModel.customSessionVisibleTime,this.sessionEditFormModel.timeZone,"Session visible time"):Object(S.a)(0),this.sessionEditFormModel.responseVisibleSetting===Q.n.CUSTOM?this.resolveLocalDateTime(this.sessionEditFormModel.customResponseVisibleDate,this.sessionEditFormModel.customResponseVisibleTime,this.sessionEditFormModel.timeZone,"Response visible time"):Object(S.a)(0)]).pipe(Object(E.a)(e=>this.feedbackSessionsService.updateFeedbackSession(this.courseId,this.feedbackSessionName,{instructions:this.sessionEditFormModel.instructions,submissionStartTimestamp:e[0],submissionEndTimestamp:e[1],gracePeriod:this.sessionEditFormModel.gracePeriod,sessionVisibleSetting:this.sessionEditFormModel.sessionVisibleSetting,customSessionVisibleTimestamp:e[2],responseVisibleSetting:this.sessionEditFormModel.responseVisibleSetting,customResponseVisibleTimestamp:e[3],isClosingEmailEnabled:this.sessionEditFormModel.isClosingEmailEnabled,isPublishedEmailEnabled:this.sessionEditFormModel.isPublishedEmailEnabled})),Object(T.a)(()=>{this.sessionEditFormModel.isSaving=!1})).subscribe(e=>{this.sessionEditFormModel=this.getSessionEditFormModel(e),this.statusMessageService.showSuccessToast("The feedback session has been updated.")},e=>{this.statusMessageService.showErrorToast(e.error.message)})}cancelEditingSessionHandler(){this.sessionEditFormModel=JSON.parse(JSON.stringify(this.feedbackSessionModelBeforeEditing))}resolveLocalDateTime(e,s,i,t){const o=g()();o.set("year",e.year),o.set("month",e.month-1),o.set("date",e.day),o.set("hour",s.hour),o.set("minute",s.minute);const n=o.format(M.a);return this.timezoneService.getResolvedTimestamp(n,i,t).pipe(Object(v.a)(e=>{0!==e.message.length&&this.statusMessageService.showWarningToast(e.message)}),Object(k.a)(e=>e.timestamp))}deleteExistingSessionHandler(){this.sessionEditFormModel.isDeleting=!0,this.feedbackSessionsService.moveSessionToRecycleBin(this.courseId,this.feedbackSessionName).pipe(Object(T.a)(()=>this.sessionEditFormModel.isDeleting=!1)).subscribe(()=>{this.navigationService.navigateWithSuccessMessage(this.router,"/web/instructor/sessions","The feedback session has been deleted. You can restore it from the deleted sessions table below.")},e=>{this.statusMessageService.showErrorToast(e.error.message)})}loadFeedbackQuestions(){this.questionEditFormModels=[],this.hasLoadingFeedbackQuestionsFailed=!1,this.isLoadingFeedbackQuestions=!0,this.feedbackQuestionsService.getFeedbackQuestions({courseId:this.courseId,feedbackSessionName:this.feedbackSessionName,intent:C.b.FULL_DETAIL}).pipe(Object(T.a)(()=>this.isLoadingFeedbackQuestions=!1)).subscribe(e=>{e.questions.forEach(e=>{const s=this.getQuestionEditFormModel(e);this.questionEditFormModels.push(s),this.loadResponseStatusForQuestion(s),this.feedbackQuestionModels.set(e.feedbackQuestionId,e)})},e=>{this.hasLoadingFeedbackQuestionsFailed=!0,this.statusMessageService.showErrorToast(e.error.message)})}trackQuestionEditFormByFn(e,s){return s.feedbackQuestionId}getQuestionEditFormModel(e){return{feedbackQuestionId:e.feedbackQuestionId,questionNumber:e.questionNumber,questionBrief:e.questionBrief,questionDescription:e.questionDescription,isQuestionHasResponses:!1,questionType:e.questionType,questionDetails:this.deepCopy(e.questionDetails),giverType:e.giverType,recipientType:e.recipientType,numberOfEntitiesToGiveFeedbackToSetting:e.numberOfEntitiesToGiveFeedbackToSetting,customNumberOfEntitiesToGiveFeedbackTo:e.customNumberOfEntitiesToGiveFeedbackTo?e.customNumberOfEntitiesToGiveFeedbackTo:1,showResponsesTo:e.showResponsesTo,showGiverNameTo:e.showGiverNameTo,showRecipientNameTo:e.showRecipientNameTo,isEditable:!1,isSaving:!1,isCollapsed:!1,isVisibilityChanged:!1,isFeedbackPathChanged:!1,isQuestionDetailsChanged:!1}}loadResponseStatusForQuestion(e){this.feedbackSessionsService.hasResponsesForQuestion(e.feedbackQuestionId).subscribe(s=>{e.isQuestionHasResponses=s.hasResponses},e=>{this.statusMessageService.showErrorToast(e.error.message)})}saveExistingQuestionHandler(e){const s=this.questionEditFormModels[e],i=this.feedbackQuestionModels.get(s.feedbackQuestionId).questionNumber;s.isSaving=!0,this.feedbackQuestionsService.saveFeedbackQuestion(s.feedbackQuestionId,{questionNumber:s.questionNumber,questionBrief:s.questionBrief,questionDescription:s.questionDescription,questionDetails:s.questionDetails,questionType:s.questionType,giverType:s.giverType,recipientType:s.recipientType,numberOfEntitiesToGiveFeedbackToSetting:s.numberOfEntitiesToGiveFeedbackToSetting,customNumberOfEntitiesToGiveFeedbackTo:s.customNumberOfEntitiesToGiveFeedbackTo,showResponsesTo:s.showResponsesTo,showGiverNameTo:s.showGiverNameTo,showRecipientNameTo:s.showRecipientNameTo}).pipe(Object(T.a)(()=>{s.isSaving=!1})).subscribe(s=>{this.questionEditFormModels[e]=this.getQuestionEditFormModel(s),this.feedbackQuestionModels.set(s.feedbackQuestionId,s),this.loadResponseStatusForQuestion(this.questionEditFormModels[e]),i!==s.questionNumber&&(this.moveQuestionForm(i-1,s.questionNumber-1),this.normalizeQuestionNumberInQuestionForms()),this.statusMessageService.showSuccessToast("The changes to the question have been updated.")},e=>{this.statusMessageService.showErrorToast(e.error.message)})}moveQuestionForm(e,s){this.questionEditFormModels.splice(s,0,this.questionEditFormModels.splice(e,1)[0]);const i=Math.min(e,s),t=this.questionEditFormModels.slice(i,s+1).filter(e=>!e.isCollapsed);t.forEach(e=>e.isCollapsed=!0),this.changeDetectorRef.detectChanges(),t.forEach(e=>e.isCollapsed=!1)}normalizeQuestionNumberInQuestionForms(){for(let e=1;e<=this.questionEditFormModels.length;e+=1){const s=this.questionEditFormModels[e-1];s.questionNumber=e,this.feedbackQuestionModels.get(s.feedbackQuestionId).questionNumber=e}}discardExistingQuestionHandler(e){const s=this.feedbackQuestionModels.get(this.questionEditFormModels[e].feedbackQuestionId);this.questionEditFormModels[e]=this.getQuestionEditFormModel(s)}duplicateCurrentQuestionHandler(e){const s=this.questionEditFormModels[e];s.isSaving=!0,this.feedbackQuestionsService.createFeedbackQuestion(this.courseId,this.feedbackSessionName,{questionNumber:this.questionEditFormModels.length+1,questionBrief:s.questionBrief,questionDescription:s.questionDescription,questionDetails:s.questionDetails,questionType:s.questionType,giverType:s.giverType,recipientType:s.recipientType,numberOfEntitiesToGiveFeedbackToSetting:s.numberOfEntitiesToGiveFeedbackToSetting,customNumberOfEntitiesToGiveFeedbackTo:s.customNumberOfEntitiesToGiveFeedbackTo,showResponsesTo:s.showResponsesTo,showGiverNameTo:s.showGiverNameTo,showRecipientNameTo:s.showRecipientNameTo}).pipe(Object(T.a)(()=>{s.isSaving=!1})).subscribe(e=>{this.questionEditFormModels.push(this.getQuestionEditFormModel(e)),this.feedbackQuestionModels.set(e.feedbackQuestionId,e),this.statusMessageService.showSuccessToast("The question has been duplicated below.")},e=>{this.statusMessageService.showErrorToast(e.error.message)})}deleteExistingQuestionHandler(e){this.simpleModalService.openConfirmationModal("Delete the question?",I.a.DANGER,"Warning: Deleted question cannot be recovered. <b>All existing responses for this question to be deleted.</b>").result.then(()=>{const s=this.questionEditFormModels[e];this.feedbackQuestionsService.deleteFeedbackQuestion(s.feedbackQuestionId).subscribe(()=>{this.feedbackQuestionModels.delete(s.feedbackQuestionId),this.questionEditFormModels.splice(e,1),this.normalizeQuestionNumberInQuestionForms(),this.statusMessageService.showSuccessToast("The question has been deleted.")},e=>{this.statusMessageService.showErrorToast(e.error.message)})},()=>{})}templateQuestionModalHandler(){this.ngbModal.open(Y,{windowClass:"modal-large"}).result.then(e=>{let s=this.questionEditFormModels.length;Object(S.a)(...e).pipe(Object(F.a)(e=>(s+=1,this.feedbackQuestionsService.createFeedbackQuestion(this.courseId,this.feedbackSessionName,{questionNumber:s,questionBrief:e.questionBrief,questionDescription:e.questionDescription,questionDetails:e.questionDetails,questionType:e.questionType,giverType:e.giverType,recipientType:e.recipientType,numberOfEntitiesToGiveFeedbackToSetting:e.numberOfEntitiesToGiveFeedbackToSetting,customNumberOfEntitiesToGiveFeedbackTo:e.customNumberOfEntitiesToGiveFeedbackTo,showResponsesTo:e.showResponsesTo,showGiverNameTo:e.showGiverNameTo,showRecipientNameTo:e.showRecipientNameTo})))).subscribe(e=>{this.questionEditFormModels.push(this.getQuestionEditFormModel(e)),this.feedbackQuestionModels.set(e.feedbackQuestionId,e)},e=>{this.statusMessageService.showErrorToast(e.error.message)},()=>{this.statusMessageService.showSuccessToast(1===e.length?"The question has been added to this feedback session.":"The questions have been added to this feedback session.")})},()=>{})}populateAndShowNewQuestionForm(e){this.isAddingQuestionPanelExpanded=!0;const s=this.feedbackQuestionsService.getNewQuestionModel(e);if(this.newQuestionEditFormModel={feedbackQuestionId:"",questionNumber:this.questionEditFormModels.length+1,questionBrief:s.questionBrief,questionDescription:s.questionDescription,isQuestionHasResponses:!1,questionType:s.questionType,questionDetails:s.questionDetails,giverType:s.giverType,recipientType:s.recipientType,numberOfEntitiesToGiveFeedbackToSetting:s.numberOfEntitiesToGiveFeedbackToSetting,customNumberOfEntitiesToGiveFeedbackTo:s.customNumberOfEntitiesToGiveFeedbackTo?s.customNumberOfEntitiesToGiveFeedbackTo:1,showResponsesTo:s.showResponsesTo,showGiverNameTo:s.showGiverNameTo,showRecipientNameTo:s.showRecipientNameTo,isEditable:!0,isSaving:!1,isCollapsed:!1,isVisibilityChanged:!1,isFeedbackPathChanged:!1,isQuestionDetailsChanged:!1},this.questionEditFormModels.length>0){const s=this.questionEditFormModels[this.questionEditFormModels.length-1],i=this.feedbackQuestionsService.getAllowedFeedbackPaths(e);i.has(s.giverType)&&-1!==i.get(s.giverType).indexOf(s.recipientType)&&(this.newQuestionEditFormModel.giverType=s.giverType,this.newQuestionEditFormModel.recipientType=s.recipientType,this.newQuestionEditFormModel.numberOfEntitiesToGiveFeedbackToSetting=s.numberOfEntitiesToGiveFeedbackToSetting,this.newQuestionEditFormModel.customNumberOfEntitiesToGiveFeedbackTo=s.customNumberOfEntitiesToGiveFeedbackTo);const t=this.feedbackQuestionsService.getNewVisibilityStateMachine(this.newQuestionEditFormModel.giverType,this.newQuestionEditFormModel.recipientType);t.applyVisibilitySettings({SHOW_RESPONSE:s.showResponsesTo,SHOW_GIVER_NAME:s.showGiverNameTo,SHOW_RECIPIENT_NAME:s.showRecipientNameTo});const o=t.getVisibilityTypesUnderVisibilityControl(w.a.SHOW_RESPONSE),n=t.getVisibilityTypesUnderVisibilityControl(w.a.SHOW_GIVER_NAME),r=t.getVisibilityTypesUnderVisibilityControl(w.a.SHOW_RECIPIENT_NAME);let a=!1;if(this.feedbackQuestionsService.isCustomFeedbackVisibilitySettingAllowed(this.newQuestionEditFormModel.questionType))a=!0;else{const e=this.feedbackQuestionsService.getCommonFeedbackVisibilitySettings(t,this.newQuestionEditFormModel.questionType);for(const s of e)if(this.isSameSet(o,s.visibilitySettings.SHOW_RESPONSE)&&this.isSameSet(n,s.visibilitySettings.SHOW_GIVER_NAME)&&this.isSameSet(r,s.visibilitySettings.SHOW_RECIPIENT_NAME)){a=!0;break}}a&&(this.newQuestionEditFormModel.showResponsesTo=o,this.newQuestionEditFormModel.showGiverNameTo=n,this.newQuestionEditFormModel.showRecipientNameTo=r)}this.scrollToNewEditForm()}isSameSet(e,s){return e.length===s.length&&e.every(e=>s.includes(e))}createNewQuestionHandler(){this.newQuestionEditFormModel.isSaving=!0,this.feedbackQuestionsService.createFeedbackQuestion(this.courseId,this.feedbackSessionName,{questionNumber:this.newQuestionEditFormModel.questionNumber,questionBrief:this.newQuestionEditFormModel.questionBrief,questionDescription:this.newQuestionEditFormModel.questionDescription,questionDetails:this.newQuestionEditFormModel.questionDetails,questionType:this.newQuestionEditFormModel.questionType,giverType:this.newQuestionEditFormModel.giverType,recipientType:this.newQuestionEditFormModel.recipientType,numberOfEntitiesToGiveFeedbackToSetting:this.newQuestionEditFormModel.numberOfEntitiesToGiveFeedbackToSetting,customNumberOfEntitiesToGiveFeedbackTo:this.newQuestionEditFormModel.customNumberOfEntitiesToGiveFeedbackTo,showResponsesTo:this.newQuestionEditFormModel.showResponsesTo,showGiverNameTo:this.newQuestionEditFormModel.showGiverNameTo,showRecipientNameTo:this.newQuestionEditFormModel.showRecipientNameTo}).pipe(Object(T.a)(()=>{this.newQuestionEditFormModel.isSaving=!1})).subscribe(e=>{this.questionEditFormModels.push(this.getQuestionEditFormModel(e)),this.feedbackQuestionModels.set(e.feedbackQuestionId,e),this.moveQuestionForm(this.questionEditFormModels.length-1,e.questionNumber-1),this.normalizeQuestionNumberInQuestionForms(),this.isAddingQuestionPanelExpanded=!1,this.statusMessageService.showSuccessToast("The question has been added to this feedback session.")},e=>{this.statusMessageService.showErrorToast(e.error.message)})}copyQuestionsFromOtherSessionsHandler(){this.isCopyingQuestion=!0;const e=[];this.feedbackSessionsService.getFeedbackSessionsForInstructor().pipe(Object(E.a)(e=>Object(S.a)(...e.feedbackSessions)),Object(y.a)(e=>this.feedbackQuestionsService.getFeedbackQuestions({courseId:e.courseId,feedbackSessionName:e.feedbackSessionName,intent:C.b.FULL_DETAIL}).pipe(Object(k.a)(s=>s.questions.map(s=>({courseId:e.courseId,feedbackSessionName:e.feedbackSessionName,question:s,isSelected:!1}))))),Object(T.a)(()=>this.isCopyingQuestion=!1)).subscribe(s=>{e.push(...s)},e=>{this.statusMessageService.showErrorToast(e.error.message)},()=>{const s=this.ngbModal.open(X);s.componentInstance.questionToCopyCandidates=e,s.result.then(e=>{this.isCopyingQuestion=!0,Object(S.a)(...e).pipe(Object(F.a)(e=>this.feedbackQuestionsService.createFeedbackQuestion(this.courseId,this.feedbackSessionName,{questionNumber:this.questionEditFormModels.length+1,questionBrief:e.questionBrief,questionDescription:e.questionDescription,questionDetails:e.questionDetails,questionType:e.questionType,giverType:e.giverType,recipientType:e.recipientType,numberOfEntitiesToGiveFeedbackToSetting:e.numberOfEntitiesToGiveFeedbackToSetting,customNumberOfEntitiesToGiveFeedbackTo:e.customNumberOfEntitiesToGiveFeedbackTo,showResponsesTo:e.showResponsesTo,showGiverNameTo:e.showGiverNameTo,showRecipientNameTo:e.showRecipientNameTo})),Object(T.a)(()=>this.isCopyingQuestion=!1)).subscribe(e=>{this.questionEditFormModels.push(this.getQuestionEditFormModel(e)),this.feedbackQuestionModels.set(e.feedbackQuestionId,e),this.statusMessageService.showSuccessToast("The question has been added to this feedback session.")},e=>{this.statusMessageService.showErrorToast(e.error.message)})})})}getAllStudentsOfCourse(){this.studentService.getStudentsFromCourse({courseId:this.courseId}).subscribe(e=>{this.studentsOfCourse=e.students,this.studentsOfCourse.sort((e,s)=>{const i=e.teamName.localeCompare(s.teamName);return 0===i?e.name.localeCompare(s.name):i}),this.studentsOfCourse.length>=1&&(this.emailOfStudentToPreview=this.studentsOfCourse[0].email)},e=>{this.statusMessageService.showErrorToast(e.error.message)})}getAllInstructorsCanBePreviewedAs(){this.instructorService.loadInstructors({courseId:this.courseId,intent:C.b.FULL_DETAIL}).subscribe(e=>{this.instructorsCanBePreviewedAs=e.instructors,this.instructorsCanBePreviewedAs.sort((e,s)=>e.name.localeCompare(s.name)),this.instructorsCanBePreviewedAs.length>=1&&(this.emailOfInstructorToPreview=this.instructorsCanBePreviewedAs[0].email)},e=>{this.statusMessageService.showErrorToast(e.error.message)})}expandAll(){this.questionEditFormModels.forEach(e=>{e.isCollapsed=!1})}collapseAll(){this.questionEditFormModels.forEach(e=>{e.isCollapsed=!0})}deepCopy(e){return JSON.parse(JSON.stringify(e))}scrollToNewEditForm(){setTimeout(()=>{const e=document.querySelectorAll("tm-question-edit-form"),s=e[e.length-1].getBoundingClientRect().top+window.pageYOffset+-70;window.scrollTo({top:s,behavior:"smooth"})},0)}}return e.\u0275fac=function(s){return new(s||e)(D.Qb(n.d),D.Qb(ee.a),D.Qb(se.a),D.Qb(ie.a),D.Qb(te.a),D.Qb(J.a),D.Qb(P.a),D.Qb(r.m),D.Qb(oe.a),D.Qb(ne.a),D.Qb(re.a),D.Qb(ae.a),D.Qb(n.a),D.Qb(M.b),D.Qb(D.h))},e.\u0275cmp=D.Kb({type:e,selectors:[["tm-instructor-session-edit-page"]],features:[D.zb],decls:10,vars:10,consts:[[3,"shouldShowRetry","message","retryEvent"],[3,"formMode","model","modelChange","editExistingSessionEvent","cancelEditingSessionEvent","deleteExistingSessionEvent","copyCurrentSessionEvent",4,"tmIsLoading"],["class","offset-md-10 margin-vertical-20px",4,"ngIf"],[4,"tmIsLoading"],["class","card",4,"ngIf"],[3,"formMode","numOfQuestions","formModel","discardNewQuestionEvent","createNewQuestionEvent","formModelChange",4,"ngIf"],[3,"formMode","model","modelChange","editExistingSessionEvent","cancelEditingSessionEvent","deleteExistingSessionEvent","copyCurrentSessionEvent"],[1,"offset-md-10","margin-vertical-20px"],[1,"btn","expand-btn","btn-light","margin-top-30px",3,"click"],[4,"ngFor","ngForOf","ngForTrackBy"],[3,"formMode","numOfQuestions","formModel","saveExistingQuestionEvent","discardExistingQuestionChangesEvent","duplicateCurrentQuestionEvent","deleteCurrentQuestionEvent","formModelChange"],[1,"card"],[1,"card-body","background-color-light-blue","text-center"],["ngbDropdown","",1,"d-inline-block"],["id","btn-new-question","ngbDropdownToggle","",1,"btn","btn-primary"],["id","new-question-dropdown","ngbDropdownMenu",""],[1,"dropdown-item",3,"click"],[1,"dropdown-divider"],[4,"ngFor","ngForOf"],["type","button","target","_blank","rel","noopener noreferrer","tmRouterLink","/web/instructor/help",1,"btn","btn-link",3,"queryParams"],[1,"fas","fa-info-circle"],["id","btn-copy-question",1,"btn","btn-primary",3,"disabled","click"],[4,"ngIf"],["class","dropdown-item",3,"click",4,"ngIf"],[3,"formMode","numOfQuestions","formModel","discardNewQuestionEvent","createNewQuestionEvent","formModelChange"],[1,"row","align-items-center"],[1,"col-lg-2","text-lg-right"],[1,"col-lg-5"],["id","preview-student",1,"form-control","preview-select",3,"ngModel","ngModelChange"],[3,"ngValue",4,"ngFor","ngForOf"],["tmRouterLink","/web/sessions/submission","target","_blank","rel","noopener noreferrer",3,"queryParams","ngbTooltip",4,"ngIf","ngIfElse"],["previewStudentBtn",""],["id","preview-instructor",1,"form-control","preview-select",3,"ngModel","ngModelChange"],["tmRouterLink","/web/instructor/sessions/submission","target","_blank","rel","noopener noreferrer","ngbTooltip","View how this session would look like to an instructor who is submitting feedback. Only instructors with submit privileges are included in the list.",3,"queryParams",4,"ngIf","ngIfElse"],["previewInstructorBtn",""],[3,"ngValue"],["tmRouterLink","/web/sessions/submission","target","_blank","rel","noopener noreferrer",3,"queryParams","ngbTooltip"],[4,"ngTemplateOutlet"],["id","btn-preview-student",1,"btn","btn-primary",3,"disabled"],["tmRouterLink","/web/instructor/sessions/submission","target","_blank","rel","noopener noreferrer","ngbTooltip","View how this session would look like to an instructor who is submitting feedback. Only instructors with submit privileges are included in the list.",3,"queryParams"],["id","btn-preview-instructor",1,"btn","btn-primary",3,"disabled"]],template:function(e,s){1&e&&(D.Wb(0,"tm-loading-retry",0),D.ic("retryEvent",(function(){return s.loadFeedbackSession()})),D.Oc(1,he,1,2,"tm-session-edit-form",1),D.Vb(),D.Wb(2,"tm-loading-retry",0),D.ic("retryEvent",(function(){return s.loadFeedbackQuestions()})),D.Oc(3,pe,3,1,"div",2),D.Oc(4,fe,2,2,"div",3),D.Rb(5,"br"),D.Oc(6,ke,16,7,"div",4),D.Oc(7,Fe,1,3,"tm-question-edit-form",5),D.Rb(8,"br"),D.Oc(9,Ve,18,8,"div",4),D.Vb()),2&e&&(D.sc("shouldShowRetry",s.hasLoadingFeedbackSessionFailed)("message","Failed to load feedback session"),D.Cb(1),D.sc("tmIsLoading",s.isLoadingFeedbackSession),D.Cb(1),D.sc("shouldShowRetry",s.hasLoadingFeedbackQuestionsFailed)("message","Failed to load feedback questions"),D.Cb(1),D.sc("ngIf",!s.isLoadingFeedbackQuestions),D.Cb(1),D.sc("tmIsLoading",s.isLoadingFeedbackQuestions),D.Cb(2),D.sc("ngIf",!s.isLoadingFeedbackQuestions&&!s.isAddingQuestionPanelExpanded),D.Cb(1),D.sc("ngIf",s.isAddingQuestionPanelExpanded),D.Cb(2),D.sc("ngIf",!s.isLoadingFeedbackQuestions))},directives:[ce.a,de.a,t.u,ue.a,t.t,Z.a,r.g,r.k,r.i,le.a,be.a,o.B,o.p,o.s,o.u,o.E,r.w,t.B],pipes:[me.a,x.a],styles:[".background-color-light-blue[_ngcontent-%COMP%]{background-color:#eaeff5}.preview-select[_ngcontent-%COMP%]{float:left;width:50%}.expand-btn[_ngcontent-%COMP%]{width:100%}.margin-vertical-20px[_ngcontent-%COMP%]{margin-bottom:20px;margin-top:20px}"]}),e})()}];let De=(()=>{class e{}return e.\u0275mod=D.Ob({type:e}),e.\u0275inj=D.Nb({factory:function(s){return new(s||e)},imports:[[a.a,t.c,o.j,r.d,r.j,r.y,m.a,b.a,l.a,c.a,n.h.forChild(Re),u.a,d.a,h.a]]}),e})()},zAMY:function(e,s,i){"use strict";i.d(s,"a",(function(){return a}));var t=i("fXoL"),o=i("ofXK");function n(e,s){1&e&&t.Rb(0,"i",3)}function r(e,s){1&e&&t.Rb(0,"i",4)}let a=(()=>{class e{constructor(){this.isExpanded=!1}ngOnInit(){}}return e.\u0275fac=function(s){return new(s||e)},e.\u0275cmp=t.Kb({type:e,selectors:[["tm-panel-chevron"]],inputs:{isExpanded:"isExpanded"},decls:3,vars:2,consts:[[1,"chevron"],["class","fas fa-chevron-down",4,"ngIf"],["class","fas fa-chevron-up",4,"ngIf"],[1,"fas","fa-chevron-down"],[1,"fas","fa-chevron-up"]],template:function(e,s){1&e&&(t.Wb(0,"div",0),t.Oc(1,n,1,0,"i",1),t.Oc(2,r,1,0,"i",2),t.Vb()),2&e&&(t.Cb(1),t.sc("ngIf",!s.isExpanded),t.Cb(1),t.sc("ngIf",s.isExpanded))},directives:[o.u],styles:[".chevron[_ngcontent-%COMP%]{display:-ms-inline-flexbox;display:inline-flex;vertical-align:middle}"]}),e})()}}]);